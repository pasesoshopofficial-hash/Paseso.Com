<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>PASESO - All-in-One Social Platform | Powered in Romania üá∑üá¥</title>
    
    <!-- Primary SEO Meta Tags -->
    <meta name="title" content="PASESO - All-in-One Social Platform | Powered in Romania">
    <meta name="description" content="Join PASESO, the ultimate social platform for creators and communities. Share stories, reels, live streams and more. Connect with millions worldwide. Powered in Romania üá∑üá¥">
    <meta name="keywords" content="PASESO, social media, social platform, creators, communities, stories, reels, live streaming, Romania, video sharing, content creators, social network">
    <meta name="author" content="PASESO Team - Romania">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="revisit-after" content="1 days">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://paseso.app/">
    <meta property="og:title" content="PASESO - All-in-One Social Platform | Powered in Romania">
    <meta property="og:description" content="Join PASESO, the ultimate social platform for creators and communities. Share stories, reels, live streams and more.">
    <meta property="og:image" content="/img/og-image.png">
    <meta property="og:locale" content="en_US">
    <meta property="og:locale:alternate" content="ro_RO">
    <meta property="og:site_name" content="PASESO">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:url" content="https://paseso.app/">
    <meta name="twitter:title" content="PASESO - All-in-One Social Platform">
    <meta name="twitter:description" content="Join PASESO, the ultimate social platform for creators and communities. Powered in Romania üá∑üá¥">
    <meta name="twitter:image" content="/img/twitter-image.png">
    <meta name="twitter:creator" content="@paseso_app">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#8b5cf6">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="PASESO">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="PASESO">
    <meta name="msapplication-TileColor" content="#8b5cf6">
    <meta name="msapplication-config" content="/browserconfig.xml">
    
    <!-- Manifest and Icons -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect fill='%236366f1' width='100' height='100' rx='20'/><text x='50' y='68' font-size='50' font-weight='bold' fill='white' text-anchor='middle'>P</text></svg>">
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        * {
            font-family: 'Inter', sans-serif;
            box-sizing: border-box;
        }
        
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --accent: #f472b6;
            --accent-2: #22d3ee;
            --dark-1: #0a0a0f;
            --dark-2: #12121a;
            --dark-3: #1a1a25;
            --dark-4: #252532;
            --glass: rgba(255,255,255,0.05);
            --glass-border: rgba(255,255,255,0.1);
        }
        
        body {
            background: var(--dark-1);
            color: #fff;
            overflow-x: hidden;
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: var(--dark-2); }
        ::-webkit-scrollbar-thumb { background: var(--primary); border-radius: 3px; }
        
        .glass {
            background: var(--glass);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
        }
        
        .glass-strong {
            background: rgba(18,18,26,0.95);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
        }
        
        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--accent), var(--accent-2));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .gradient-border {
            position: relative;
            background: var(--dark-2);
        }
        .gradient-border::before {
            content: '';
            position: absolute;
            inset: 0;
            padding: 2px;
            background: linear-gradient(135deg, var(--primary), var(--accent), var(--accent-2));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            border-radius: inherit;
            pointer-events: none;
        }
        
        .glow-primary { box-shadow: 0 0 40px rgba(99,102,241,0.3); }
        .glow-accent { box-shadow: 0 0 40px rgba(244,114,182,0.3); }
        
        @keyframes float {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes pulse-glow {
            0%, 100% { box-shadow: 0 0 20px rgba(99,102,241,0.4); }
            50% { box-shadow: 0 0 40px rgba(99,102,241,0.8); }
        }
        
        @keyframes story-ring {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes heartBeat {
            0% { transform: scale(1); }
            15% { transform: scale(1.3); }
            30% { transform: scale(1); }
            45% { transform: scale(1.2); }
            60% { transform: scale(1); }
        }

        @keyframes heartPop {
            0% { transform: scale(0); opacity: 1; }
            50% { transform: scale(1.5); opacity: 1; }
            100% { transform: scale(2); opacity: 0; }
        }
        
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .animate-slide-in { animation: slideIn 0.3s ease-out; }
        .animate-heart { animation: heartBeat 0.6s ease-in-out; }
        
        .story-ring {
            background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888);
            padding: 3px;
            border-radius: 50%;
            position: relative;
        }
        .story-ring.unseen::before {
            content: '';
            position: absolute;
            inset: -3px;
            background: conic-gradient(from 0deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888, #f09433);
            border-radius: 50%;
            z-index: -1;
            animation: story-ring 3s linear infinite;
        }
        
        .live-badge {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            animation: pulse-glow 1.5s ease-in-out infinite;
        }
        
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
        }
        .nav-item.active i { color: white; }
        
        .tab-btn.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
        }
        
        .masonry {
            column-count: 3;
            column-gap: 16px;
        }
        .masonry-item {
            break-inside: avoid;
            margin-bottom: 16px;
        }
        
        .msg-sent {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 20px 20px 4px 20px;
        }
        .msg-received {
            background: var(--dark-4);
            border-radius: 20px 20px 20px 4px;
        }
        
        .premium-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #000;
        }
        
        .verified {
            background: linear-gradient(135deg, var(--accent-2), #06b6d4);
        }
        
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        .notif-dot {
            background: linear-gradient(135deg, #ef4444, #f97316);
            box-shadow: 0 0 10px #ef4444;
        }

        /* Light theme overrides */
        body.light-theme {
            /* Refreshed light palette for a cleaner, more modern look */
            --dark-1: #ffffff;
            --dark-2: #f7f8fa;
            --dark-3: #eef1f6;
            --dark-4: #e3e7ef;
            --glass: rgba(0, 0, 0, 0.03);
            --glass-border: rgba(0, 0, 0, 0.07);
            color: #1a1a2e;
        }

        /* Improve the readability of Tailwind gray text utilities in light mode */
        /* Tailwind uses classes like text-gray-400, text-gray-500, etc. When the page is in light mode
           these colors can appear washed out on light backgrounds. Override them with slightly darker
           hues for better contrast. */
        body.light-theme .text-gray-400 { color: #6b7280 !important; }
        body.light-theme .text-gray-500 { color: #6b7280 !important; }
        body.light-theme .text-gray-600 { color: #4b5563 !important; }
        body.light-theme .text-gray-700 { color: #374151 !important; }
        body.light-theme .text-gray-800 { color: #1f2937 !important; }

        /* Ensure hover states that use semi-transparent black are less intense in light mode */
        body.light-theme .hover\:bg-black\/5:hover { background-color: rgba(0, 0, 0, 0.05) !important; }
        body.light-theme .hover\:bg-black\/10:hover { background-color: rgba(0, 0, 0, 0.08) !important; }

        /* Override Tailwind white hover background utilities for light mode */
        body.light-theme .hover\:bg-white\/5:hover { background-color: rgba(0, 0, 0, 0.05) !important; }
        body.light-theme .hover\:bg-white\/10:hover { background-color: rgba(0, 0, 0, 0.08) !important; }


    /* Light theme overrides for glass backgrounds and sidebar */
    body.light-theme .glass {
        background: rgba(255, 255, 255, 0.6);
        border: 1px solid rgba(0,0,0,0.08);
    }
    body.light-theme .glass-strong {
        background: rgba(255, 255, 255, 0.95);
        border: 1px solid rgba(0,0,0,0.08);
    }
    body.light-theme .desktop-sidebar {
        background: var(--dark-3);
        color: #1a1a2e;
    }
    body.light-theme .desktop-sidebar .nav-item {
        /* Darker gray for text inside the light sidebar */
        color: #374151;
    }
    body.light-theme .desktop-sidebar .nav-item i {
        /* Use the primary brand colour for icons to stand out on the light sidebar */
        color: var(--primary);
    }
    body.light-theme .desktop-sidebar .nav-item:hover {
        background: rgba(0,0,0,0.05);
        color: #374151;
    }
    body.light-theme .desktop-sidebar .nav-item.active {
        background: linear-gradient(135deg, var(--primary), var(--accent));
        color: #ffffff;
    }
    body.light-theme .desktop-sidebar .nav-item.active i {
        color: #ffffff;
        }

        /* Mobile navigation bar styling in light mode */
        body.light-theme .mobile-nav {
            /* Match the light sidebar background */
            background: var(--dark-3);
            color: #374151;
        }
        body.light-theme .mobile-nav .nav-item {
            color: #374151;
        }
        body.light-theme .mobile-nav .nav-item i {
            color: var(--primary);
        }
        body.light-theme .mobile-nav .nav-item:hover {
            background: rgba(0,0,0,0.05);
        }
        body.light-theme .mobile-nav .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: #ffffff;
        }
        body.light-theme .mobile-nav .nav-item.active i {
            color: #ffffff;
        }

        body.light-theme .verified {
            /* adjust verified icon contrast in light mode */
            background: linear-gradient(135deg, var(--accent-2), #06b6d4);
        }
        
        .stat-card {
            background: linear-gradient(135deg, var(--dark-3), var(--dark-2));
        }
        
        .tier-bronze { border-color: #cd7f32; }
        .tier-silver { border-color: #c0c0c0; }
        .tier-gold { border-color: #ffd700; }
        
        @media (max-width: 768px) {
            .desktop-sidebar { display: none; }
            .mobile-nav { display: flex !important; }
            .main-content { padding-bottom: 80px; margin-left: 0 !important; }
            .masonry { column-count: 2; }
        }
        
        @media (min-width: 769px) {
            .mobile-nav { display: none !important; }
        }

        .page {
            display: none;
            animation: slideIn 0.3s ease;
        }
        .page.active { display: block; }

        .modal {
            display: none;
            animation: slideIn 0.3s ease;
        }
        .modal.active { display: flex; }

        .toast {
            animation: slideIn 0.3s ease;
        }

        .online-dot {
            width: 10px;
            height: 10px;
            background: #22c55e;
            border: 2px solid var(--dark-2);
            border-radius: 50%;
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            background: #888;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite both;
        }
        .typing-indicator span:nth-child(2) { animation-delay: 0.2s; }
        .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .image-preview {
            position: relative;
        }
        .image-preview img {
            max-height: 200px;
            border-radius: 12px;
            object-fit: cover;
        }
        .image-preview .remove-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0,0,0,0.7);
            border-radius: 50%;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        input[type="file"] { display: none; }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 4px;
            padding: 12px;
            background: var(--dark-3);
            border-radius: 12px;
            max-height: 200px;
            overflow-y: auto;
        }
        .emoji-picker span {
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            border-radius: 6px;
            text-align: center;
            transition: all 0.2s;
        }
        .emoji-picker span:hover {
            background: var(--dark-4);
            transform: scale(1.2);
        }

        .skeleton {
            background: linear-gradient(90deg, var(--dark-3) 25%, var(--dark-4) 50%, var(--dark-3) 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .progress-bar {
            height: 3px;
            background: linear-gradient(to right, var(--primary), var(--accent));
            transition: width 0.1s linear;
        }

        @keyframes storyProgress {
            from { width: 0%; }
            to { width: 100%; }
        }

        .story-viewer-controls {
            position: absolute;
            inset: 0;
            display: flex;
        }
        .story-viewer-controls > div {
            flex: 1;
            cursor: pointer;
        }
    </style>
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/legacy.css">
    <link rel="stylesheet" href="/css/styles.css">
</head>
<body class="min-h-screen">
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 right-4 z-[200] space-y-2"></div>

    <!-- Cookie Consent Banner -->
    <div id="cookie-banner" class="fixed bottom-4 left-4 right-4 z-[300] p-4 bg-dark-4/90 backdrop-blur-lg border border-white/10 rounded-xl flex flex-col md:flex-row items-center justify-between gap-4 hidden">
        <div class="flex-1">
            <p class="font-medium mb-1">This site uses cookies</p>
            <p class="text-sm text-gray-400">We use cookies to improve your experience and analyze traffic. By continuing, you agree to our privacy policy.</p>
        </div>
        <div class="flex gap-2 flex-shrink-0">
            <button onclick="declineCookies()" class="px-4 py-2 rounded-lg bg-white/10 hover:bg-white/20 transition-all text-sm">Decline</button>
            <button onclick="acceptCookies()" class="px-4 py-2 rounded-lg bg-gradient-to-r from-indigo-500 to-pink-500 font-medium text-sm">Accept</button>
        </div>
    </div>

    <!-- Background Effects -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden z-0">
        <div class="absolute top-1/4 -left-32 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl"></div>
        <div class="absolute top-3/4 -right-32 w-96 h-96 bg-pink-600/20 rounded-full blur-3xl"></div>
        <div class="absolute top-1/2 left-1/2 w-96 h-96 bg-cyan-600/10 rounded-full blur-3xl"></div>
    </div>

    <!-- Auth Screen -->
    <div id="auth-screen" class="fixed inset-0 z-[150] flex items-center justify-center bg-dark-1 p-4">
        <div class="w-full max-w-md">
            <!-- Logo -->
            <div class="text-center mb-8">
                <div class="w-20 h-20 mx-auto rounded-3xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center glow-primary mb-4 animate-float">
                    <span class="text-4xl font-black text-white">P</span>
                </div>
                <h1 class="text-4xl font-bold gradient-text mb-2">PASESO</h1>
                <p class="text-gray-400">All-in-One Social Platform</p>
            </div>

            <!-- Auth Forms -->
            <div class="glass-strong rounded-3xl p-6">
                <!-- Login Form -->
                <div id="login-form">
                    <h2 class="text-2xl font-bold mb-6 text-center">Welcome back!</h2>
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Email or Username</label>
                            <input type="text" id="login-email" placeholder="exemplu@email.com" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Password</label>
                            <div class="relative">
                                <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                                <button onclick="togglePassword('login-password')" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-white">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="flex items-center justify-between text-sm">
                            <label class="flex items-center gap-2 cursor-pointer">
                                <input type="checkbox" id="remember-me" class="w-4 h-4 rounded bg-white/5 border-white/10">
                                <span class="text-gray-400">Remember me</span>
                            </label>
                            <a href="#" class="text-purple-400 hover:text-purple-300">Forgot password?</a>
                        </div>
                        <button onclick="handleLogin()" class="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                            Log in
                        </button>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-gray-400">Don‚Äôt have an account? <button onclick="showRegister()" class="text-purple-400 hover:text-purple-300 font-medium">Sign up</button></p>
                    </div>
                    <div class="mt-6">
                        <div class="relative">
                            <div class="absolute inset-0 flex items-center"><div class="w-full border-t border-white/10"></div></div>
                            <div class="relative flex justify-center text-sm"><span class="px-4 bg-dark-2 text-gray-400">or continue with</span></div>
                        </div>
                        <div class="grid grid-cols-3 gap-3 mt-4">
                            <button class="flex items-center justify-center py-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                                <i class="fab fa-google text-xl"></i>
                            </button>
                            <button class="flex items-center justify-center py-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                                <i class="fab fa-apple text-xl"></i>
                            </button>
                            <button class="flex items-center justify-center py-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                                <i class="fab fa-facebook text-xl"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Register Form -->
                <div id="register-form" class="hidden">
                    <h2 class="text-2xl font-bold mb-6 text-center">Create an account</h2>
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">First Name</label>
                                <input type="text" id="reg-firstname" placeholder="Alex" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Last Name</label>
                                <input type="text" id="reg-lastname" placeholder="Johnson" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Username</label>
                            <div class="relative">
                                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400">@</span>
                                <input type="text" id="reg-username" placeholder="alexj" class="w-full pl-10 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Email</label>
                            <input type="email" id="reg-email" placeholder="alex@email.com" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Password</label>
                            <input type="password" id="reg-password" placeholder="Minimum 8 characters" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all">
                        </div>
                        <div class="flex items-start gap-2">
                            <input type="checkbox" id="agree-terms" class="w-4 h-4 mt-1 rounded bg-white/5 border-white/10">
                            <label for="agree-terms" class="text-sm text-gray-400">
                                I agree to the <a href="#" class="text-purple-400">Terms and Conditions</a> and <a href="#" class="text-purple-400">Privacy Policy</a>
                            </label>
                        </div>
                        <button onclick="handleRegister()" class="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                            Create Account
                        </button>
                    </div>
                    <div class="mt-6 text-center">
                        <p class="text-gray-400">Already have an account? <button onclick="showLogin()" class="text-purple-400 hover:text-purple-300 font-medium">Log in</button></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App -->
    <div id="main-app" class="hidden">
        <div class="flex min-h-screen relative z-10">
            <!-- Desktop Sidebar -->
            <aside class="desktop-sidebar fixed left-0 top-0 h-full w-20 xl:w-72 glass-strong z-50 flex flex-col py-6 px-3 xl:px-4">
                <!-- Logo -->
                <div class="flex items-center justify-center xl:justify-start gap-3 mb-8 px-2">
                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center glow-primary">
                        <span class="text-2xl font-black text-white">P</span>
                    </div>
                    <span class="hidden xl:block text-2xl font-bold gradient-text">PASESO</span>
                </div>

                <!-- Navigation -->
                <nav class="flex-1 space-y-2">
                    <button onclick="showPage('feed')" class="nav-item active w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="feed">
                        <i class="fas fa-home text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Feed</span>
                    </button>
                    <button onclick="showPage('explore')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="explore">
                        <i class="fas fa-compass text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Explore</span>
                    </button>
                    <button onclick="showPage('reels')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="reels">
                        <i class="fas fa-clapperboard text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Reels</span>
                    </button>
                    <button onclick="showPage('live')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group relative" data-page="live">
                        <i class="fas fa-broadcast-tower text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Live</span>
                        <span class="absolute top-2 left-8 xl:left-auto xl:right-4 w-2 h-2 rounded-full notif-dot"></span>
                    </button>
                    <button onclick="showPage('communities')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="communities">
                        <i class="fas fa-users text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Communities</span>
                    </button>
                    <!-- Marketplace, Rewards and About navigation -->
                    <button onclick="showPage('marketplace')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="marketplace">
                        <i class="fas fa-shopping-bag text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Marketplace</span>
                    </button>
                    <!-- Rewards button -->
                    <button onclick="showPage('rewards')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="rewards">
                        <i class="fas fa-coins text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Rewards</span>
                    </button>
                    <button onclick="showPage('about')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="about">
                        <i class="fas fa-info-circle text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">About</span>
                    </button>
                    <button onclick="showPage('investors')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="investors">
                        <i class="fas fa-handshake text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Investors</span>
                    </button>
                    <button onclick="showPage('creator')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="creator">
                        <i class="fas fa-gem text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Creator Hub</span>
                        <span class="hidden xl:inline-block ml-auto px-2 py-0.5 text-xs rounded-full premium-badge font-semibold">PRO</span>
                    </button>
                    <button onclick="showPage('messages')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group relative" data-page="messages">
                        <i class="fas fa-message text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Messages</span>
                        <span id="unread-messages-badge" class="absolute top-1 left-7 xl:left-auto xl:right-4 px-1.5 py-0.5 text-xs rounded-full bg-red-500 font-bold hidden">0</span>
                    </button>
                    <button onclick="showPage('notifications')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group relative" data-page="notifications">
                        <i class="fas fa-bell text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Notifications</span>
                        <span id="notif-badge" class="absolute top-1 left-7 xl:left-auto xl:right-4 px-1.5 py-0.5 text-xs rounded-full bg-red-500 font-bold hidden">0</span>
                    </button>

                    <!-- Leaderboard Navigation -->
                    <button onclick="showPage('leaderboard')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="leaderboard">
                        <i class="fas fa-trophy text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Leaderboard</span>
                    </button>
                    <button onclick="showPage('saved')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="saved">
                        <i class="fas fa-bookmark text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Saved</span>
                    </button>
                    <button onclick="showPage('settings')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group" data-page="settings">
                        <i class="fas fa-cog text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                        <span class="hidden xl:block font-medium">Settings</span>
                    </button>

                <!-- Admin Panel navigation (hidden by default, shown for admin/moderator) -->
                <button id="admin-nav" onclick="showPage('admin')" class="nav-item w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group hidden" data-page="admin">
                    <i class="fas fa-tools text-xl text-gray-400 group-hover:text-white w-6 text-center"></i>
                    <span class="hidden xl:block font-medium">Admin Panel</span>
                </button>
                </nav>

                <!-- Create Button -->
                <button onclick="openCreateModal()" class="w-full mt-4 py-3 rounded-xl bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500 font-semibold hover:opacity-90 transition-all hover-lift flex items-center justify-center gap-2">
                    <i class="fas fa-plus"></i>
                    <span class="hidden xl:inline">Create</span>
                </button>

                <!-- Profile -->
                <button onclick="showPage('profile')" class="nav-item mt-4 flex items-center gap-3 px-3 py-3 rounded-xl hover:bg-white/5 transition-all" data-page="profile">
                    <img id="sidebar-avatar" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100" class="w-10 h-10 rounded-full object-cover ring-2 ring-purple-500">
                    <div class="hidden xl:block text-left">
                        <p id="sidebar-name" class="font-semibold text-sm">Alex Johnson</p>
                        <p id="sidebar-username" class="text-xs text-gray-400">@alexj</p>
                    </div>
                </button>

                <!-- Logout -->
                <button onclick="handleLogout()" class="mt-2 flex items-center gap-3 px-4 py-2 rounded-xl hover:bg-red-500/10 text-red-400 transition-all">
                    <i class="fas fa-sign-out-alt w-6 text-center"></i>
                    <span class="hidden xl:block text-sm">Logout</span>
                </button>
            </aside>

            <!-- Main Content -->
            <main class="main-content flex-1 ml-0 md:ml-20 xl:ml-72">
                <!-- Header -->
                <header class="sticky top-0 z-40 glass-strong px-4 md:px-6 py-4">
                    <div class="flex items-center justify-between max-w-6xl mx-auto">
                        <div class="flex items-center gap-3 md:hidden">
                            <div class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500 flex items-center justify-center">
                                <span class="text-lg font-black">P</span>
                            </div>
                            <span class="text-xl font-bold gradient-text">PASESO</span>
                        </div>
                        <div class="hidden md:flex items-center gap-4 flex-1 max-w-xl">
                            <div class="relative flex-1">
                                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                                <input type="text" id="header-search" placeholder="Search PASESO..." class="w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all" onkeyup="handleSearch(event)">
                            </div>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="showPage('notifications')" class="relative w-10 h-10 rounded-xl bg-white/5 flex items-center justify-center hover:bg-white/10 transition-all">
                                <i class="fas fa-bell text-gray-300"></i>
                                <span id="header-notif-badge" class="absolute -top-1 -right-1 w-5 h-5 rounded-full bg-red-500 text-xs flex items-center justify-center font-bold hidden">0</span>
                            </button>
                            <button onclick="openCreateModal()" class="hidden md:flex items-center gap-2 px-4 py-2.5 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium hover:opacity-90 transition-all">
                                <i class="fas fa-plus"></i>
                                <span>Create</span>
                            </button>
                        </div>
                    </div>
                </header>

                <!-- Page Content Container -->
                <div id="page-container" class="max-w-6xl mx-auto px-4 md:px-6 py-6">
                    <!-- Pages will be rendered here dynamically -->
                </div>
            </main>
        </div>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-nav fixed bottom-0 left-0 right-0 glass-strong z-50 px-4 py-2 flex items-center justify-around">
            <button onclick="showPage('feed')" class="nav-item p-3 rounded-xl active" data-page="feed">
                <i class="fas fa-home text-xl"></i>
            </button>
            <button onclick="showPage('explore')" class="nav-item p-3 rounded-xl" data-page="explore">
                <i class="fas fa-compass text-xl"></i>
            </button>
            <!-- Marketplace button (mobile nav) -->
            <button onclick="showPage('marketplace')" class="nav-item p-3 rounded-xl" data-page="marketplace">
                <i class="fas fa-shopping-bag text-xl"></i>
            </button>

            <!-- Rewards button (mobile nav) -->
            <button onclick="showPage('rewards')" class="nav-item p-3 rounded-xl" data-page="rewards">
                <i class="fas fa-coins text-xl"></i>
            </button>

        <!-- Investors button (mobile nav) -->
        <button onclick="showPage('investors')" class="nav-item p-3 rounded-xl" data-page="investors">
            <i class="fas fa-handshake text-xl"></i>
        </button>

        <!-- Leaderboard button (mobile nav) -->
        <button onclick="showPage('leaderboard')" class="nav-item p-3 rounded-xl" data-page="leaderboard">
            <i class="fas fa-trophy text-xl"></i>
        </button>

        <!-- Admin Panel button (mobile nav, hidden by default) -->
        <button id="mobile-admin-nav" onclick="showPage('admin')" class="nav-item p-3 rounded-xl hidden" data-page="admin">
            <i class="fas fa-tools text-xl"></i>
        </button>
            <button onclick="openCreateModal()" class="p-3 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500">
                <i class="fas fa-plus text-xl"></i>
            </button>
            <button onclick="showPage('messages')" class="nav-item p-3 rounded-xl relative" data-page="messages">
                <i class="fas fa-message text-xl"></i>
                <span id="mobile-msg-badge" class="absolute top-1 right-1 w-4 h-4 rounded-full bg-red-500 text-xs flex items-center justify-center font-bold hidden">0</span>
            </button>
            <button onclick="showPage('profile')" class="nav-item p-3 rounded-xl" data-page="profile">
                <img id="mobile-avatar" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100" class="w-7 h-7 rounded-full object-cover">
            </button>
        </nav>
    </div>

    <!-- Create Modal -->
    <div id="create-modal" class="modal fixed inset-0 z-[100] items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="glass-strong rounded-3xl w-full max-w-2xl max-h-[90vh] overflow-y-auto p-6 relative">
            <button onclick="closeCreateModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6">Create New Post</h2>
            
            <div class="flex items-center gap-3 mb-4">
                <img id="create-avatar" src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100" class="w-12 h-12 rounded-full object-cover">
                <div>
                    <p id="create-name" class="font-semibold">Alex Johnson</p>
                    <select id="post-visibility" class="text-sm bg-white/5 rounded-lg px-2 py-1 border border-white/10">
                        <!-- Use modern icons for visibility options -->
                        <option value="public">üåê Public</option>
                        <option value="followers">üßë‚Äçü§ù‚Äçüßë Followers</option>
                        <option value="private">üîê Private</option>
                    </select>
                </div>
            </div>

            <textarea id="post-content" placeholder="What's on your mind?" class="w-full h-32 bg-white/5 rounded-xl p-4 resize-none focus:outline-none focus:ring-2 focus:ring-purple-500 mb-4" maxlength="500"></textarea>
            <p class="text-right text-sm text-gray-400 mb-4"><span id="char-count">0</span>/500</p>

            <!-- Image Preview -->
            <div id="image-preview-container" class="mb-4 hidden">
                <div class="image-preview inline-block">
                    <img id="preview-image" src="" alt="Preview">
                    <button onclick="removeImage()" class="remove-btn"><i class="fas fa-times"></i></button>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex items-center justify-between border-t border-white/10 pt-4">
                <div class="flex gap-2">
                    <input type="file" id="image-upload" accept="image/*" onchange="handleImageUpload(event)">
                    <button onclick="document.getElementById('image-upload').click()" class="flex items-center gap-2 px-4 py-2 rounded-xl hover:bg-white/5 text-gray-400 hover:text-green-400 transition-all">
                        <i class="fas fa-image"></i>
                        <span class="hidden sm:inline">Photo</span>
                    </button>
                    <button class="flex items-center gap-2 px-4 py-2 rounded-xl hover:bg-white/5 text-gray-400 hover:text-blue-400 transition-all" onclick="toggleEmojiPicker()">
                        <i class="fas fa-smile"></i>
                        <span class="hidden sm:inline">Emoji</span>
                    </button>
                    <button class="flex items-center gap-2 px-4 py-2 rounded-xl hover:bg-white/5 text-gray-400 hover:text-purple-400 transition-all">
                        <i class="fas fa-poll"></i>
                        <span class="hidden sm:inline">Poll</span>
                    </button>
                </div>
                <button onclick="createPost()" class="px-6 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                    Post
                </button>
            </div>

            <!-- Emoji Picker -->
            <div id="emoji-picker" class="hidden mt-4 emoji-picker">
                <!-- Emojis will be added by JS -->
            </div>
        </div>
    </div>

    <!-- Story Viewer Modal -->
    <div id="story-modal" class="modal fixed inset-0 z-[100] items-center justify-center bg-black/95 p-4">
        <button onclick="closeStoryViewer()" class="absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
            <i class="fas fa-times text-xl"></i>
        </button>
        <div class="relative w-full max-w-md aspect-[9/16] rounded-2xl overflow-hidden">
            <div id="story-progress" class="absolute top-4 left-4 right-4 flex gap-1 z-10"></div>
            <img id="story-image" src="" class="w-full h-full object-cover">
            <div class="absolute inset-0 bg-gradient-to-t from-black/60 via-transparent to-black/30"></div>
            <div class="absolute top-12 left-4 flex items-center gap-3">
                <img id="story-user-img" src="" class="w-10 h-10 rounded-full object-cover ring-2 ring-white">
                <div>
                    <p id="story-username" class="font-semibold"></p>
                    <p id="story-time" class="text-sm text-gray-300"></p>
                </div>
            </div>
            <button onclick="prevStory()" class="absolute left-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                <i class="fas fa-chevron-left"></i>
            </button>
            <button onclick="nextStory()" class="absolute right-4 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                <i class="fas fa-chevron-right"></i>
            </button>
            <div class="absolute bottom-4 left-4 right-4 flex gap-2">
                <input type="text" id="story-reply" placeholder="Send a message..." class="flex-1 px-4 py-3 rounded-full bg-white/10 backdrop-blur-sm border border-white/20 focus:outline-none focus:border-white/40">
                <button onclick="sendStoryReply()" class="w-12 h-12 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 flex items-center justify-center">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Create Story Modal -->
    <div id="create-story-modal" class="modal fixed inset-0 z-[100] items-center justify-center bg-black/95 p-4">
        <div class="w-full max-w-md">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-bold">Create Story</h2>
                <button onclick="closeCreateStoryModal()" class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="relative aspect-[9/16] rounded-2xl overflow-hidden bg-dark-3 flex items-center justify-center">
                <img id="story-preview-image" src="" class="hidden w-full h-full object-cover">
                <div id="story-upload-placeholder" class="text-center">
                    <input type="file" id="story-image-upload" accept="image/*" onchange="handleStoryImageUpload(event)">
                    <button onclick="document.getElementById('story-image-upload').click()" class="w-20 h-20 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 flex items-center justify-center mb-4 mx-auto hover:opacity-90 transition-all">
                        <i class="fas fa-camera text-3xl"></i>
                    </button>
                    <p class="text-gray-400">Click to add a photo</p>
                </div>
            </div>
            <div class="mt-4 flex gap-3">
                <input type="text" id="story-caption" placeholder="Add a caption..." class="flex-1 px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                <button onclick="publishStory()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                    Share
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="edit-profile-modal" class="modal fixed inset-0 z-[100] items-center justify-center bg-black/80 backdrop-blur-sm p-4">
        <div class="glass-strong rounded-3xl w-full max-w-lg max-h-[90vh] overflow-y-auto p-6 relative">
            <button onclick="closeEditProfileModal()" class="absolute top-4 right-4 w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                <i class="fas fa-times text-xl"></i>
            </button>
            <h2 class="text-2xl font-bold mb-6">Edit Profile</h2>
            
            <div class="text-center mb-6">
                <div class="relative inline-block">
                    <img id="edit-avatar-preview" src="" class="w-24 h-24 rounded-full object-cover">
                    <input type="file" id="avatar-upload" accept="image/*" onchange="handleAvatarUpload(event)">
                    <button onclick="document.getElementById('avatar-upload').click()" class="absolute bottom-0 right-0 w-8 h-8 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 flex items-center justify-center">
                        <i class="fas fa-camera text-sm"></i>
                    </button>
                </div>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">First Name</label>
                        <input type="text" id="edit-firstname" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                    </div>
                    <div>
                        <label class="block text-sm text-gray-400 mb-2">Last Name</label>
                        <input type="text" id="edit-lastname" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                    </div>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Bio</label>
                    <textarea id="edit-bio" rows="3" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none resize-none" maxlength="160"></textarea>
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Location</label>
                    <input type="text" id="edit-location" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                </div>
                <div>
                    <label class="block text-sm text-gray-400 mb-2">Website</label>
                    <input type="url" id="edit-website" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                </div>
                <button onclick="saveProfile()" class="w-full py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                    Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- User Profile Modal (for viewing other users) -->
    <div id="user-profile-modal" class="modal fixed inset-0 z-[100] items-center justify-center bg-black/80 backdrop-blur-sm p-4 overflow-y-auto">
        <div class="glass-strong rounded-3xl w-full max-w-2xl my-8 relative">
            <button onclick="closeUserProfileModal()" class="absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                <i class="fas fa-times text-xl"></i>
            </button>
            <div id="user-profile-content">
                <!-- Will be populated by JS -->
            </div>
        </div>
    </div>

    <script>
    // ==================== DATA STORE ====================
    const DEFAULT_AVATAR = 'https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?w=100';
    const EMOJIS = ['üòÄ','üòÇ','ü•∞','üòé','ü§©','üòç','ü•≥','üòä','üëç','‚ù§Ô∏è','üî•','üíØ','‚ú®','üéâ','üöÄ','üí™','üôå','üëè','üíï','üòò','ü§ó','üòá','üåü','‚≠ê','üíñ','üé®','üì∏','üéµ','üé¨','üíª','üåà','‚òÄÔ∏è','üåô','üçï','üéÇ','üèÜ','üëë','üíé','ü¶ã','üå∏'];

    let currentUser = null;
    let posts = [];
    let stories = [];
    let users = [];
    let messages = [];
    let notifications = [];
    let marketplaceItems = [];
    // Holds posts for each community. Populated by loadData() or default values.
    let communityPosts = {};
    let currentStoryIndex = 0;
    let currentStoryUserIndex = 0;
    let storyTimer = null;
    let pendingImage = null;
    let pendingStoryImage = null;

    // ==================== INITIALIZATION ====================
    function init() {
        loadData();
        // Apply the saved theme and cookie consent at startup
        applyTheme();
        checkCookieConsent();
        checkAuth();
        initEmojiPicker();
        setupEventListeners();
    }

    function loadData() {
        currentUser = JSON.parse(localStorage.getItem('paseso_user'));
        // Prefer saved posts when they contain at least as many items as the defaults;
        // otherwise fall back to the default dataset. This ensures that new
        // installations load the richer demo content while preserving user
        // posts in subsequent sessions.
        {
            const savedPosts = JSON.parse(localStorage.getItem('paseso_posts'));
            const defaultPosts = getDefaultPosts();
            posts = (Array.isArray(savedPosts) && savedPosts.length >= defaultPosts.length) ? savedPosts : defaultPosts;
        }
        stories = JSON.parse(localStorage.getItem('paseso_stories')) || getDefaultStories();
        {
            const savedUsers = JSON.parse(localStorage.getItem('paseso_users'));
            const defaultUsers = getDefaultUsers();
            users = (Array.isArray(savedUsers) && savedUsers.length >= defaultUsers.length) ? savedUsers : defaultUsers;
        }
        // Load messages from local storage or fall back to the default set. Having
        // predefined messages helps populate the Messages page for testing,
        // especially when there is no existing chat history.
        messages = JSON.parse(localStorage.getItem('paseso_messages')) || getDefaultMessages();
        notifications = JSON.parse(localStorage.getItem('paseso_notifications')) || getDefaultNotifications();

        // Load marketplace items or fall back to defaults. If saved items exist and match the default length or greater, use saved items to preserve user modifications.
        {
            const savedItems = JSON.parse(localStorage.getItem('paseso_marketplace'));
            const defaultItems = getDefaultMarketplaceItems();
            marketplaceItems = (Array.isArray(savedItems) && savedItems.length >= defaultItems.length) ? savedItems : defaultItems;
        }

        // Load community posts or fall back to default posts per community. This allows
        // persistent posts for each community and ensures the community feeds are
        // always populated even on a fresh install.
        {
            const savedCommunity = JSON.parse(localStorage.getItem('paseso_community_posts'));
            const defaultCommunity = getDefaultCommunityPosts();
            if (savedCommunity && typeof savedCommunity === 'object' && Object.keys(savedCommunity).length >= Object.keys(defaultCommunity).length) {
                communityPosts = savedCommunity;
            } else {
                communityPosts = defaultCommunity;
            }
        }
    }

    function saveData() {
        localStorage.setItem('paseso_posts', JSON.stringify(posts));
        localStorage.setItem('paseso_stories', JSON.stringify(stories));
        localStorage.setItem('paseso_users', JSON.stringify(users));
        localStorage.setItem('paseso_messages', JSON.stringify(messages));
        localStorage.setItem('paseso_notifications', JSON.stringify(notifications));
        if (currentUser) {
            localStorage.setItem('paseso_user', JSON.stringify(currentUser));
        }
        localStorage.setItem('paseso_marketplace', JSON.stringify(marketplaceItems));

        // Persist community posts to local storage so that modifications via the admin
        // panel or user interactions (if implemented in future) are saved across sessions.
        localStorage.setItem('paseso_community_posts', JSON.stringify(communityPosts));
    }

    /**
     * Extract hashtags from a post's content. A hashtag is any word beginning
     * with the # character followed by alphanumeric characters or underscores.
     * This helper returns an array of lowercase hashtags including the #.
     *
     * @param {string} content The content string to parse.
     * @returns {string[]} Array of detected hashtags.
     */
    function extractHashtags(content) {
        if (!content) return [];
        const regex = /#(\w+)/g;
        const tags = [];
        let match;
        while ((match = regex.exec(content)) !== null) {
            tags.push('#' + match[1].toLowerCase());
        }
        return tags;
    }

    /**
     * Generate a list of trending topics by scanning all posts and counting
     * occurrences of hashtags within their content. The resulting array is
     * sorted in descending order by count and limited to a maximum number of
     * items. If no hashtags are discovered across the posts dataset, a
     * fallback list of forward‚Äëlooking topics is returned so that the UI
     * always displays something meaningful.
     *
     * @param {number} limit The maximum number of topics to return (default 5).
     * @returns {{tag: string, count: number}[]} An array of trending topics.
     */
    function getTrendingTopics(limit = 5) {
        const counts = {};
        posts.forEach(post => {
            const tags = extractHashtags(post.content);
            tags.forEach(tag => {
                counts[tag] = (counts[tag] || 0) + 1;
            });
        });
        let sorted = Object.entries(counts).sort((a, b) => b[1] - a[1]);
        if (sorted.length === 0) {
            const fallback = [
                { tag: '#AIRevolution', count: 0 },
                { tag: '#QuantumComputing', count: 0 },
                { tag: '#Web2026', count: 0 },
                { tag: '#RenewableEnergy', count: 0 },
                { tag: '#HealthTech', count: 0 }
            ];
            return fallback.slice(0, limit);
        }
        return sorted.slice(0, limit).map(([tag, count]) => ({ tag, count }));
    }

    /**
     * Get the top posts by like count. Returns the first `limit` posts sorted
     * in descending order based on their number of likes. If no posts are
     * available, returns an empty array. This helper is used to populate
     * the "Top Posts" section in the trending sidebar to showcase the
     * most engaging content across the platform.
     * @param {number} limit Number of top posts to return
     * @returns {Array<Object>} An array of post objects
     */
    function getTopPosts(limit = 5) {
        if (!Array.isArray(posts) || posts.length === 0) return [];
        // Create a shallow copy to avoid mutating the original posts array
        const sorted = [...posts].sort((a, b) => (b.likes || 0) - (a.likes || 0));
        return sorted.slice(0, limit);
    }

    /**
     * Get the top users by accumulated points. Returns the first `limit`
     * users sorted in descending order based on their `points` property.
     * If no users are available, returns an empty array. This helper is
     * used to populate the "Top Users" section in the trending sidebar.
     * @param {number} limit Number of top users to return
     * @returns {Array<Object>} An array of user objects
     */
    function getTopUsers(limit = 5) {
        if (!Array.isArray(users) || users.length === 0) return [];
        const sorted = [...users].sort((a, b) => (b.points || 0) - (a.points || 0));
        return sorted.slice(0, limit);
    }

    function checkAuth() {
        if (currentUser) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            updateUserUI();
            showPage('feed');
        }
    }

    function setupEventListeners() {
        document.getElementById('post-content')?.addEventListener('input', (e) => {
            document.getElementById('char-count').textContent = e.target.value.length;
        });

        document.addEventListener('keydown', (e) => {
            if (document.getElementById('story-modal').classList.contains('active')) {
                if (e.key === 'ArrowRight') nextStory();
                if (e.key === 'ArrowLeft') prevStory();
                if (e.key === 'Escape') closeStoryViewer();
            }
            if (e.key === 'Escape') {
                closeCreateModal();
                closeEditProfileModal();
                closeUserProfileModal();
                closeCreateStoryModal();
            }
        });

        // Close modals on backdrop click
        ['create-modal', 'story-modal', 'edit-profile-modal', 'user-profile-modal', 'create-story-modal'].forEach(id => {
            document.getElementById(id)?.addEventListener('click', (e) => {
                if (e.target.id === id) {
                    if (id === 'create-modal') closeCreateModal();
                    else if (id === 'story-modal') closeStoryViewer();
                    else if (id === 'edit-profile-modal') closeEditProfileModal();
                    else if (id === 'user-profile-modal') closeUserProfileModal();
                    else if (id === 'create-story-modal') closeCreateStoryModal();
                }
            });
        });
    }

    // ==================== THEME & COOKIE CONSENT ====================
    /**
     * Apply the current appearance setting by toggling the light theme class.
     * Defaults to dark if no setting is stored.
     */
    function applyTheme() {
        const theme = (settingsData && settingsData.appearance) || 'dark';
        document.body.classList.toggle('light-theme', theme === 'light');
    }

    /**
     * Display or hide the cookie consent banner depending on stored preference.
     */
    function checkCookieConsent() {
        const consent = localStorage.getItem('paseso_cookie_consent');
        const banner = document.getElementById('cookie-banner');
        if (!banner) return;
        if (!consent) {
            banner.classList.remove('hidden');
        } else {
            banner.classList.add('hidden');
        }
    }

    /**
     * Accept cookies: store consent and hide the banner.
     */
    function acceptCookies() {
        localStorage.setItem('paseso_cookie_consent', 'accepted');
        const banner = document.getElementById('cookie-banner');
        if (banner) banner.classList.add('hidden');
        showToast('Thank you! Your preferences have been saved.', 'success');
    }

    /**
     * Decline cookies: store preference and hide the banner.
     */
    function declineCookies() {
        localStorage.setItem('paseso_cookie_consent', 'declined');
        const banner = document.getElementById('cookie-banner');
        if (banner) banner.classList.add('hidden');
        showToast('You chose to decline cookies. Some features may be limited.', 'info');
    }

    // ==================== DEFAULT DATA ====================
    function getDefaultUsers() {
        return [
            { id: 'u1', username: 'sarah_m', name: 'Sarah Mitchell', avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200', bio: 'Digital artist & designer ‚ú®', followers: 125000, following: 890, verified: true, online: true, points: 0 },
            { id: 'u2', username: 'mike_dev', name: 'Mike Chen', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200', bio: 'Full-stack developer üíª', followers: 45000, following: 320, verified: true, online: true, points: 0 },
            { id: 'u3', username: 'emma_art', name: 'Emma Wilson', avatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200', bio: 'Photography & Art üì∏', followers: 89000, following: 450, verified: false, online: false, points: 0 },
            { id: 'u4', username: 'james_k', name: 'James Kennedy', avatar: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=200', bio: 'Musician & Producer üéµ', followers: 234000, following: 150, verified: true, online: true, points: 0 },
            { id: 'u5', username: 'lily_v', name: 'Lily Valentine', avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200', bio: 'Travel & Lifestyle ‚úàÔ∏è', followers: 567000, following: 280, verified: true, online: false, points: 0 },
            // Additional sample users for a richer experience
            { id: 'u6', username: 'alexandra_d', name: 'Alexandra Dumitru', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=200', bio: 'Fitness coach & Nutrition üçéüèãÔ∏è‚Äç‚ôÄÔ∏è', followers: 145000, following: 300, verified: true, online: false, points: 0 },
            { id: 'u7', username: 'lucas_g', name: 'Lucas Garcia', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7d?w=200', bio: 'Travel photographer üì∑‚úàÔ∏èüåç', followers: 85000, following: 200, verified: false, online: true, points: 0 },
            { id: 'u8', username: 'mia_s', name: 'Mia Schneider', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7f?w=200', bio: 'Tech enthusiast & blogger üß†üí°', followers: 50000, following: 150, verified: false, online: true, points: 0, role: 'moderator' },
            { id: 'u9', username: 'daniel_k', name: 'Daniel Kim', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7c?w=200', bio: 'Chef & Food lover üç£üçú', followers: 125000, following: 400, verified: true, online: true, points: 0, role: 'helper' },
            { id: 'u10', username: 'ana_m', name: 'Ana Martinez', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7b?w=200', bio: 'Music lover & dancer üé§üíÉ', followers: 97000, following: 320, verified: false, online: false, points: 0 },
            // Demo users for specific testing
            { id: 'ion', username: 'ion', email: 'ion@paseso.com', password: '123456', name: 'Ion', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7a?w=200', bio: 'Default user for demo', followers: 0, following: 0, verified: false, online: false, role: 'user', premium: false, points: 0 },
            { id: 'admin', username: 'admin', email: 'admin@paseso.com', password: 'neverback2026', name: 'Admin', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb70?w=200', bio: 'Platform administrator', followers: 0, following: 0, verified: false, online: false, role: 'admin', premium: false, points: 0 }
        ];
    }

    function getDefaultPosts() {
        return [
            {
                id: 'p1',
                userId: 'u1',
                username: 'sarah_m',
                userAvatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200',
                userName: 'Sarah Mitchell',
                verified: true,
                content: 'Just launched my new collection! üé®‚ú® Can\'t wait to share all the details with you. Check out the link in my bio! #art #design #creative',
                image: 'https://images.unsplash.com/photo-1579783902614-a3fb3927b6a5?w=800',
                likes: 2456,
                likedBy: [],
                comments: [
                    { id: 'c1', userId: 'u2', username: 'mike_dev', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100', content: 'This is absolutely stunning! üî•', time: '1h ago' }
                ],
                shares: 89,
                saved: false,
                time: Date.now() - 7200000,
                visibility: 'public'
            },
            {
                id: 'p2',
                userId: 'u2',
                username: 'mike_dev',
                userAvatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200',
                userName: 'Mike Chen',
                verified: true,
                content: 'Finally finished my side project! üöÄ 6 months of hard work. Building in public is the way to go. #coding #developer #startup',
                image: 'https://images.unsplash.com/photo-1555066931-4365d14bab8c?w=800',
                likes: 1823,
                likedBy: [],
                comments: [],
                shares: 156,
                saved: false,
                time: Date.now() - 14400000,
                visibility: 'public'
            },
            {
                id: 'p3',
                userId: 'u4',
                username: 'james_k',
                userAvatar: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=200',
                userName: 'James Kennedy',
                verified: true,
                content: 'New track dropping tonight at midnight! üéµüî• Who\'s ready?',
                image: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=800',
                likes: 5678,
                likedBy: [],
                comments: [],
                shares: 432,
                saved: false,
                time: Date.now() - 21600000,
                visibility: 'public'
            },
            // Additional sample posts to enrich the feed and trending algorithms
            {
                id: 'p4',
                userId: 'u5',
                username: 'lily_v',
                userAvatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200',
                userName: 'Lily Valentine',
                verified: true,
                content: 'Exploring the streets of Paris this summer! üóºüå∏ #travel #paris #wanderlust',
                image: 'https://images.unsplash.com/photo-1502602898657-3e91760cbb34?w=800',
                likes: 3456,
                likedBy: [],
                comments: [
                    { id: 'c4_1', userId: 'u1', username: 'sarah_m', avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100', content: 'Paris looks amazing! üíñ', time: '2h ago' }
                ],
                shares: 210,
                saved: false,
                time: Date.now() - 36000000,
                visibility: 'public'
            },
            {
                id: 'p5',
                userId: 'u6',
                username: 'alexandra_d',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=200',
                userName: 'Alexandra Dumitru',
                verified: true,
                content: 'Morning workout done! Feeling energized üí™üèÉ‚Äç‚ôÄÔ∏è #fitness #health #motivation',
                image: 'https://images.unsplash.com/photo-1558611848-73f7eb4001f8?auto=format&fit=crop&w=800&q=80',
                likes: 2870,
                likedBy: [],
                comments: [
                    { id: 'c5_1', userId: 'u7', username: 'lucas_g', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7d?w=100', content: 'Great job! Keep it up üí•', time: '3h ago' }
                ],
                shares: 90,
                saved: false,
                time: Date.now() - 43200000,
                visibility: 'public'
            },
            {
                id: 'p6',
                userId: 'u7',
                username: 'lucas_g',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7d?w=200',
                userName: 'Lucas Garcia',
                verified: false,
                content: 'Capturing the golden hour in Bali üåÖüì∏ #photography #travel #bali',
                image: 'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=800',
                likes: 1670,
                likedBy: [],
                comments: [
                    { id: 'c6_1', userId: 'u5', username: 'lily_v', avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=100', content: 'This view is breathtaking! üòç', time: '4h ago' }
                ],
                shares: 120,
                saved: false,
                time: Date.now() - 54000000,
                visibility: 'public'
            },
            {
                id: 'p7',
                userId: 'u8',
                username: 'mia_s',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7f?w=200',
                userName: 'Mia Schneider',
                verified: false,
                content: 'Just got my hands on the new VR headset ‚Äì mind blown ü§Ø #tech #vr #future',
                image: 'https://images.unsplash.com/photo-1518773553398-650c184e0bb3?w=800',
                likes: 980,
                likedBy: [],
                comments: [
                    { id: 'c7_1', userId: 'u2', username: 'mike_dev', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100', content: 'I need one too! ü§ñ', time: '5h ago' }
                ],
                shares: 70,
                saved: false,
                time: Date.now() - 64800000,
                visibility: 'public'
            },
            {
                id: 'p8',
                userId: 'u9',
                username: 'daniel_k',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7c?w=200',
                userName: 'Daniel Kim',
                verified: true,
                content: 'Trying out a new sushi recipe üç£üí´ Who wants some? #foodie #sushi #cooking',
                image: 'https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=800',
                likes: 2050,
                likedBy: [],
                comments: [
                    { id: 'c8_1', userId: 'u10', username: 'ana_m', avatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7b?w=100', content: 'Looks delicious! ü§§', time: '6h ago' }
                ],
                shares: 50,
                saved: false,
                time: Date.now() - 72000000,
                visibility: 'public'
            },
            {
                id: 'p9',
                userId: 'u10',
                username: 'ana_m',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7b?w=200',
                userName: 'Ana Martinez',
                verified: false,
                content: 'Practicing my dance routine üíÉüé∂ #dance #music #passion',
                image: 'https://images.unsplash.com/photo-1514516870926-205989b8a91c?w=800',
                likes: 1420,
                likedBy: [],
                comments: [
                    { id: 'c9_1', userId: 'u4', username: 'james_k', avatar: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=100', content: 'You\'ve got moves! üíÉüî•', time: '7h ago' }
                ],
                shares: 60,
                saved: false,
                time: Date.now() - 79200000,
                visibility: 'public'
            },
            {
                id: 'p10',
                userId: 'u3',
                username: 'emma_art',
                userAvatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200',
                userName: 'Emma Wilson',
                verified: false,
                content: 'Weekend getaway in the mountains üåÑ So peaceful! #hiking #nature #relax',
                image: 'https://images.unsplash.com/photo-1500530855697-b586d89ba3ee?w=800',
                likes: 1875,
                likedBy: [],
                comments: [
                    { id: 'c10_1', userId: 'u5', username: 'lily_v', avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=100', content: 'Need to go there! üå≤‚ú®', time: '8h ago' }
                ],
                shares: 100,
                saved: false,
                time: Date.now() - 86400000,
                visibility: 'public'
            },
            // New trending posts for a richer feed and gamification experience
            {
                id: 'p11',
                userId: 'u6',
                username: 'alexandra_d',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=200',
                userName: 'Alexandra Dumitru',
                verified: true,
                content: 'Exploring the power of artificial intelligence and machine learning in 2026. The future is here! #AI #MachineLearning #Innovation',
                image: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=800&q=80',
                likes: 3210,
                likedBy: [],
                comments: [
                    { id: 'c11_1', userId: 'u1', username: 'sarah_m', avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=100', content: 'AI is changing the world! ü§ñ', time: '1h ago' }
                ],
                shares: 200,
                saved: false,
                time: Date.now() - 5400000,
                visibility: 'public'
            },
            {
                id: 'p12',
                userId: 'u7',
                username: 'lucas_g',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7d?w=200',
                userName: 'Lucas Garcia',
                verified: false,
                content: 'Taking a stand for our planet! üåçüíö #ClimateAction #Sustainability #GreenEnergy',
                image: 'https://images.unsplash.com/photo-1516910915608-5c6c5e7c84a8?auto=format&fit=crop&w=800&q=80',
                likes: 2890,
                likedBy: [],
                comments: [
                    { id: 'c12_1', userId: 'u5', username: 'lily_v', avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=100', content: 'Love this! üå±', time: '2h ago' }
                ],
                shares: 150,
                saved: false,
                time: Date.now() - 7200000,
                visibility: 'public'
            },
            {
                id: 'p13',
                userId: 'u8',
                username: 'mia_s',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7f?w=200',
                userName: 'Mia Schneider',
                verified: false,
                content: 'Dreaming of the stars ‚ú®ü™ê #SpaceExploration #Galaxy #NASA',
                image: 'https://images.unsplash.com/photo-1526506118085-60ce8714f8f9?auto=format&fit=crop&w=800&q=80',
                likes: 2345,
                likedBy: [],
                comments: [
                    { id: 'c13_1', userId: 'u2', username: 'mike_dev', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=100', content: 'To infinity and beyond! üöÄ', time: '3h ago' }
                ],
                shares: 120,
                saved: false,
                time: Date.now() - 9000000,
                visibility: 'public'
            },
            {
                id: 'p14',
                userId: 'u9',
                username: 'daniel_k',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7c?w=200',
                userName: 'Daniel Kim',
                verified: true,
                content: 'Immersed in a virtual world ü§ØüéÆ #VirtualReality #Tech #Gaming',
                image: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?auto=format&fit=crop&w=800&q=80',
                likes: 1980,
                likedBy: [],
                comments: [
                    { id: 'c14_1', userId: 'u3', username: 'emma_art', avatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=100', content: 'That looks so cool! üòé', time: '4h ago' }
                ],
                shares: 110,
                saved: false,
                time: Date.now() - 10800000,
                visibility: 'public'
            },
            {
                id: 'p15',
                userId: 'u10',
                username: 'ana_m',
                userAvatar: 'https://images.unsplash.com/photo-1529626455594-4ff0802cfb7b?w=200',
                userName: 'Ana Martinez',
                verified: false,
                content: 'What songs are on your playlist this week? üéß‚ú® #NewMusic #Hits #TopCharts',
                image: 'https://images.unsplash.com/photo-1493857671505-72967adf9a54?auto=format&fit=crop&w=800&q=80',
                likes: 1750,
                likedBy: [],
                comments: [
                    { id: 'c15_1', userId: 'u4', username: 'james_k', avatar: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=100', content: 'Check out my latest track! üé∂', time: '5h ago' }
                ],
                shares: 95,
                saved: false,
                time: Date.now() - 12600000,
                visibility: 'public'
            }
        ];
    }

    function getDefaultStories() {
        return [
            { id: 's1', userId: 'u1', username: 'sarah_m', avatar: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=200', image: 'https://images.unsplash.com/photo-1488161628813-04466f872be2?w=800', time: Date.now() - 3600000, seen: false, caption: 'Beautiful day! ‚òÄÔ∏è' },
            { id: 's2', userId: 'u2', username: 'mike_dev', avatar: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=200', image: 'https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=800', time: Date.now() - 7200000, seen: false, caption: 'Coding vibes üíª' },
            { id: 's3', userId: 'u4', username: 'james_k', avatar: 'https://images.unsplash.com/photo-1539571696357-5a69c17a67c6?w=200', image: 'https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=800', time: Date.now() - 10800000, seen: false, caption: 'Studio session üéµ', isLive: true },
            { id: 's4', userId: 'u3', username: 'emma_art', avatar: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=200', image: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=800', time: Date.now() - 14400000, seen: true, caption: 'Food art üçï' },
            { id: 's5', userId: 'u5', username: 'lily_v', avatar: 'https://images.unsplash.com/photo-1517841905240-472988babdf9?w=200', image: 'https://images.unsplash.com/photo-1469474968028-56623f02e42e?w=800', time: Date.now() - 18000000, seen: false, caption: 'Nature escape üå≤' }
        ];
    }

    function getDefaultNotifications() {
        return [
            { id: 'n1', type: 'like', userId: 'u1', message: 'liked your post', time: Date.now() - 120000, read: false },
            { id: 'n2', type: 'comment', userId: 'u2', message: 'commented: "This is awesome!"', time: Date.now() - 600000, read: false },
            { id: 'n3', type: 'follow', userId: 'u3', message: 'started following you', time: Date.now() - 3600000, read: false },
            { id: 'n4', type: 'live', userId: 'u4', message: 'went live: "Music Session"', time: Date.now() - 7200000, read: true }
        ];
    }

    /**
     * Provide a set of sample direct messages between various users. Each message
     * contains a unique id, sender (fromId), recipient (toId), plain text
     * content, timestamp and a read flag. These messages are used to populate
     * the Messages page on first load so that the conversations list and chat
     * UI appear active without requiring actual users. Feel free to extend
     * or modify this dataset for further testing.
     */
    function getDefaultMessages() {
        const now = Date.now();
        return [
            { id: 'm1', fromId: 'u2', toId: 'u1', content: 'Hey Sarah, have you seen my side project? üöÄ', time: now - 2700000, read: false },
            { id: 'm2', fromId: 'u1', toId: 'u2', content: 'Hi Mike, yes! It\'s awesome, congrats! üéâ', time: now - 2400000, read: false },
            { id: 'm3', fromId: 'u5', toId: 'u4', content: 'Can\'t wait for your new track tonight! üî•', time: now - 10800000, read: false },
            { id: 'm4', fromId: 'u4', toId: 'u5', content: 'Thanks Lily! Hope you tune in üéµ', time: now - 10500000, read: false },
            { id: 'm5', fromId: 'u6', toId: 'u1', content: 'Sarah, your art inspires my workouts! üí™üé®', time: now - 5400000, read: false },
            { id: 'm6', fromId: 'u1', toId: 'u6', content: 'Thank you Alexandra! Keep pushing üíñ', time: now - 4800000, read: false },
            { id: 'm7', fromId: 'u7', toId: 'u8', content: 'Have you tried the new VR headset yet? üï∂Ô∏è', time: now - 18000000, read: true },
            { id: 'm8', fromId: 'u8', toId: 'u7', content: 'Yes! It\'s mind blowing! ü§Ø', time: now - 17700000, read: true },
            { id: 'm9', fromId: 'u9', toId: 'u10', content: 'Let\'s collaborate on a food + dance video! üç£üíÉ', time: now - 21600000, read: false },
            { id: 'm10', fromId: 'u10', toId: 'u9', content: 'Sounds fun! I\'m in üòä', time: now - 21300000, read: false },
            { id: 'm11', fromId: 'u3', toId: 'u2', content: 'Loved your project update! üöÄ', time: now - 7200000, read: false },
            { id: 'm12', fromId: 'u2', toId: 'u3', content: 'Thanks Emma! Maybe we should collab on an art-tech piece. üé®üíª', time: now - 6900000, read: false }
        ];
    }

    /**
     * Provide default posts for each community. These arrays include
     * trending conversations and questions tailored to the community
     * themes. Each post contains a content string, the id of the author,
     * and simple engagement counts for upvotes, comments and shares.
     * Images are pulled from Unsplash to illustrate the post. When
     * extending this dataset ensure that each community has at least
     * four posts to populate the community feed.
     */
    function getDefaultCommunityPosts() {
        return {
            c1: [ // Art & Design
                {
                    id: 'cp1',
                    userId: 'u1',
                    content: 'Exploring minimalist design trends of 2026. Less is more! #minimalism #design',
                    image: 'https://images.unsplash.com/photo-1498050108023-c5249f4df085?auto=format&fit=crop&w=800&q=80',
                    upvotes: 120,
                    comments: 12,
                    shares: 5
                },
                {
                    id: 'cp2',
                    userId: 'u3',
                    content: 'Colour palette of the year 2026? Let‚Äôs discuss your favourites! #colortrend #design2026',
                    image: 'https://images.unsplash.com/photo-1503602642458-232111445657?auto=format&fit=crop&w=800&q=80',
                    upvotes: 98,
                    comments: 8,
                    shares: 3
                },
                {
                    id: 'cp3',
                    userId: 'u2',
                    content: 'How AI influences art creation today. Fascinating or frightening? #AIart #future',
                    image: 'https://images.unsplash.com/photo-1522199710521-72d69614c702?auto=format&fit=crop&w=800&q=80',
                    upvotes: 150,
                    comments: 15,
                    shares: 7
                },
                {
                    id: 'cp4',
                    userId: 'u5',
                    content: 'Show off your favourite piece of art! Post a picture below. #myart #gallery',
                    image: 'https://images.unsplash.com/photo-1465479423261-61728898de05?auto=format&fit=crop&w=800&q=80',
                    upvotes: 135,
                    comments: 20,
                    shares: 10
                }
                ,{
                    id: 'cp33',
                    userId: 'u2',
                    content: 'Virtual galleries with AI curated art ‚Äî the future of exhibitions! #AIGalleries #DigitalArt #Metaverse',
                    image: 'https://images.unsplash.com/photo-1501555088652-021faa106b9d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 90,
                    comments: 8,
                    shares: 3
                }
            ],
            c2: [ // Photography
                {
                    id: 'cp5',
                    userId: 'u7',
                    content: 'Sunset vibes from the mountains. What‚Äôs your favourite sunset shot? #sunset #nature',
                    image: 'https://images.unsplash.com/photo-1519681393784-d120267933ba?auto=format&fit=crop&w=800&q=80',
                    upvotes: 160,
                    comments: 14,
                    shares: 6
                },
                {
                    id: 'cp6',
                    userId: 'u3',
                    content: 'Street photography in Bucharest ‚Äì hidden stories around every corner. #streetphotography #bucharest',
                    image: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 110,
                    comments: 9,
                    shares: 4
                },
                {
                    id: 'cp7',
                    userId: 'u1',
                    content: 'Capturing emotions through the lens. Share a portrait you love. #emotions #portrait',
                    image: 'https://images.unsplash.com/photo-1502980426475-b83966705988?auto=format&fit=crop&w=800&q=80',
                    upvotes: 125,
                    comments: 11,
                    shares: 5
                },
                {
                    id: 'cp8',
                    userId: 'u4',
                    content: 'Black and white photography challenge! Post your monochrome masterpiece. #bw #monochrome',
                    image: 'https://images.unsplash.com/photo-1504198458649-3128b932f49b?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 13,
                    shares: 6
                }
                ,{
                    id: 'cp34',
                    userId: 'u4',
                    content: 'Astro photography tips for capturing the night sky ‚ú®üåå #AstroPhotography #NightSky #LongExposure',
                    image: 'https://images.unsplash.com/photo-1503264116251-35a269479413?auto=format&fit=crop&w=800&q=80',
                    upvotes: 100,
                    comments: 9,
                    shares: 3
                }
            ],
            c3: [ // Music & Dance
                {
                    id: 'cp9',
                    userId: 'u4',
                    content: 'Best songs of 2026 ‚Äì share your playlist recommendations! üéß #hits2026 #music',
                    image: 'https://images.unsplash.com/photo-1511379938547-c1f69419868d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 175,
                    comments: 18,
                    shares: 8
                },
                {
                    id: 'cp10',
                    userId: 'u10',
                    content: 'Dance challenge: show your moves! üíÉüï∫ #dancechallenge #fun',
                    image: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 12,
                    shares: 5
                },
                {
                    id: 'cp11',
                    userId: 'u1',
                    content: 'Live jam session this weekend in p/Music ‚Äì join us! üé∏ #livemusic #jam',
                    image: 'https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?auto=format&fit=crop&w=800&q=80',
                    upvotes: 130,
                    comments: 10,
                    shares: 4
                },
                {
                    id: 'cp12',
                    userId: 'u4',
                    content: 'New album release by your favourite artist dropping soon! ü§© #albumrelease #pop',
                    image: 'https://images.unsplash.com/photo-1454922915609-78549ad709bb?auto=format&fit=crop&w=800&q=80',
                    upvotes: 155,
                    comments: 14,
                    shares: 6
                }
                ,{
                    id: 'cp35',
                    userId: 'u3',
                    content: 'Learning a new instrument in 2026 ‚Äî which one will you pick? üéπüé∏ #MusicEducation #Instruments #LearnMusic',
                    image: 'https://images.unsplash.com/photo-1511379938547-c1f69419868c?auto=format&fit=crop&w=800&q=80',
                    upvotes: 110,
                    comments: 10,
                    shares: 4
                }
            ],
            c4: [ // Sports & Fitness
                {
                    id: 'cp13',
                    userId: 'u6',
                    content: 'Morning workout routine done! How do you start your day? #fitlife #morning',
                    image: 'https://images.unsplash.com/photo-1558611848-73f7eb4001e3?auto=format&fit=crop&w=800&q=80',
                    upvotes: 145,
                    comments: 16,
                    shares: 7
                },
                {
                    id: 'cp14',
                    userId: 'u6',
                    content: 'Favourite healthy snack suggestions? üçéü•ú #healthysnacks #nutrition',
                    image: 'https://images.unsplash.com/photo-1512058564366-c9e7b3c82f6b?auto=format&fit=crop&w=800&q=80',
                    upvotes: 120,
                    comments: 14,
                    shares: 5
                },
                {
                    id: 'cp15',
                    userId: 'u6',
                    content: 'Running challenge for a 5k marathon. Who‚Äôs in? üèÉ‚Äç‚ôÄÔ∏èüèÉ‚Äç‚ôÇÔ∏è #running #challenge',
                    image: 'https://images.unsplash.com/photo-1509021436665-8f07dbf5bf1d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 110,
                    comments: 9,
                    shares: 4
                },
                {
                    id: 'cp16',
                    userId: 'u6',
                    content: 'Yoga and mindfulness for beginners ‚Äì share your tips üßò‚Äç‚ôÄÔ∏è #yoga #wellness',
                    image: 'https://images.unsplash.com/photo-1544005313-94ddf0286df2?auto=format&fit=crop&w=800&q=80',
                    upvotes: 135,
                    comments: 12,
                    shares: 5
                }
                ,{
                    id: 'cp36',
                    userId: 'u6',
                    content: 'Group workouts or solo sessions ‚Äî what motivates you more? üèãÔ∏è‚Äç‚ôÄÔ∏èü§∏‚Äç‚ôÇÔ∏è #WorkoutMotivation #FitnessCommunity #GroupTraining',
                    image: 'https://images.unsplash.com/photo-1517130038641-a774d04afb3f?auto=format&fit=crop&w=800&q=80',
                    upvotes: 95,
                    comments: 8,
                    shares: 3
                }
            ],
            c5: [ // Food & Recipes
                {
                    id: 'cp17',
                    userId: 'u9',
                    content: 'Easy vegan dinner recipes for busy days üå± #vegan #healthy',
                    image: 'https://images.unsplash.com/photo-1516685018646-549d89e036e8?auto=format&fit=crop&w=800&q=80',
                    upvotes: 125,
                    comments: 10,
                    shares: 5
                },
                {
                    id: 'cp18',
                    userId: 'u9',
                    content: 'What‚Äôs your comfort food when the weather‚Äôs cold? üç≤ #comfortfood #yummy',
                    image: 'https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?auto=format&fit=crop&w=800&q=80',
                    upvotes: 100,
                    comments: 8,
                    shares: 4
                },
                {
                    id: 'cp19',
                    userId: 'u9',
                    content: 'Street food around the world ‚Äì share your favourites üåÆüçú #streetfood #culture',
                    image: 'https://images.unsplash.com/photo-1466637574441-749b8f19452f?auto=format&fit=crop&w=800&q=80',
                    upvotes: 130,
                    comments: 11,
                    shares: 5
                },
                {
                    id: 'cp20',
                    userId: 'u9',
                    content: 'Baking desserts: show us your best cake üç∞ #baking #dessert',
                    image: 'https://images.unsplash.com/photo-1543248939-ef0c691b473c?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 12,
                    shares: 6
                }
                ,{
                    id: 'cp37',
                    userId: 'u9',
                    content: 'Fusion cuisine is trending ‚Äî what‚Äôs the craziest combo you‚Äôve tried? üçúüåÆ #FusionFood #FoodTrends #Gastronomy',
                    image: 'https://images.unsplash.com/photo-1481931715705-36f297e4c76d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 105,
                    comments: 9,
                    shares: 3
                }
            ],
            c6: [ // Gaming
                {
                    id: 'cp21',
                    userId: 'u8',
                    content: 'Top games releasing this year. Which one are you most excited about? üéÆ #newgames #gamer',
                    image: 'https://images.unsplash.com/photo-1511512578047-dfb367046420?auto=format&fit=crop&w=800&q=80',
                    upvotes: 155,
                    comments: 17,
                    shares: 7
                },
                {
                    id: 'cp22',
                    userId: 'u8',
                    content: 'Virtual reality vs console gaming ‚Äì which do you prefer? üï∂Ô∏èüéÆ #VR #console',
                    image: 'https://images.unsplash.com/photo-1603280251038-49663cf9688e?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 14,
                    shares: 6
                },
                {
                    id: 'cp23',
                    userId: 'u8',
                    content: 'Esports tournament watch party this weekend! Who‚Äôs joining? üèÜ #esports #competition',
                    image: 'https://images.unsplash.com/photo-1511578314322-379afb476865?auto=format&fit=crop&w=800&q=80',
                    upvotes: 130,
                    comments: 11,
                    shares: 5
                },
                {
                    id: 'cp24',
                    userId: 'u8',
                    content: 'Show off your gaming setup! üíªüïπÔ∏è #gamingsetup #pcgaming',
                    image: 'https://images.unsplash.com/photo-1512314889357-e157c22f938d?auto=format&fit=crop&w=800&q=80',
                    upvotes: 145,
                    comments: 13,
                    shares: 6
                }
                ,{
                    id: 'cp38',
                    userId: 'u8',
                    content: 'Retro gaming comeback! Which classic console do you miss the most? üïπÔ∏è #RetroGaming #80s #90s',
                    image: 'https://images.unsplash.com/photo-1556572930-cf2fc4383835?auto=format&fit=crop&w=800&q=80',
                    upvotes: 100,
                    comments: 9,
                    shares: 4
                }
            ],
            c7: [ // Technology
                {
                    id: 'cp25',
                    userId: 'u8',
                    content: 'AI revolution in the workplace ‚Äì opportunities and challenges. ü§ñ #AI #future',
                    image: 'https://images.unsplash.com/photo-1526378720229-3e3517aae4a0?auto=format&fit=crop&w=800&q=80',
                    upvotes: 165,
                    comments: 18,
                    shares: 8
                },
                {
                    id: 'cp26',
                    userId: 'u8',
                    content: 'Blockchain beyond cryptocurrency ‚Äì what use cases excite you? #blockchain #innovation',
                    image: 'https://images.unsplash.com/photo-1518770660439-4636190af475?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 15,
                    shares: 7
                },
                {
                    id: 'cp27',
                    userId: 'u8',
                    content: 'Quantum computing advancements and their impact on society. üß† #quantum #technews',
                    image: 'https://images.unsplash.com/photo-1555617117-08fda9a2a296?auto=format&fit=crop&w=800&q=80',
                    upvotes: 130,
                    comments: 14,
                    shares: 6
                },
                {
                    id: 'cp28',
                    userId: 'u8',
                    content: 'Tech gadgets you can‚Äôt live without ‚Äì share your must-haves! üì± #gadgets #musthave',
                    image: 'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?auto=format&fit=crop&w=800&q=80',
                    upvotes: 150,
                    comments: 15,
                    shares: 7
                }
                ,{
                    id: 'cp39',
                    userId: 'u8',
                    content: 'Metaverse networks ‚Äî will virtual offices replace physical ones? üåêüè¢ #Metaverse #RemoteWork #FutureTech',
                    image: 'https://images.unsplash.com/photo-1581093458791-9c0b37c3a762?auto=format&fit=crop&w=800&q=80',
                    upvotes: 120,
                    comments: 10,
                    shares: 5
                }
            ],
            c8: [ // Travel
                {
                    id: 'cp29',
                    userId: 'u5',
                    content: 'Hidden gems in Romania you must visit. üá∑üá¥ #Romania #travel',
                    image: 'https://images.unsplash.com/photo-1483683804023-6ccdb62f86ef?auto=format&fit=crop&w=800&q=80',
                    upvotes: 145,
                    comments: 13,
                    shares: 6
                },
                {
                    id: 'cp30',
                    userId: 'u5',
                    content: 'Dream vacation destinations for 2026 ‚Äì what‚Äôs on your list? üåç #dreamdestinations #travel2026',
                    image: 'https://images.unsplash.com/photo-1446776811953-b23d57bd21aa?auto=format&fit=crop&w=800&q=80',
                    upvotes: 135,
                    comments: 11,
                    shares: 5
                },
                {
                    id: 'cp31',
                    userId: 'u5',
                    content: 'Budget-friendly travel tips to explore the world on a shoestring. üß≥ #traveltips #budget',
                    image: 'https://images.unsplash.com/photo-1483683804023-6ccdb62f86ef?auto=format&fit=crop&w=800&q=80',
                    upvotes: 128,
                    comments: 10,
                    shares: 4
                },
                {
                    id: 'cp32',
                    userId: 'u5',
                    content: 'Adventure sports to try at least once in your lifetime! üßó‚Äç‚ôÇÔ∏èüö¥‚Äç‚ôÄÔ∏è #adventure #thrill',
                    image: 'https://images.unsplash.com/photo-1500534314209-a27c7c74a5e2?auto=format&fit=crop&w=800&q=80',
                    upvotes: 140,
                    comments: 12,
                    shares: 5
                }
                ,{
                    id: 'cp40',
                    userId: 'u5',
                    content: 'Digital nomad lifestyle in 2026: best cities for remote work? ‚úàÔ∏èüèôÔ∏è #DigitalNomad #RemoteWork #Travel2026',
                    image: 'https://images.unsplash.com/photo-1551854833-d45f48d2e054?auto=format&fit=crop&w=800&q=80',
                    upvotes: 110,
                    comments: 8,
                    shares: 3
                }
            ]
        };
    }

    /**
     * Default items for the Marketplace. These items simulate premium add‚Äëons
     * users can purchase (badges, themes, sticker packs, subscriptions, etc.).
     * Each item includes an id, title, description, image and price. Images
     * are sourced from Unsplash and can be replaced with your own branding.
     */
    function getDefaultMarketplaceItems() {
        return [
            {
                id: 'item1',
                title: 'Premium Profile Badge',
                description: 'Stand out from the crowd with a unique badge on your profile.',
                image: 'https://images.unsplash.com/photo-1556229010-4cbbe8f21c0c?w=800',
                price: '$4.99',
                category: 'Badges'
            },
            {
                id: 'item2',
                title: 'Custom Profile Theme',
                description: 'Personalize your profile with exclusive colours and backgrounds.',
                image: 'https://images.unsplash.com/photo-1493050947991-935206c2b52e?w=800',
                price: '$9.99',
                category: 'Themes'
            },
            {
                id: 'item3',
                title: 'Exclusive Sticker Pack',
                description: 'Unlock a set of premium stickers to use in chats and comments.',
                image: 'https://images.unsplash.com/photo-1515382178296-3173a272cb5b?w=800',
                price: '$2.99',
                category: 'Stickers'
            },
            {
                id: 'item4',
                title: 'Creator Subscription',
                description: 'Subscribe to your favourite creators and get exclusive content.',
                image: 'https://images.unsplash.com/photo-1485211045112-3e0ecaefab2e?w=800',
                price: '$19.99',
                category: 'Subscriptions'
            },
            {
                id: 'item5',
                title: 'VIP Community Access',
                description: 'Gain access to closed communities and special events.',
                image: 'https://images.unsplash.com/photo-1504384308090-c894fdcc538d?w=800',
                price: '$29.99',
                category: 'VIP Access'
            },
            {
                id: 'item6',
                title: 'Brand Partnership Slot',
                description: 'Advertise your brand within the PASESO ecosystem.',
                image: 'https://images.unsplash.com/photo-1515165562838-7d6f1e07e30e?w=800',
                price: '$99.99',
                category: 'Advertising'
            }
        ];
    }

    // ==================== AUTH FUNCTIONS ====================
    function showLogin() {
        document.getElementById('login-form').classList.remove('hidden');
        document.getElementById('register-form').classList.add('hidden');
    }

    function showRegister() {
        document.getElementById('login-form').classList.add('hidden');
        document.getElementById('register-form').classList.remove('hidden');
    }

    function togglePassword(inputId) {
        const input = document.getElementById(inputId);
        input.type = input.type === 'password' ? 'text' : 'password';
    }

    function handleLogin() {
        const email = document.getElementById('login-email').value.trim();
        const password = document.getElementById('login-password').value;

        if (!email || !password) {
            showToast('Please fill in all fields', 'error');
            return;
        }

        // Check if user exists in localStorage
        const savedUsers = JSON.parse(localStorage.getItem('paseso_all_users')) || [];
        const existingUser = savedUsers.find(u => u.email === email || u.username === email);

        if (existingUser && existingUser.password === password) {
            currentUser = existingUser;
        } else if (email && password.length >= 6) {
            // Demo login - create user
            currentUser = {
                id: 'user_' + Date.now(),
                email: email,
                username: email.split('@')[0],
                firstName: 'New',
                lastName: 'User',
                name: 'New User',
                avatar: DEFAULT_AVATAR,
                bio: 'Hey there! I\'m using PASESO üëã',
                location: '',
                website: '',
                followers: 0,
                following: 0,
                verified: false,
                premium: false,
                createdAt: Date.now()
            };
        } else {
            showToast('Invalid credentials', 'error');
            return;
        }

        // Award a small bonus for daily login. If the user has not logged in today,
        // increment their points and set lastLoginDate to today. This encourages
        // regular engagement and gamifies the sign‚Äëin process.
        try {
            const today = new Date().toDateString();
            if (!currentUser.lastLoginDate || currentUser.lastLoginDate !== today) {
                if (!currentUser.points) currentUser.points = 0;
                currentUser.points += 2;
                currentUser.lastLoginDate = today;
                showToast('Daily login bonus! You earned 2 points ü•≥', 'success');
            }
        } catch (e) {
            console.error('Error awarding daily login points', e);
        }

        // Persist any updates to the user in the saved users list
        const allUsers = JSON.parse(localStorage.getItem('paseso_all_users')) || [];
        const userIndex = allUsers.findIndex(u => u.id === currentUser.id);
        if (userIndex !== -1) {
            allUsers[userIndex] = currentUser;
            localStorage.setItem('paseso_all_users', JSON.stringify(allUsers));
        }

        localStorage.setItem('paseso_user', JSON.stringify(currentUser));
        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        updateUserUI();
        showPage('feed');
        showToast('Welcome back! üëã', 'success');
    }

    function handleRegister() {
        const firstName = document.getElementById('reg-firstname').value.trim();
        const lastName = document.getElementById('reg-lastname').value.trim();
        const username = document.getElementById('reg-username').value.trim().toLowerCase();
        const email = document.getElementById('reg-email').value.trim();
        const password = document.getElementById('reg-password').value;
        const agreeTerms = document.getElementById('agree-terms').checked;

        if (!firstName || !lastName || !username || !email || !password) {
            showToast('Please fill in all fields', 'error');
            return;
        }
        if (password.length < 8) {
            showToast('Password must be at least 8 characters', 'error');
            return;
        }
        if (!agreeTerms) {
            showToast('Please agree to the terms', 'error');
            return;
        }

        // Check if username/email exists
        const savedUsers = JSON.parse(localStorage.getItem('paseso_all_users')) || [];
        if (savedUsers.find(u => u.username === username)) {
            showToast('Username already taken', 'error');
            return;
        }
        if (savedUsers.find(u => u.email === email)) {
            showToast('Email already registered', 'error');
            return;
        }

        currentUser = {
            id: 'user_' + Date.now(),
            email,
            password,
            username,
            firstName,
            lastName,
            name: `${firstName} ${lastName}`,
            avatar: DEFAULT_AVATAR,
            bio: 'Hey there! I\'m using PASESO üëã',
            location: '',
            website: '',
            followers: 0,
            following: 0,
            verified: false,
            premium: false,
            createdAt: Date.now()
        };

        savedUsers.push(currentUser);
        localStorage.setItem('paseso_all_users', JSON.stringify(savedUsers));
        localStorage.setItem('paseso_user', JSON.stringify(currentUser));

        document.getElementById('auth-screen').classList.add('hidden');
        document.getElementById('main-app').classList.remove('hidden');
        updateUserUI();
        showPage('feed');
        showToast('Welcome to PASESO! üéâ', 'success');
    }

    function handleLogout() {
        if (confirm('Are you sure you want to logout?')) {
            currentUser = null;
            localStorage.removeItem('paseso_user');
            document.getElementById('main-app').classList.add('hidden');
            document.getElementById('auth-screen').classList.remove('hidden');
            showLogin();
            showToast('Logged out successfully', 'info');
        }
    }

    function updateUserUI() {
        if (!currentUser) return;
        
        document.getElementById('sidebar-avatar').src = currentUser.avatar || DEFAULT_AVATAR;
        document.getElementById('sidebar-name').textContent = currentUser.name;
        document.getElementById('sidebar-username').textContent = '@' + currentUser.username;
        document.getElementById('mobile-avatar').src = currentUser.avatar || DEFAULT_AVATAR;
        document.getElementById('create-avatar').src = currentUser.avatar || DEFAULT_AVATAR;
        document.getElementById('create-name').textContent = currentUser.name;

        updateNotificationBadges();

        // Show admin navigation buttons based on user role
        const showAdmin = currentUser.role === 'admin' || currentUser.role === 'moderator';
        const adminNav = document.getElementById('admin-nav');
        if (adminNav) {
            adminNav.classList.toggle('hidden', !showAdmin);
        }
        const mobileAdminNav = document.getElementById('mobile-admin-nav');
        if (mobileAdminNav) {
            mobileAdminNav.classList.toggle('hidden', !showAdmin);
        }
    }

    function updateNotificationBadges() {
        const unreadNotifs = notifications.filter(n => !n.read).length;
        const unreadMsgs = messages.filter(m => !m.read && m.toId === currentUser?.id).length;

        ['notif-badge', 'header-notif-badge'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = unreadNotifs;
                el.classList.toggle('hidden', unreadNotifs === 0);
            }
        });

        ['unread-messages-badge', 'mobile-msg-badge'].forEach(id => {
            const el = document.getElementById(id);
            if (el) {
                el.textContent = unreadMsgs;
                el.classList.toggle('hidden', unreadMsgs === 0);
            }
        });
    }

    /**
     * Push a new notification to the global notifications array. This helper
     * supports optional targeting via the `toId` parameter (the recipient
     * user ID). It stores notifications with a unique ID, message, type and
     * sender/recipient details. After adding the notification it persists
     * data and updates the badges.
     *
     * @param {string} type The type of notification (e.g., 'like','comment','follow','share').
     * @param {string} fromId The user ID of the sender.
     * @param {string} toId The user ID of the recipient (optional; if omitted the notification is global).
     * @param {string} message The notification message to display.
     */
    function pushNotification(type, fromId, toId = null, message = '') {
        const notif = {
            id: 'n' + Date.now(),
            type,
            fromId,
            toId,
            message,
            read: false,
            createdAt: new Date().toISOString()
        };
        notifications.unshift(notif);
        // Persist notifications and update badge counts
        saveData();
        updateNotificationBadges();
    }

    // ==================== PAGE NAVIGATION ====================
    function showPage(pageId) {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.toggle('active', item.dataset.page === pageId);
        });

        const container = document.getElementById('page-container');
        container.innerHTML = '';

        switch(pageId) {
            case 'feed': renderFeedPage(container); break;
            case 'explore': renderExplorePage(container); break;
            case 'reels': renderReelsPage(container); break;
            case 'live': renderLivePage(container); break;
            case 'communities': renderCommunitiesPage(container); break;
            case 'creator': renderCreatorPage(container); break;
            case 'messages': renderMessagesPage(container); break;
            case 'notifications': renderNotificationsPage(container); break;
            case 'saved': renderSavedPage(container); break;
            case 'profile': renderProfilePage(container); break;
            case 'become-creator': renderBecomeCreatorPage(container); break;
            case 'settings': renderSettingsPage(container); break;
            case 'terms': renderTermsPage(container); break;
            case 'privacy': renderPrivacyPage(container); break;
            case 'leaderboard': renderLeaderboardPage(container); break;
            case 'marketplace': renderMarketplacePage(container); break;
            case 'about': renderAboutPage(container); break;
            case 'rewards': renderRewardsPage(container); break;
            case 'admin': renderAdminPage(container); break;
            case 'investors': renderInvestorsPage(container); break;
        }
    }

    // ==================== FEED PAGE ====================
    function renderFeedPage(container) {
        container.innerHTML = `
            <!-- Stories Bar -->
            <div class="mb-6">
                <div class="flex gap-4 overflow-x-auto pb-4 hide-scrollbar" id="stories-container">
                    <div onclick="openCreateStoryModal()" class="flex-shrink-0 flex flex-col items-center gap-2 cursor-pointer group">
                        <div class="relative">
                            <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 p-0.5">
                                <div class="w-full h-full rounded-full bg-dark-2 flex items-center justify-center">
                                    <i class="fas fa-plus text-2xl group-hover:scale-110 transition-transform"></i>
                                </div>
                            </div>
                        </div>
                        <span class="text-xs text-gray-400">Your Story</span>
                    </div>
                    ${renderStoriesBar()}
                </div>
            </div>

            <!-- Feed Content -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <div class="lg:col-span-2 space-y-6">
                    <!-- Create Post -->
                    <div class="glass rounded-2xl p-4">
                        <div class="flex gap-4">
                            <img src="${currentUser?.avatar || DEFAULT_AVATAR}" class="w-12 h-12 rounded-full object-cover">
                            <div class="flex-1">
                                <input type="text" placeholder="What's on your mind, ${currentUser?.firstName || 'User'}?" 
                                    class="w-full bg-white/5 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 transition-all cursor-pointer" 
                                    onclick="openCreateModal()" readonly>
                                <div class="flex items-center justify-between mt-3">
                                    <div class="flex gap-2">
                                        <button onclick="openCreateModal()" class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-white/5 text-sm text-gray-400 hover:text-green-400 transition-all">
                                            <i class="fas fa-image"></i>
                                            <span class="hidden sm:inline">Photo</span>
                                        </button>
                                        <button class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-white/5 text-sm text-gray-400 hover:text-blue-400 transition-all">
                                            <i class="fas fa-video"></i>
                                            <span class="hidden sm:inline">Video</span>
                                        </button>
                                        <button class="flex items-center gap-2 px-3 py-2 rounded-lg hover:bg-white/5 text-sm text-gray-400 hover:text-red-400 transition-all">
                                            <i class="fas fa-broadcast-tower"></i>
                                            <span class="hidden sm:inline">Live</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Posts -->
                    <div id="posts-container" class="space-y-6">
                        ${renderPosts()}
                    </div>
                </div>

                <!-- Sidebar -->
                <div class="hidden lg:block space-y-6">
                    ${renderTrendingSidebar()}
                    ${renderSuggestedUsers()}
                    ${renderPremiumCTA()}
                </div>
            </div>
        `;
    }

    function renderStoriesBar() {
        return stories.map((story, index) => `
            <div class="flex-shrink-0 flex flex-col items-center gap-2 cursor-pointer" onclick="openStoryViewer(${index})">
                <div class="story-ring ${!story.seen ? 'unseen' : ''} relative">
                    <img src="${story.avatar}" class="w-16 h-16 md:w-20 md:h-20 rounded-full object-cover">
                    ${story.isLive ? '<span class="absolute -top-1 -right-1 px-1.5 py-0.5 text-xs rounded-full live-badge font-bold">LIVE</span>' : ''}
                </div>
                <span class="text-xs text-gray-400">${story.username}</span>
            </div>
        `).join('');
    }

    function renderPosts() {
        return posts.filter(p => p.visibility === 'public' || p.userId === currentUser?.id).map(post => `
            <article class="glass rounded-2xl overflow-hidden hover-lift animate-slide-in" id="post-${post.id}">
                <div class="p-4">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-3 cursor-pointer" onclick="viewUserProfile('${post.userId}')">
                            <img src="${post.userAvatar}" onerror="this.src='https://via.placeholder.com/48/eee?text=No+Image'" class="w-12 h-12 rounded-full object-cover ring-2 ring-pink-500">
                            <div>
                                <div class="flex items-center gap-2">
                                    <span class="font-semibold">${post.userName}</span>
                                    ${post.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                                </div>
                                <p class="text-sm text-gray-400">@${post.username} ‚Ä¢ ${formatTime(post.time)}${post.editedAt ? ' ‚Ä¢ edited' : ''}</p>
                            </div>
                        </div>
                        <div class="relative">
                            <button class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center" onclick="togglePostMenu('${post.id}')">
                                <i class="fas fa-ellipsis-h text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                    <p class="mb-4 whitespace-pre-wrap">${formatContent(post.content)}</p>
                </div>
                ${post.image ? `
                    <div class="relative cursor-pointer" onclick="handleDoubleTap('${post.id}', event)">
                        <img src="${post.image}" onerror="this.src='https://via.placeholder.com/400x225/eee?text=No+Image'" class="w-full aspect-video object-cover select-none" draggable="false">
                    </div>
                ` : ''}
                <div class="p-4">
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center gap-6">
                            <button class="like-btn flex items-center gap-2 hover:text-pink-500 transition-all ${post.likedBy?.includes(currentUser?.id) ? 'text-pink-500' : 'text-gray-400'}" onclick="toggleLike('${post.id}')">
                                <i class="${post.likedBy?.includes(currentUser?.id) ? 'fas' : 'far'} fa-heart text-xl"></i>
                                <span>${formatNumber(post.likes)}</span>
                            </button>
                            <button class="comment-btn flex items-center gap-2 text-gray-400 hover:text-blue-400 transition-all" onclick="toggleComments('${post.id}')">
                                <i class="far fa-comment text-xl"></i>
                                <span>${post.comments.length}</span>
                            </button>
                            <button class="share-btn flex items-center gap-2 text-gray-400 hover:text-green-400 transition-all" onclick="sharePost('${post.id}')">
                                <i class="fas fa-retweet text-xl"></i>
                                <span>${post.shares}</span>
                            </button>
                        </div>
                        <div class="flex items-center gap-3">
                            <button class="save-btn hover:text-yellow-400 transition-all ${post.saved ? 'text-yellow-400' : 'text-gray-400'}" onclick="toggleSave('${post.id}')">
                                <i class="${post.saved ? 'fas' : 'far'} fa-bookmark text-xl"></i>
                            </button>
                            <button class="text-gray-400 hover:text-white transition-all" onclick="shareExternal('${post.id}')">
                                <i class="fas fa-share text-xl"></i>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Comments Section -->
                    <div id="comments-${post.id}" class="border-t border-white/10 pt-4 ${openCommentsPostId === post.id ? '' : 'hidden'}">
                        <div class="space-y-3 mb-4 max-h-60 overflow-y-auto">
                            ${post.comments.length === 0 ? '<p class="text-gray-500 text-sm text-center py-2">No comments yet. Be the first!</p>' : ''}
                            ${post.comments.map(c => `
                                <div class="flex gap-3 group">
                                    <img src="${c.avatar}" class="w-8 h-8 rounded-full object-cover cursor-pointer" onclick="viewUserProfile('${c.userId}')">
                                    <div class="flex-1 bg-white/5 rounded-xl px-4 py-2 relative">
                                        <div class="flex items-center justify-between">
                                            <span class="font-medium text-sm cursor-pointer hover:text-purple-400" onclick="viewUserProfile('${c.userId}')">${c.username}</span>
                                            ${c.userId === currentUser?.id ? `
                                                <button onclick="deleteComment('${post.id}', '${c.id}')" class="opacity-0 group-hover:opacity-100 text-gray-500 hover:text-red-400 text-xs transition-all">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            ` : ''}
                                        </div>
                                        <p class="text-sm text-gray-300">${c.content}</p>
                                        <span class="text-xs text-gray-500">${c.time}</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="flex gap-3">
                            <img src="${currentUser?.avatar || DEFAULT_AVATAR}" class="w-8 h-8 rounded-full object-cover">
                            <input type="text" id="comment-input-${post.id}" placeholder="Write a comment..." 
                                class="flex-1 bg-white/5 rounded-xl px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                onkeypress="if(event.key==='Enter') addComment('${post.id}')" maxlength="500">
                            <button onclick="addComment('${post.id}')" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 text-sm font-medium hover:opacity-90 transition-all">
                                Post
                            </button>
                        </div>
                    </div>
                </div>
            </article>
        `).join('');
    }

    function renderTrendingSidebar() {
        // Build a dynamic trending list by analysing hashtags in posts. Fallbacks are
        // provided in getTrendingTopics() to ensure the sidebar always shows
        // something. Each entry displays its rank, the hashtag, and an
        // approximate post count (multiplied for a more realistic display).
        // Retrieve the top 5 trending topics and the top 5 posts by likes
        const trendingList = getTrendingTopics(5);
        const topUsers = getTopUsers(5);
        // Build trending topics, placeholder ads, sponsored, premium marketplace preview and top posts.
        return `
            <div class="glass rounded-2xl p-4">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <i class="fas fa-fire text-orange-400"></i>
                    Trending Now
                </h3>
                <div class="space-y-4">
                    ${trendingList.map((item, i) => {
                        const count = Math.floor((item.count + 1) * 50 + Math.random() * 50);
                        // Use a softer hover colour and darker text in light theme for better contrast
                        return `<div class="flex items-start gap-3 cursor-pointer hover:bg-black/5 p-2 rounded-lg transition-all" onclick="searchHashtag('${item.tag}')">
                            <span class="text-2xl font-bold text-gray-700">${i + 1}</span>
                            <div>
                                <p class="font-medium">${item.tag}</p>
                                <p class="text-sm text-gray-500">${count}k posts</p>
                            </div>
                        </div>`;
                    }).join('')}
                </div>
            </div>
            <!-- Ads section with placeholder banners -->
            <div class="glass rounded-2xl p-4 mt-6">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <i class="fas fa-ad text-blue-400"></i>
                    Ads
                </h3>
                <div class="space-y-4">
                    <div class="w-full h-24 rounded-xl bg-gradient-to-r from-purple-500 via-pink-500 to-orange-400 flex items-center justify-center text-center text-white font-bold text-sm p-2 cursor-pointer hover:opacity-90 transition-all">
                        Your Ad Here<br><span class="text-xs font-normal">Advertise with PASESO</span>
                    </div>
                    <div class="w-full h-24 rounded-xl bg-gradient-to-r from-green-500 via-teal-500 to-blue-500 flex items-center justify-center text-center text-white font-bold text-sm p-2 cursor-pointer hover:opacity-90 transition-all">
                        Promote Your Brand<br><span class="text-xs font-normal">Reach millions of users</span>
                    </div>
                </div>
            </div>
            <!-- Sponsored section with placeholder banners -->
            <div class="glass rounded-2xl p-4 mt-6">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <i class="fas fa-bullhorn text-green-400"></i>
                    Sponsored
                </h3>
                <div class="space-y-4">
                    <div class="w-full h-24 rounded-xl bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-500 flex items-center justify-center text-center text-black font-bold text-sm p-2 cursor-pointer hover:opacity-90 transition-all">
                        Sponsorship Available<br><span class="text-xs font-normal">Become our partner</span>
                    </div>
                    <div class="w-full h-24 rounded-xl bg-gradient-to-r from-indigo-500 via-sky-500 to-cyan-500 flex items-center justify-center text-center text-white font-bold text-sm p-2 cursor-pointer hover:opacity-90 transition-all">
                        Advertise Your App<br><span class="text-xs font-normal">Join the ecosystem</span>
                    </div>
                </div>
            </div>
            <!-- Premium Marketplace preview section -->
            <div class="glass rounded-2xl p-4 mt-6">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <i class="fas fa-shopping-bag text-yellow-400"></i>
                    Premium Marketplace
                </h3>
                <div class="space-y-4">
                    ${marketplaceItems.slice(0, 2).map(item => {
                        return `<div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <img src="${item.image}" onerror="this.src='https://via.placeholder.com/32/eee?text=No+Image'" class="w-8 h-8 rounded-full object-cover">
                                        <div>
                                            <p class="font-semibold">${item.title}</p>
                                            <p class="text-xs text-gray-400">${item.price}</p>
                                        </div>
                                    </div>
                                    <button onclick="buyMarketplaceItem('${item.id}')" class="text-xs px-2 py-1 rounded bg-green-500 hover:bg-green-600">Buy</button>
                                </div>`;
                    }).join('')}
                </div>
            </div>
            <!-- Top Users (Leaderboard) section -->
            <div class="glass rounded-2xl p-4 mt-6">
                <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                    <i class="fas fa-medal text-yellow-400"></i>
                    Top Users
                </h3>
                <div class="space-y-4">
                    ${topUsers.map((user, index) => {
                        return `<div class="flex items-center gap-3 cursor-pointer hover:bg-black/5 p-2 rounded-lg transition-all" onclick="viewUserProfile('${user.id}')">
                            <span class="text-lg font-bold text-gray-700">${index + 1}</span>
                            <img src="${user.avatar}" class="w-8 h-8 rounded-full object-cover flex-shrink-0" onerror="this.src='https://via.placeholder.com/32/eee?text=No+Image'">
                            <div class="flex-1">
                                <p class="text-sm font-semibold truncate">${user.name}</p>
                                <p class="text-xs text-gray-500">@${user.username} ¬∑ ${user.points || 0} pts</p>
                            </div>
                        </div>`;
                    }).join('')}
                </div>
            </div>
        `;
    }

    function renderSuggestedUsers() {
        const suggested = users.filter(u => u.id !== currentUser?.id).slice(0, 3);
        return `
            <div class="glass rounded-2xl p-4">
                <h3 class="font-bold text-lg mb-4">Who to Follow</h3>
                <div class="space-y-4">
                    ${suggested.map(user => `
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3 cursor-pointer" onclick="viewUserProfile('${user.id}')">
                                <img src="${user.avatar}" onerror="this.src='https://via.placeholder.com/40/eee?text=No+Image'" class="w-10 h-10 rounded-full object-cover">
                                <div>
                                    <div class="flex items-center gap-1">
                                        <span class="font-medium text-sm">${user.name}</span>
                                        ${user.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center text-xs"><i class="fas fa-check"></i></span>' : ''}
                                    </div>
                                    <p class="text-xs text-gray-400">@${user.username} ‚Ä¢ ${formatNumber(user.followers)} followers</p>
                                </div>
                            </div>
                            <button onclick="followUser('${user.id}')" class="px-4 py-1.5 rounded-full border border-white/20 text-sm font-medium hover:bg-white hover:text-black transition-all">
                                Follow
                            </button>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderPremiumCTA() {
        return `
            <div class="gradient-border rounded-2xl p-4">
                <div class="flex items-center gap-3 mb-3">
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-amber-400 to-orange-500 flex items-center justify-center">
                        <i class="fas fa-crown text-white"></i>
                    </div>
                    <h3 class="font-bold">Upgrade to Premium</h3>
                </div>
                <p class="text-sm text-gray-400 mb-4">Unlock exclusive features, remove ads, and support creators directly.</p>
                <button onclick="showToast('Premium features coming soon!', 'info')" class="w-full py-3 rounded-xl bg-gradient-to-r from-amber-400 to-orange-500 text-black font-semibold hover:opacity-90 transition-all">
                    Get Premium
                </button>
            </div>
        `;
    }

    // ==================== EXPLORE PAGE ====================
    let exploreTab = 'forYou';
    let searchResults = { users: [], posts: [], hashtags: [] };

    function renderExplorePage(container) {
        container.innerHTML = `
            <h1 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i class="fas fa-compass gradient-text"></i>
                Explore
            </h1>
            
            <!-- Search Bar -->
            <div class="relative mb-6">
                <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                <input type="text" id="explore-search" placeholder="Search users, posts, hashtags..." 
                    class="w-full pl-12 pr-4 py-4 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-all text-lg"
                    oninput="liveSearch(this.value)"
                    onkeyup="if(event.key==='Enter') performSearch(this.value)">
                <div id="search-suggestions" class="absolute top-full left-0 right-0 mt-2 glass-strong rounded-xl overflow-hidden z-50 hidden">
                    <!-- Live search suggestions -->
                </div>
            </div>

            <!-- Search Results Container (hidden by default) -->
            <div id="search-results-container" class="hidden mb-8">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">Search Results</h2>
                    <button onclick="clearSearch()" class="text-sm text-gray-400 hover:text-white">
                        <i class="fas fa-times mr-1"></i>Clear
                    </button>
                </div>
                <div id="search-results"></div>
            </div>
            
            <!-- Tabs -->
            <div class="flex gap-2 mb-6 overflow-x-auto hide-scrollbar">
                <button onclick="switchExploreTab('forYou')" class="explore-tab px-5 py-2.5 rounded-xl ${exploreTab === 'forYou' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap">
                    <i class="fas fa-fire mr-2"></i>For You
                </button>
                <button onclick="switchExploreTab('trending')" class="explore-tab px-5 py-2.5 rounded-xl ${exploreTab === 'trending' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap">
                    <i class="fas fa-chart-line mr-2"></i>Trending
                </button>
                <button onclick="switchExploreTab('people')" class="explore-tab px-5 py-2.5 rounded-xl ${exploreTab === 'people' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap">
                    <i class="fas fa-users mr-2"></i>People
                </button>
                <button onclick="switchExploreTab('photos')" class="explore-tab px-5 py-2.5 rounded-xl ${exploreTab === 'photos' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap">
                    <i class="fas fa-image mr-2"></i>Photos
                </button>
                <button onclick="switchExploreTab('videos')" class="explore-tab px-5 py-2.5 rounded-xl ${exploreTab === 'videos' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap">
                    <i class="fas fa-video mr-2"></i>Videos
                </button>
            </div>

            <!-- Trending Hashtags -->
            <div class="mb-8">
                <h2 class="font-semibold mb-4 text-gray-400 flex items-center gap-2">
                    <i class="fas fa-hashtag text-purple-400"></i>
                    Trending Hashtags
                </h2>
                <div class="flex flex-wrap gap-2">
                    ${getTrendingTopics(10).map((item, i) => {
                        // generate a pseudo count to make the numbers feel larger
                        const count = Math.floor((item.count + 1) * 1000 + Math.random() * 5000);
                        return `<button onclick="searchHashtag('${item.tag}')" class="group px-4 py-2 rounded-full bg-white/5 hover:bg-gradient-to-r hover:from-indigo-500 hover:to-pink-500 transition-all flex items-center gap-2">
                            <span>${item.tag}</span>
                            <span class="text-xs text-gray-500 group-hover:text-white">${formatNumber(count)}</span>
                        </button>`;
                    }).join('')}
                </div>
            </div>

            <!-- Content Grid -->
            <div id="explore-content">
                ${renderExploreContent()}
            </div>
        `;
    }

    function renderExploreContent() {
        switch(exploreTab) {
            case 'forYou':
            case 'photos':
                return `
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        ${posts.filter(p => p.image).map(post => `
                            <div class="aspect-square rounded-2xl overflow-hidden cursor-pointer hover-lift group relative" onclick="viewPost('${post.id}')">
                                <img src="${post.image}" class="w-full h-full object-cover">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/70 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-all">
                                    <div class="absolute bottom-3 left-3 right-3">
                                        <div class="flex items-center gap-2 mb-2">
                                            <img src="${post.userAvatar}" class="w-6 h-6 rounded-full object-cover">
                                            <span class="text-sm font-medium">${post.username}</span>
                                        </div>
                                        <div class="flex items-center gap-3 text-sm">
                                            <span class="flex items-center gap-1"><i class="fas fa-heart"></i> ${formatNumber(post.likes)}</span>
                                            <span class="flex items-center gap-1"><i class="fas fa-comment"></i> ${post.comments.length}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            case 'trending': {
                const trendingList = getTrendingTopics(5);
                return `
                    <div class="space-y-4">
                        ${trendingList.map((item, i) => {
                            // find the first post containing this hashtag to use as a preview image
                            const matchedPost = posts.find(p => extractHashtags(p.content).includes(item.tag));
                            const imgSrc = matchedPost && matchedPost.image ? matchedPost.image : `https://picsum.photos/200?random=${i+10}`;
                            const postCount = Math.floor((item.count + 1) * 50 + Math.random() * 50);
                            return `<div class="glass rounded-2xl p-4 hover-lift cursor-pointer" onclick="searchHashtag('${item.tag}')">
                                <div class="flex items-center gap-4">
                                    <span class="text-3xl font-bold text-gray-600">${i + 1}</span>
                                    <div class="flex-1">
                                        <h3 class="font-bold text-lg">${item.tag}</h3>
                                        <p class="text-sm text-gray-400">${postCount}k posts</p>
                                    </div>
                                    <div class="w-16 h-16 rounded-xl overflow-hidden">
                                        <img src="${imgSrc}" class="w-full h-full object-cover">
                                    </div>
                                </div>
                            </div>`;
                        }).join('')}
                    </div>
                `;
            }
            case 'people':
                return `
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${users.map(user => `
                            <div class="glass rounded-2xl p-4 hover-lift">
                                <div class="flex items-center gap-4">
                                    <img src="${user.avatar}" class="w-14 h-14 rounded-full object-cover ring-2 ring-purple-500">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2">
                                            <h3 class="font-bold">${user.name}</h3>
                                            ${user.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                                        </div>
                                        <p class="text-sm text-gray-400">@${user.username}</p>
                                        <p class="text-sm text-gray-500 mt-1">${user.bio}</p>
                                    </div>
                                    <button onclick="followUser('${user.id}')" class="px-4 py-2 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 font-medium text-sm hover:opacity-90 transition-all">
                                        Follow
                                    </button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            case 'videos':
                return `
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        ${[1,2,3,4,5,6,7,8].map(i => `
                            <div class="aspect-[9/16] rounded-2xl overflow-hidden cursor-pointer hover-lift group relative bg-dark-3">
                                <img src="https://picsum.photos/400/700?random=${i+20}" class="w-full h-full object-cover">
                                <div class="absolute inset-0 flex items-center justify-center">
                                    <div class="w-14 h-14 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center group-hover:bg-white/30 transition-all">
                                        <i class="fas fa-play text-xl ml-1"></i>
                                    </div>
                                </div>
                                <div class="absolute bottom-3 left-3 right-3 flex items-center gap-2 text-sm">
                                    <i class="fas fa-play"></i>
                                    <span>${formatNumber(Math.floor(Math.random() * 500000))}</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            default:
                return '';
        }
    }

    function switchExploreTab(tab) {
        exploreTab = tab;
        document.getElementById('explore-content').innerHTML = renderExploreContent();
        
        document.querySelectorAll('.explore-tab').forEach(btn => {
            btn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
            btn.classList.add('bg-white/5');
        });
        event.target.classList.remove('bg-white/5');
        event.target.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
    }

    function liveSearch(query) {
        const suggestions = document.getElementById('search-suggestions');
        if (!query || query.length < 2) {
            suggestions.classList.add('hidden');
            return;
        }

        const q = query.toLowerCase();
        const matchedUsers = users.filter(u => u.name.toLowerCase().includes(q) || u.username.toLowerCase().includes(q)).slice(0, 3);
        const matchedPosts = posts.filter(p => p.content.toLowerCase().includes(q)).slice(0, 2);
        
        if (matchedUsers.length === 0 && matchedPosts.length === 0) {
            suggestions.classList.add('hidden');
            return;
        }

        suggestions.innerHTML = `
            ${matchedUsers.length ? `
                <div class="p-2 border-b border-white/10">
                    <p class="text-xs text-gray-400 px-2 mb-2">Users</p>
                    ${matchedUsers.map(u => `
                        <div class="flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer" onclick="viewUserProfile('${u.id}')">
                            <img src="${u.avatar}" class="w-8 h-8 rounded-full object-cover">
                            <div>
                                <p class="font-medium text-sm">${u.name}</p>
                                <p class="text-xs text-gray-400">@${u.username}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            ` : ''}
            ${matchedPosts.length ? `
                <div class="p-2">
                    <p class="text-xs text-gray-400 px-2 mb-2">Posts</p>
                    ${matchedPosts.map(p => `
                        <div class="flex items-center gap-3 p-2 hover:bg-white/5 rounded-lg cursor-pointer" onclick="viewPost('${p.id}')">
                            ${p.image ? `<img src="${p.image}" class="w-10 h-10 rounded-lg object-cover">` : '<div class="w-10 h-10 rounded-lg bg-white/10 flex items-center justify-center"><i class="fas fa-align-left text-gray-400"></i></div>'}
                            <p class="text-sm line-clamp-1">${p.content.slice(0, 50)}...</p>
                        </div>
                    `).join('')}
                </div>
            ` : ''}
            <div class="p-2 border-t border-white/10">
                <button onclick="performSearch('${query}')" class="w-full text-left p-2 hover:bg-white/5 rounded-lg text-sm text-purple-400">
                    <i class="fas fa-search mr-2"></i>Search for "${query}"
                </button>
            </div>
        `;
        suggestions.classList.remove('hidden');
    }

    function performSearch(query) {
        if (!query) return;
        
        document.getElementById('search-suggestions').classList.add('hidden');
        
        const q = query.toLowerCase();
        searchResults = {
            users: users.filter(u => u.name.toLowerCase().includes(q) || u.username.toLowerCase().includes(q)),
            posts: posts.filter(p => p.content.toLowerCase().includes(q)),
            hashtags: ['#' + query.replace('#', '')]
        };

        const resultsContainer = document.getElementById('search-results-container');
        const resultsDiv = document.getElementById('search-results');
        
        resultsDiv.innerHTML = `
            <div class="space-y-6">
                ${searchResults.users.length ? `
                    <div>
                        <h3 class="font-semibold mb-3 text-gray-400">Users (${searchResults.users.length})</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                            ${searchResults.users.map(u => `
                                <div class="glass rounded-xl p-3 flex items-center gap-3 cursor-pointer hover:bg-white/5" onclick="viewUserProfile('${u.id}')">
                                    <img src="${u.avatar}" class="w-10 h-10 rounded-full object-cover">
                                    <div>
                                        <p class="font-medium">${u.name}</p>
                                        <p class="text-sm text-gray-400">@${u.username}</p>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                ${searchResults.posts.length ? `
                    <div>
                        <h3 class="font-semibold mb-3 text-gray-400">Posts (${searchResults.posts.length})</h3>
                        <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                            ${searchResults.posts.map(p => `
                                <div class="aspect-square rounded-xl overflow-hidden cursor-pointer hover-lift" onclick="viewPost('${p.id}')">
                                    ${p.image ? `<img src="${p.image}" class="w-full h-full object-cover">` : `
                                        <div class="w-full h-full bg-gradient-to-br from-indigo-500/20 to-pink-500/20 flex items-center justify-center p-3">
                                            <p class="text-sm text-center line-clamp-4">${p.content}</p>
                                        </div>
                                    `}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                ` : ''}
                ${searchResults.users.length === 0 && searchResults.posts.length === 0 ? `
                    <div class="text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-600 mb-4"></i>
                        <p class="text-gray-400">No results found for "${query}"</p>
                    </div>
                ` : ''}
            </div>
        `;
        
        resultsContainer.classList.remove('hidden');
    }

    function clearSearch() {
        document.getElementById('explore-search').value = '';
        document.getElementById('search-results-container').classList.add('hidden');
        document.getElementById('search-suggestions').classList.add('hidden');
    }

    // ==================== REELS PAGE ====================
    function renderReelsPage(container) {
        const reels = [
            { id: 'r1', video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4', thumbnail: 'https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?w=400', caption: 'üî• Amazing performance! #music #live', likes: 234500, comments: 1230, shares: 890 },
            { id: 'r2', video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4', thumbnail: 'https://images.unsplash.com/photo-1504674900247-0877df9cc836?w=400', caption: 'Cooking magic ‚ú® #food #recipe', likes: 156000, comments: 2340, shares: 567 },
            { id: 'r3', video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4', thumbnail: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400', caption: 'Workout motivation üí™ #fitness', likes: 89000, comments: 890, shares: 234 },
            { id: 'r4', video: 'https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4', thumbnail: 'https://images.unsplash.com/photo-1551632436-cbf8dd35adfa?w=400', caption: 'Road trip vibes üöó #travel', likes: 345000, comments: 4560, shares: 1234 }
        ];
        
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-clapperboard gradient-text"></i>
                    Reels
                </h1>
                <button onclick="openCreateReelModal()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium hover:opacity-90 transition-all">
                    <i class="fas fa-plus mr-2"></i>Create Reel
                </button>
            </div>

            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8">
                ${reels.map((reel, i) => `
                    <div class="relative aspect-[9/16] rounded-2xl overflow-hidden cursor-pointer hover-scale group" onclick="openReelViewer(${i})">
                        <img src="${reel.thumbnail}" class="w-full h-full object-cover">
                        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                        <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-all">
                            <div class="w-16 h-16 rounded-full bg-white/20 backdrop-blur-sm flex items-center justify-center">
                                <i class="fas fa-play text-2xl ml-1"></i>
                            </div>
                        </div>
                        <div class="absolute bottom-4 left-4 right-4">
                            <div class="flex items-center gap-2 mb-2">
                                <img src="${users[i % users.length].avatar}" class="w-8 h-8 rounded-full object-cover ring-2 ring-pink-500">
                                <span class="font-medium text-sm">${users[i % users.length].username}</span>
                            </div>
                            <p class="text-sm mb-2 line-clamp-2">${reel.caption}</p>
                            <div class="flex items-center gap-3 text-sm text-gray-300">
                                <span><i class="fas fa-play mr-1"></i>${formatNumber(reel.likes)}</span>
                                <span><i class="fas fa-heart mr-1"></i>${formatNumber(reel.comments)}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>

            <!-- Full Screen Reel Viewer -->
            <div id="reel-viewer" class="hidden fixed inset-0 z-[100] bg-black flex items-center justify-center">
                <button onclick="closeReelViewer()" class="absolute top-4 right-4 z-10 w-10 h-10 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-times text-xl"></i>
                </button>
                <div class="relative w-full max-w-md h-full max-h-[90vh]">
                    <video id="reel-video" class="w-full h-full object-cover rounded-2xl" loop playsinline></video>
                    <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black/80 to-transparent">
                        <div class="flex items-center gap-3 mb-3">
                            <img id="reel-user-avatar" src="" class="w-10 h-10 rounded-full object-cover ring-2 ring-white">
                            <span id="reel-username" class="font-semibold"></span>
                            <button class="ml-auto px-4 py-1.5 rounded-full border border-white font-medium text-sm hover:bg-white hover:text-black transition-all">Follow</button>
                        </div>
                        <p id="reel-caption" class="mb-4"></p>
                    </div>
                    <div class="absolute right-4 bottom-32 flex flex-col gap-4">
                        <button onclick="likeReel()" class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all">
                                <i class="fas fa-heart text-xl"></i>
                            </div>
                            <span id="reel-likes" class="text-sm mt-1"></span>
                        </button>
                        <button class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all">
                                <i class="fas fa-comment text-xl"></i>
                            </div>
                            <span id="reel-comments" class="text-sm mt-1"></span>
                        </button>
                        <button class="flex flex-col items-center">
                            <div class="w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20 transition-all">
                                <i class="fas fa-share text-xl"></i>
                            </div>
                            <span id="reel-shares" class="text-sm mt-1"></span>
                        </button>
                    </div>
                </div>
                <button onclick="prevReel()" class="absolute left-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-chevron-up text-xl"></i>
                </button>
                <button onclick="nextReel()" class="absolute right-4 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white/10 flex items-center justify-center hover:bg-white/20">
                    <i class="fas fa-chevron-down text-xl"></i>
                </button>
            </div>
        `;

        // Store reels data
        window.reelsData = reels;
        window.currentReelIndex = 0;
    }

    function openReelViewer(index) {
        window.currentReelIndex = index;
        const reel = window.reelsData[index];
        const user = users[index % users.length];

        document.getElementById('reel-viewer').classList.remove('hidden');
        document.getElementById('reel-video').src = reel.video;
        document.getElementById('reel-video').play();
        document.getElementById('reel-user-avatar').src = user.avatar;
        document.getElementById('reel-username').textContent = user.username;
        document.getElementById('reel-caption').textContent = reel.caption;
        document.getElementById('reel-likes').textContent = formatNumber(reel.likes);
        document.getElementById('reel-comments').textContent = formatNumber(reel.comments);
        document.getElementById('reel-shares').textContent = formatNumber(reel.shares);
        document.body.style.overflow = 'hidden';
    }

    function closeReelViewer() {
        document.getElementById('reel-viewer').classList.add('hidden');
        document.getElementById('reel-video').pause();
        document.body.style.overflow = '';
    }

    function nextReel() {
        if (window.currentReelIndex < window.reelsData.length - 1) {
            openReelViewer(window.currentReelIndex + 1);
        }
    }

    function prevReel() {
        if (window.currentReelIndex > 0) {
            openReelViewer(window.currentReelIndex - 1);
        }
    }

    function likeReel() {
        const reel = window.reelsData[window.currentReelIndex];
        reel.likes++;
        document.getElementById('reel-likes').textContent = formatNumber(reel.likes);
        showToast('Liked! ‚ù§Ô∏è', 'success');
    }

    function openCreateReelModal() {
        showToast('Upload your video - Coming soon! üé¨', 'info');
    }

    // ==================== LIVE PAGE ====================
    function renderLivePage(container) {
        const liveStreams = [
            { id: 'l1', title: 'Music Session üéµ', category: 'Music', viewers: 12500, user: users[0] },
            { id: 'l2', title: 'Gaming with Friends üéÆ', category: 'Gaming', viewers: 8900, user: users[1] },
            { id: 'l3', title: 'Ask Me Anything! üí¨', category: 'Just Chatting', viewers: 5600, user: users[2] },
            { id: 'l4', title: 'Art Stream - Digital Painting üé®', category: 'Art', viewers: 3200, user: users[3] },
            { id: 'l5', title: 'Cooking Italian Food üçù', category: 'Lifestyle', viewers: 4100, user: users[4] }
        ];

        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-broadcast-tower text-red-500"></i>
                    Live Streams
                </h1>
                <button onclick="startLiveStream()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-red-500 to-pink-500 font-medium hover:opacity-90 transition-all">
                    <i class="fas fa-video mr-2"></i>Go Live
                </button>
            </div>

            <!-- Categories -->
            <div class="flex gap-2 mb-6 overflow-x-auto hide-scrollbar">
                ${['All', 'Gaming', 'Music', 'Just Chatting', 'Art', 'Sports', 'Education'].map((cat, i) => `
                    <button class="px-4 py-2 rounded-full ${i === 0 ? 'bg-gradient-to-r from-red-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all whitespace-nowrap">
                        ${cat}
                    </button>
                `).join('')}
            </div>
            
            <!-- Live Now Section -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <span class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></span>
                    Live Now (${liveStreams.length})
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    ${liveStreams.map((stream, i) => `
                        <div class="glass rounded-2xl overflow-hidden hover-lift cursor-pointer group" onclick="watchLiveStream('${stream.id}')">
                            <div class="relative">
                                <img src="https://picsum.photos/600/340?random=${i + 50}" class="w-full aspect-video object-cover group-hover:scale-105 transition-transform duration-300">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"></div>
                                <div class="absolute top-3 left-3 flex gap-2">
                                    <span class="px-2 py-1 rounded-full live-badge text-xs font-bold flex items-center gap-1">
                                        <span class="w-1.5 h-1.5 rounded-full bg-white animate-pulse"></span>
                                        LIVE
                                    </span>
                                    <span class="px-2 py-1 rounded-full bg-black/50 text-xs backdrop-blur-sm">
                                        <i class="fas fa-eye mr-1"></i>${formatNumber(stream.viewers)}
                                    </span>
                                </div>
                                <div class="absolute bottom-3 left-3 right-3">
                                    <h3 class="font-semibold mb-1 line-clamp-1">${stream.title}</h3>
                                    <span class="text-xs text-gray-300 bg-white/10 px-2 py-1 rounded-full">${stream.category}</span>
                                </div>
                            </div>
                            <div class="p-4">
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="relative">
                                            <img src="${stream.user.avatar}" class="w-10 h-10 rounded-full object-cover ring-2 ring-red-500">
                                            <span class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-red-500 rounded-full border-2 border-dark-2"></span>
                                        </div>
                                        <div>
                                            <p class="font-medium flex items-center gap-1">
                                                ${stream.user.name}
                                                ${stream.user.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                                            </p>
                                            <p class="text-xs text-gray-400">@${stream.user.username}</p>
                                        </div>
                                    </div>
                                    <button onclick="event.stopPropagation(); followUser('${stream.user.id}')" class="px-3 py-1.5 rounded-full bg-white/10 text-sm hover:bg-white/20 transition-all">
                                        Follow
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>

            <!-- Upcoming Streams -->
            <div class="mb-8">
                <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-calendar text-purple-400"></i>
                    Upcoming Streams
                </h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    ${[
                        { title: 'Album Release Party', time: 'Today, 8:00 PM', user: users[0] },
                        { title: 'Weekly Q&A Session', time: 'Tomorrow, 3:00 PM', user: users[1] }
                    ].map((stream, i) => `
                        <div class="glass rounded-2xl p-4 flex items-center gap-4 hover-lift">
                            <div class="w-16 h-16 rounded-xl bg-gradient-to-br from-purple-500/30 to-pink-500/30 flex items-center justify-center">
                                <i class="fas fa-calendar-alt text-2xl text-purple-400"></i>
                            </div>
                            <div class="flex-1">
                                <h3 class="font-semibold">${stream.title}</h3>
                                <p class="text-sm text-gray-400">${stream.user.name}</p>
                                <p class="text-xs text-purple-400 mt-1"><i class="fas fa-clock mr-1"></i>${stream.time}</p>
                            </div>
                            <button class="px-4 py-2 rounded-xl bg-white/10 hover:bg-white/20 transition-all text-sm">
                                <i class="fas fa-bell mr-1"></i>Notify
                            </button>
                        </div>
                    `).join('')}
                </div>
            </div>

            <!-- Go Live CTA -->
            <div class="gradient-border rounded-2xl p-8 text-center">
                <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center animate-pulse-glow">
                    <i class="fas fa-video text-3xl"></i>
                </div>
                <h3 class="text-2xl font-bold mb-2">Start Your Own Live Stream</h3>
                <p class="text-gray-400 mb-6 max-w-md mx-auto">Share your moments in real-time with your audience. Engage with viewers, receive tips, and grow your community.</p>
                <div class="flex flex-col sm:flex-row gap-3 justify-center">
                    <button onclick="startLiveStream()" class="px-8 py-3 rounded-xl bg-gradient-to-r from-red-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                        <i class="fas fa-broadcast-tower mr-2"></i>
                        Go Live Now
                    </button>
                    <button onclick="scheduleLiveStream()" class="px-8 py-3 rounded-xl bg-white/10 font-semibold hover:bg-white/20 transition-all">
                        <i class="fas fa-calendar-plus mr-2"></i>
                        Schedule Stream
                    </button>
                </div>
            </div>
        `;
    }

    function startLiveStream() {
        showToast('Live streaming feature coming soon! üì∫', 'info');
    }

    function scheduleLiveStream() {
        showToast('Schedule your stream - Coming soon! üìÖ', 'info');
    }

    function watchLiveStream(streamId) {
        showToast('Joining live stream... üî¥', 'info');
    }

    // ==================== COMMUNITIES PAGE ====================
    let joinedCommunities = JSON.parse(localStorage.getItem('paseso_joined_communities')) || [];

    const allCommunities = [
        { id: 'c1', name: 'WebDevelopment', icon: 'üíª', members: 1200000, description: 'Discuss web technologies, frameworks, and best practices', color: 'from-blue-500 to-cyan-500', posts: 15600, online: 3400 },
        { id: 'c2', name: 'DigitalArt', icon: 'üé®', members: 890000, description: 'Share your digital artwork and get feedback', color: 'from-purple-500 to-pink-500', posts: 23400, online: 1890 },
        { id: 'c3', name: 'Gaming', icon: 'üéÆ', members: 4500000, description: 'Everything gaming - news, reviews, discussions', color: 'from-green-500 to-emerald-500', posts: 89000, online: 12400 },
        { id: 'c4', name: 'Photography', icon: 'üì∏', members: 2300000, description: 'Capture moments, share techniques', color: 'from-orange-500 to-red-500', posts: 34500, online: 4560 },
        { id: 'c5', name: 'Music', icon: 'üéµ', members: 3100000, description: 'Discover, share, and discuss music', color: 'from-pink-500 to-rose-500', posts: 45600, online: 7800 },
        { id: 'c6', name: 'Fitness', icon: 'üí™', members: 1800000, description: 'Workout tips, nutrition, and motivation', color: 'from-yellow-500 to-orange-500', posts: 28900, online: 2340 },
        { id: 'c7', name: 'Technology', icon: 'üöÄ', members: 2700000, description: 'Latest tech news and innovations', color: 'from-indigo-500 to-purple-500', posts: 56700, online: 5670 },
        { id: 'c8', name: 'Travel', icon: '‚úàÔ∏è', members: 1500000, description: 'Explore the world together', color: 'from-cyan-500 to-teal-500', posts: 19800, online: 1230 }
    ];

    function renderCommunitiesPage(container) {
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-users gradient-text"></i>
                    Communities
                </h1>
                <button onclick="openCreateCommunityModal()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium hover:opacity-90 transition-all">
                    <i class="fas fa-plus mr-2"></i>Create Community
                </button>
            </div>

            <!-- Search & Filter -->
            <div class="flex flex-col sm:flex-row gap-4 mb-6">
                <div class="relative flex-1">
                    <i class="fas fa-search absolute left-4 top-1/2 -translate-y-1/2 text-gray-400"></i>
                    <input type="text" id="community-search" placeholder="Search communities..." 
                        class="w-full pl-12 pr-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none"
                        oninput="filterCommunities()">
                </div>
                <select id="community-filter" class="px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none" onchange="filterCommunities()">
                    <option value="all">All Communities</option>
                    <option value="joined">Joined</option>
                    <option value="popular">Most Popular</option>
                    <option value="active">Most Active</option>
                </select>
            </div>

            <!-- Your Communities -->
            ${joinedCommunities.length > 0 ? `
                <div class="mb-8">
                    <h2 class="text-lg font-semibold mb-4 flex items-center gap-2">
                        <i class="fas fa-star text-yellow-400"></i>
                        Your Communities
                    </h2>
                    <div class="flex gap-4 overflow-x-auto pb-4 hide-scrollbar">
                        ${joinedCommunities.map(cId => {
                            const c = allCommunities.find(x => x.id === cId);
                            if (!c) return '';
                            return `
                                <div class="flex-shrink-0 w-32 text-center cursor-pointer" onclick="viewCommunity('${c.id}')">
                                    <div class="w-16 h-16 mx-auto rounded-2xl bg-gradient-to-br ${c.color} flex items-center justify-center text-2xl mb-2">
                                        ${c.icon}
                                    </div>
                                    <p class="font-medium text-sm truncate">p/${c.name}</p>
                                    <p class="text-xs text-green-400">${formatNumber(c.online)} online</p>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            ` : ''}

            <!-- All Communities Grid -->
            <div id="communities-grid" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${renderCommunityCards(allCommunities)}
            </div>
        `;
    }

    function renderCommunityCards(communities) {
        return communities.map(c => `
            <div class="glass rounded-2xl p-5 hover-lift transition-all">
                <div class="flex items-start gap-4">
                    <div class="w-16 h-16 rounded-2xl bg-gradient-to-br ${c.color} flex items-center justify-center text-3xl flex-shrink-0">
                        ${c.icon}
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center justify-between mb-1">
                            <h3 class="font-bold text-lg cursor-pointer hover:text-purple-400 transition-all" onclick="viewCommunity('${c.id}')">p/${c.name}</h3>
                            <button onclick="toggleJoinCommunity('${c.id}')" class="px-4 py-2 rounded-full ${joinedCommunities.includes(c.id) ? 'bg-white/10 hover:bg-red-500/20 hover:text-red-400' : 'bg-gradient-to-r from-indigo-500 to-pink-500'} font-medium text-sm transition-all">
                                ${joinedCommunities.includes(c.id) ? 'Joined ‚úì' : 'Join'}
                            </button>
                        </div>
                        <p class="text-sm text-gray-400 mb-3 line-clamp-2">${c.description}</p>
                        <div class="flex items-center gap-4 text-xs text-gray-400">
                            <span><i class="fas fa-users mr-1"></i>${formatNumber(c.members)} members</span>
                            <span><i class="fas fa-circle text-green-400 mr-1" style="font-size: 6px;"></i>${formatNumber(c.online)} online</span>
                            <span><i class="fas fa-file-alt mr-1"></i>${formatNumber(c.posts)} posts</span>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    function toggleJoinCommunity(communityId) {
        if (joinedCommunities.includes(communityId)) {
            // Leave community
            joinedCommunities = joinedCommunities.filter(id => id !== communityId);
            showToast('Left community', 'info');
        } else {
            // Join community and award a point
            joinedCommunities.push(communityId);
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 1;
            }
            showToast('Joined community! You earned 1 point! üéâ', 'success');
        }
        localStorage.setItem('paseso_joined_communities', JSON.stringify(joinedCommunities));
        // Persist any changes to user points resulting from joining or leaving communities
        saveData();
        showPage('communities');
    }

    function filterCommunities() {
        const search = document.getElementById('community-search').value.toLowerCase();
        const filter = document.getElementById('community-filter').value;

        let filtered = allCommunities.filter(c => 
            c.name.toLowerCase().includes(search) || 
            c.description.toLowerCase().includes(search)
        );

        if (filter === 'joined') {
            filtered = filtered.filter(c => joinedCommunities.includes(c.id));
        } else if (filter === 'popular') {
            filtered = [...filtered].sort((a, b) => b.members - a.members);
        } else if (filter === 'active') {
            filtered = [...filtered].sort((a, b) => b.online - a.online);
        }

        document.getElementById('communities-grid').innerHTML = renderCommunityCards(filtered);
    }

    /**
     * Generate the HTML for posts in a community. It uses the global
     * communityPosts dataset to retrieve posts for the given community ID
     * and builds cards similar to the main feed. Each post displays the
     * author, an optional image, the content and interactive buttons
     * (upvote, comment, share) with their current counts. If no posts
     * exist for the community, a message encourages users to be the first.
     *
     * @param {string} communityId The ID of the community whose posts to render.
     * @returns {string} The HTML string representing the list of posts.
     */
    function renderCommunityPosts(communityId) {
        const postsForCommunity = communityPosts[communityId] || [];
        if (!postsForCommunity || postsForCommunity.length === 0) {
            return '<p class="text-gray-400">No posts yet. Be the first to post!</p>';
        }
        return postsForCommunity.map(post => {
            const author = users.find(u => u.id === post.userId) || {};
            const community = allCommunities.find(c => c.id === communityId) || { name: '' };
            return `<div class="glass rounded-2xl p-4">
                        <div class="flex items-center gap-3 mb-3">
                            <img src="${author.avatar || DEFAULT_AVATAR}" class="w-10 h-10 rounded-full object-cover">
                            <div>
                                <span class="font-medium">${author.username || 'user'}</span>
                                <p class="text-xs text-gray-400">in p/${community.name}</p>
                            </div>
                        </div>
                        ${post.image ? `<img src="${post.image}" onerror="this.src='${DEFAULT_AVATAR}'" class="w-full h-40 rounded-xl object-cover mb-3">` : ''}
                        <p class="mb-3">${post.content}</p>
                        <div class="flex items-center gap-4 text-sm text-gray-400">
                            <button onclick="upvoteCommunityPost(this)" class="flex items-center gap-1 hover:text-orange-400 transition-all">
                                <i class="fas fa-arrow-up"></i>
                                <span>${post.upvotes}</span>
                            </button>
                            <button onclick="commentCommunityPost('${communityId}')" class="flex items-center gap-1 hover:text-blue-400 transition-all">
                                <i class="fas fa-comment"></i>
                                <span>${post.comments}</span>
                            </button>
                            <button onclick="shareCommunityPost('${communityId}', '${post.id}', this)" class="flex items-center gap-1 hover:text-green-400 transition-all">
                                <i class="fas fa-share"></i>
                                <span>${post.shares}</span>
                            </button>
                        </div>
                    </div>`;
        }).join('');
    }

    function viewCommunity(communityId) {
        const c = allCommunities.find(x => x.id === communityId);
        if (!c) return;

        const container = document.getElementById('page-container');
        container.innerHTML = `
            <button onclick="showPage('communities')" class="mb-4 flex items-center gap-2 text-gray-400 hover:text-white transition-all">
                <i class="fas fa-arrow-left"></i>
                Back to Communities
            </button>

            <div class="glass rounded-2xl overflow-hidden mb-6">
                <div class="h-32 bg-gradient-to-r ${c.color}"></div>
                <div class="p-6 -mt-10">
                    <div class="flex items-end gap-4 mb-4">
                        <div class="w-20 h-20 rounded-2xl bg-gradient-to-br ${c.color} flex items-center justify-center text-4xl border-4 border-dark-2">
                            ${c.icon}
                        </div>
                        <div class="flex-1">
                            <h1 class="text-2xl font-bold">p/${c.name}</h1>
                            <p class="text-gray-400">${c.description}</p>
                        </div>
                        <button onclick="toggleJoinCommunity('${c.id}')" class="px-6 py-3 rounded-xl ${joinedCommunities.includes(c.id) ? 'bg-white/10' : 'bg-gradient-to-r from-indigo-500 to-pink-500'} font-semibold transition-all">
                            ${joinedCommunities.includes(c.id) ? 'Joined ‚úì' : 'Join Community'}
                        </button>
                    </div>
                    <div class="flex gap-6 text-sm">
                        <span><strong>${formatNumber(c.members)}</strong> <span class="text-gray-400">members</span></span>
                        <span class="text-green-400"><i class="fas fa-circle mr-1" style="font-size: 6px;"></i>${formatNumber(c.online)} online</span>
                    </div>
                </div>
            </div>

            <!-- Community Posts -->
            <div class="space-y-4">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold">Recent Posts</h2>
                    <button onclick="openCreateModal()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                        <i class="fas fa-plus mr-2"></i>Create Post
                    </button>
                </div>
                ${renderCommunityPosts(c.id)}
            </div>
        `;
    }

    function openCreateCommunityModal() {
        showToast('Create your own community - Coming soon! üöÄ', 'info');
    }

    // ==================== COMMUNITY POST INTERACTIONS ====================
    /**
     * Handle upvote click for community posts. Toggles the upvote state and updates the count in place.
     * @param {HTMLElement} btn The button element containing the vote count.
     */
    function upvoteCommunityPost(btn) {
        const countEl = btn.querySelector('span');
        if (!countEl) return;
        let count = parseInt(countEl.textContent) || 0;
        // Toggle voted state using a custom data attribute
        if (btn.dataset.voted === 'true') {
            count = Math.max(0, count - 1);
            btn.dataset.voted = 'false';
            btn.classList.remove('text-orange-400');
        } else {
            count += 1;
            btn.dataset.voted = 'true';
            btn.classList.add('text-orange-400');
            // Award a point to the user for upvoting a community post
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 1;
                saveData();
            }
        }
        countEl.textContent = count;
    }

    /**
     * Handle comment click for community posts. Prompts the user for a comment and shows a toast.
     * @param {string} communityId The ID of the community where the post resides.
     */
    function commentCommunityPost(communityId) {
        const comment = prompt('Leave a comment:');
        if (comment && comment.trim()) {
            // Award points for commenting in a community
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 2;
            }
            saveData();
            showToast('Comment posted! You earned 2 points!', 'success');
        }
    }

    /**
     * Handle share click for community posts. Increments the share count and shows a toast.
     * @param {HTMLElement} btn The button element containing the share count.
     */
    /**
     * Share a community post. Increments the share count on the community post,
     * awards points to the sharer, creates a new post on the main feed and
     * notifies the original author. Accepts the communityId and the postId to
     * correctly identify the shared post. The third parameter is the button
     * element used to update the UI counts.
     *
     * @param {string} communityId The ID of the community where the post resides.
     * @param {string} postId The ID of the specific community post.
     * @param {HTMLElement} btn The share button element (for UI updates).
     */
    function shareCommunityPost(communityId, postId, btn) {
        try {
            const countEl = btn && btn.querySelector('span');
            // Increment share count on the UI if possible
            if (countEl) {
                let count = parseInt(countEl.textContent) || 0;
                count += 1;
                countEl.textContent = count;
                btn.classList.add('text-green-400');
            }
            // Find the community post object
            const postsForCommunity = communityPosts[communityId] || [];
            const communityPost = postsForCommunity.find(p => p.id === postId);
            if (!communityPost) {
                showToast('Post shared!', 'success');
                return;
            }
            // Increment share count in the dataset
            communityPost.shares = (communityPost.shares || 0) + 1;
            // Award points to sharer (3 points for sharing)
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 3;
            }
            // Create a new post for the main feed
            if (currentUser) {
                const newPostId = `p${Date.now()}`;
                const sharedFromUser = users.find(u => u.id === communityPost.userId) || {};
                const community = allCommunities.find(c => c.id === communityId) || { name: '' };
                const newPost = {
                    id: newPostId,
                    userId: currentUser.id,
                    content: `Shared from p/${community.name} by @${sharedFromUser.username || 'user'}: ${communityPost.content}`,
                    image: communityPost.image,
                    likes: 0,
                    comments: [],
                    shares: 0,
                    time: new Date().toISOString()
                };
                posts.unshift(newPost);
                // Notify the original author about the share
                pushNotification('share', currentUser.id, communityPost.userId, `${currentUser.username} shared your community post`);
            }
            saveData();
            showToast('Post shared! You earned 3 points! üîÑ', 'success');
        } catch (err) {
            console.error(err);
            showToast('Error sharing post', 'error');
        }
    }

    // ==================== CREATOR PAGE ====================
    let creatorTab = 'overview';

    function renderCreatorPage(container) {
        const userPosts = posts.filter(p => p.userId === currentUser?.id);
        const totalLikes = userPosts.reduce((sum, p) => sum + p.likes, 0);
        const totalComments = userPosts.reduce((sum, p) => sum + p.comments.length, 0);
        
        const earnings = currentUser?.earnings || Math.floor(Math.random() * 15000 + 5000);
        const subscribers = currentUser?.subscribers || Math.floor(Math.random() * 3000 + 500);
        
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-gem gradient-text"></i>
                    Creator Hub
                    <span class="px-3 py-1 text-sm rounded-full premium-badge">PRO</span>
                </h1>
                ${currentUser?.isCreator ? `
                    <button onclick="requestPayout()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 font-medium hover:opacity-90 transition-all">
                        <i class="fas fa-wallet mr-2"></i>Request Payout
                    </button>
                ` : ''}
            </div>
            
            ${!currentUser?.isCreator ? `
                <!-- Not a Creator Yet -->
                <div class="gradient-border rounded-2xl p-8 text-center mb-8">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-400 via-orange-500 to-red-500 flex items-center justify-center animate-float">
                        <i class="fas fa-crown text-3xl text-white"></i>
                    </div>
                    <h2 class="text-2xl font-bold mb-2">Become a PASESO Creator</h2>
                    <p class="text-gray-400 mb-6 max-w-lg mx-auto">Join our creator program and start earning from your content. Get access to exclusive tools, analytics, and monetization features.</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 max-w-2xl mx-auto">
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold gradient-text">85%</div>
                            <p class="text-sm text-gray-400">Revenue Share</p>
                        </div>
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold gradient-text">24h</div>
                            <p class="text-sm text-gray-400">Fast Payouts</p>
                        </div>
                        <div class="glass rounded-xl p-4 text-center">
                            <div class="text-2xl font-bold gradient-text">‚àû</div>
                            <p class="text-sm text-gray-400">Unlimited Posts</p>
                        </div>
                    </div>
                    
                    <button onclick="showPage('become-creator')" class="px-8 py-4 rounded-xl bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 text-black font-bold text-lg hover:opacity-90 transition-all">
                        <i class="fas fa-rocket mr-2"></i>Apply Now - It's Free!
                    </button>
                </div>
            ` : `
                <!-- Creator Dashboard -->
                <!-- Stats Cards -->
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                    <div class="stat-card rounded-2xl p-5 hover-lift">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 rounded-xl bg-green-500/20 flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-green-400"></i>
                            </div>
                            <span class="text-xs text-green-400 bg-green-500/20 px-2 py-1 rounded-full">+12.5%</span>
                        </div>
                        <div class="text-2xl font-bold mb-1">${formatNumber(earnings)}</div>
                        <p class="text-sm text-gray-400">This Month</p>
                    </div>
                    <div class="stat-card rounded-2xl p-5 hover-lift">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center">
                                <i class="fas fa-users text-purple-400"></i>
                            </div>
                            <span class="text-xs text-purple-400 bg-purple-500/20 px-2 py-1 rounded-full">+8.3%</span>
                        </div>
                        <div class="text-2xl font-bold mb-1">${formatNumber(subscribers)}</div>
                        <p class="text-sm text-gray-400">Subscribers</p>
                    </div>
                    <div class="stat-card rounded-2xl p-5 hover-lift">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 rounded-xl bg-pink-500/20 flex items-center justify-center">
                                <i class="fas fa-heart text-pink-400"></i>
                            </div>
                        </div>
                        <div class="text-2xl font-bold mb-1">${formatNumber(totalLikes)}</div>
                        <p class="text-sm text-gray-400">Total Likes</p>
                    </div>
                    <div class="stat-card rounded-2xl p-5 hover-lift">
                        <div class="flex items-center justify-between mb-2">
                            <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center">
                                <i class="fas fa-eye text-blue-400"></i>
                            </div>
                        </div>
                        <div class="text-2xl font-bold mb-1">${formatNumber(subscribers * 15)}</div>
                        <p class="text-sm text-gray-400">Profile Views</p>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="flex gap-2 mb-6 overflow-x-auto hide-scrollbar">
                    ${['overview', 'earnings', 'subscribers', 'content'].map(tab => `
                        <button onclick="switchCreatorTab('${tab}')" class="creator-tab px-5 py-2.5 rounded-xl ${creatorTab === tab ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium whitespace-nowrap capitalize">
                            ${tab}
                        </button>
                    `).join('')}
                </div>

                <div id="creator-content">
                    ${renderCreatorContent()}
                </div>
            `}

            <!-- Quick Actions -->
            <div class="mt-8">
                <h2 class="text-xl font-bold mb-4">Quick Actions</h2>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button onclick="openCreateModal()" class="glass rounded-2xl p-5 text-center hover:bg-white/10 transition-all hover-lift">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center">
                            <i class="fas fa-plus text-xl"></i>
                        </div>
                        <p class="font-medium">New Post</p>
                        <p class="text-xs text-gray-400 mt-1">Share content</p>
                    </button>
                    <button onclick="openCreateStoryModal()" class="glass rounded-2xl p-5 text-center hover:bg-white/10 transition-all hover-lift">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center">
                            <i class="fas fa-circle-plus text-xl"></i>
                        </div>
                        <p class="font-medium">Add Story</p>
                        <p class="text-xs text-gray-400 mt-1">24h content</p>
                    </button>
                    <button onclick="showToast('Live streaming coming soon!', 'info')" class="glass rounded-2xl p-5 text-center hover:bg-white/10 transition-all hover-lift">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-red-500 to-pink-500 flex items-center justify-center">
                            <i class="fas fa-broadcast-tower text-xl"></i>
                        </div>
                        <p class="font-medium">Go Live</p>
                        <p class="text-xs text-gray-400 mt-1">Stream now</p>
                    </button>
                    <button onclick="showPage('messages')" class="glass rounded-2xl p-5 text-center hover:bg-white/10 transition-all hover-lift">
                        <div class="w-12 h-12 mx-auto mb-3 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-500 flex items-center justify-center">
                            <i class="fas fa-envelope text-xl"></i>
                        </div>
                        <p class="font-medium">Messages</p>
                        <p class="text-xs text-gray-400 mt-1">Chat with fans</p>
                    </button>
                </div>
            </div>
        `;
    }

    function renderCreatorContent() {
        const earnings = currentUser?.earnings || Math.floor(Math.random() * 15000 + 5000);
        const subscribers = currentUser?.subscribers || Math.floor(Math.random() * 3000 + 500);
        
        switch(creatorTab) {
            case 'overview':
                return `
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Earnings Chart Placeholder -->
                        <div class="glass rounded-2xl p-6">
                            <h3 class="font-bold mb-4">Earnings Overview</h3>
                            <div class="h-48 flex items-end justify-around gap-2">
                                ${['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'].map((day, i) => {
                                    const height = Math.floor(Math.random() * 70 + 30);
                                    return `
                                        <div class="flex flex-col items-center gap-2 flex-1">
                                            <div class="w-full bg-gradient-to-t from-purple-500 to-pink-500 rounded-t-lg transition-all hover:opacity-80" style="height: ${height}%"></div>
                                            <span class="text-xs text-gray-400">${day}</span>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                        
                        <!-- Recent Activity -->
                        <div class="glass rounded-2xl p-6">
                            <h3 class="font-bold mb-4">Recent Activity</h3>
                            <div class="space-y-4">
                                ${[
                                    { type: 'subscription', user: 'Alex M.', amount: 9.99, time: '2 min ago' },
                                    { type: 'tip', user: 'Sarah K.', amount: 25, time: '15 min ago' },
                                    { type: 'subscription', user: 'Mike D.', amount: 24.99, time: '1 hour ago' },
                                    { type: 'tip', user: 'Emma L.', amount: 10, time: '3 hours ago' }
                                ].map(a => `
                                    <div class="flex items-center gap-3 p-3 rounded-xl bg-white/5">
                                        <div class="w-10 h-10 rounded-full ${a.type === 'tip' ? 'bg-yellow-500/20' : 'bg-green-500/20'} flex items-center justify-center">
                                            <i class="fas ${a.type === 'tip' ? 'fa-gift text-yellow-400' : 'fa-user-plus text-green-400'}"></i>
                                        </div>
                                        <div class="flex-1">
                                            <p class="font-medium">${a.user} ${a.type === 'tip' ? 'sent a tip' : 'subscribed'}</p>
                                            <p class="text-xs text-gray-400">${a.time}</p>
                                        </div>
                                        <span class="font-bold text-green-400">+${a.amount}</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            case 'earnings':
                return `
                    <div class="space-y-6">
                        <div class="glass rounded-2xl p-6">
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h3 class="text-lg font-bold">Available Balance</h3>
                                    <p class="text-3xl font-bold gradient-text mt-2">${formatNumber(earnings * 0.85)}</p>
                                </div>
                                <button onclick="requestPayout()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-green-500 to-emerald-500 font-semibold hover:opacity-90 transition-all">
                                    <i class="fas fa-wallet mr-2"></i>Withdraw
                                </button>
                            </div>
                            <div class="grid grid-cols-3 gap-4 pt-4 border-t border-white/10">
                                <div class="text-center">
                                    <p class="text-lg font-bold">${formatNumber(earnings)}</p>
                                    <p class="text-sm text-gray-400">Gross Earnings</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-lg font-bold text-red-400">-${formatNumber(earnings * 0.15)}</p>
                                    <p class="text-sm text-gray-400">Platform Fee (15%)</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-lg font-bold text-green-400">${formatNumber(earnings * 0.85)}</p>
                                    <p class="text-sm text-gray-400">Net Earnings</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="glass rounded-2xl p-6">
                            <h3 class="font-bold mb-4">Earning Sources</h3>
                            <div class="space-y-3">
                                ${[
                                    { name: 'Subscriptions', amount: earnings * 0.6, percent: 60 },
                                    { name: 'Tips', amount: earnings * 0.25, percent: 25 },
                                    { name: 'PPV Messages', amount: earnings * 0.1, percent: 10 },
                                    { name: 'Other', amount: earnings * 0.05, percent: 5 }
                                ].map(s => `
                                    <div class="flex items-center gap-4">
                                        <div class="flex-1">
                                            <div class="flex items-center justify-between mb-1">
                                                <span class="font-medium">${s.name}</span>
                                                <span class="text-sm">${formatNumber(s.amount)}</span>
                                            </div>
                                            <div class="h-2 bg-white/10 rounded-full overflow-hidden">
                                                <div class="h-full bg-gradient-to-r from-purple-500 to-pink-500 rounded-full" style="width: ${s.percent}%"></div>
                                            </div>
                                        </div>
                                        <span class="text-sm text-gray-400 w-12">${s.percent}%</span>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
            case 'subscribers':
                return `
                    <div class="glass rounded-2xl p-6">
                        <h3 class="font-bold mb-4">Subscription Tiers</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                            ${[
                                { name: 'Bronze', price: 4.99, tier: 'bronze', subs: Math.floor(subscribers * 0.5), features: ['Basic content', 'Monthly updates'] },
                                { name: 'Silver', price: 9.99, tier: 'silver', subs: Math.floor(subscribers * 0.35), features: ['All Bronze perks', 'Exclusive posts', 'Direct messages'] },
                                { name: 'Gold', price: 24.99, tier: 'gold', subs: Math.floor(subscribers * 0.15), features: ['All Silver perks', 'Behind the scenes', 'Priority support', 'Custom content'] }
                            ].map(t => `
                                <div class="glass rounded-2xl p-5 border-2 tier-${t.tier} hover-lift">
                                    <div class="flex items-center justify-between mb-3">
                                        <h4 class="font-bold text-lg">${t.name}</h4>
                                        <span class="text-xl font-bold">${t.price}</span>
                                    </div>
                                    <p class="text-sm text-gray-400 mb-3">${t.subs} subscribers</p>
                                    <p class="text-sm font-medium text-green-400 mb-4">${formatNumber(t.subs * t.price * 0.85)}/mo</p>
                                    <ul class="space-y-2">
                                        ${t.features.map(f => `
                                            <li class="text-sm text-gray-400 flex items-center gap-2">
                                                <i class="fas fa-check text-green-400 text-xs"></i>${f}
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>
                            `).join('')}
                        </div>
                        <button onclick="showToast('Tier editor coming soon!', 'info')" class="w-full py-3 rounded-xl border border-dashed border-white/20 text-gray-400 hover:border-white/40 hover:text-white transition-all">
                            <i class="fas fa-plus mr-2"></i>Add New Tier
                        </button>
                    </div>
                `;
            case 'content':
                const userPosts = posts.filter(p => p.userId === currentUser?.id);
                return `
                    <div class="glass rounded-2xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="font-bold">Your Content (${userPosts.length})</h3>
                            <button onclick="openCreateModal()" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium text-sm">
                                <i class="fas fa-plus mr-2"></i>New Post
                            </button>
                        </div>
                        ${userPosts.length === 0 ? `
                            <div class="text-center py-12">
                                <i class="fas fa-photo-video text-4xl text-gray-600 mb-4"></i>
                                <p class="text-gray-400">No content yet. Start posting!</p>
                            </div>
                        ` : `
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                                ${userPosts.map(p => `
                                    <div class="aspect-square rounded-xl overflow-hidden relative group cursor-pointer" onclick="viewPost('${p.id}')">
                                        ${p.image ? `<img src="${p.image}" class="w-full h-full object-cover">` : `
                                            <div class="w-full h-full bg-gradient-to-br from-purple-500/20 to-pink-500/20 flex items-center justify-center p-3">
                                                <p class="text-sm text-center line-clamp-3">${p.content}</p>
                                            </div>
                                        `}
                                        <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex flex-col items-center justify-center">
                                            <div class="flex gap-4 mb-2">
                                                <span class="text-sm"><i class="fas fa-heart mr-1"></i>${formatNumber(p.likes)}</span>
                                                <span class="text-sm"><i class="fas fa-comment mr-1"></i>${p.comments.length}</span>
                                            </div>
                                            <button onclick="event.stopPropagation(); editPost('${p.id}')" class="text-xs text-purple-400 hover:text-purple-300">
                                                <i class="fas fa-edit mr-1"></i>Edit
                                            </button>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        `}
                    </div>
                `;
            default:
                return '';
        }
    }

    function switchCreatorTab(tab) {
        creatorTab = tab;
        document.getElementById('creator-content').innerHTML = renderCreatorContent();
        
        document.querySelectorAll('.creator-tab').forEach(btn => {
            btn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
            btn.classList.add('bg-white/5');
        });
        event.target.classList.remove('bg-white/5');
        event.target.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
    }

    function requestPayout() {
        const balance = (currentUser?.earnings || 12450) * 0.85;
        if (balance < 50) {
            showToast('Minimum payout is $50', 'error');
            return;
        }
        showToast(`Payout of ${formatNumber(balance)} requested! Processing in 24-48h.`, 'success');
    }

    // ==================== MESSAGES PAGE ====================
    function renderMessagesPage(container) {
        const conversations = users.slice(0, 5).map(u => {
            // Get last message with this user
            const userMsgs = messages.filter(m => 
                (m.fromId === currentUser?.id && m.toId === u.id) ||
                (m.fromId === u.id && m.toId === currentUser?.id)
            ).sort((a, b) => b.time - a.time);
            
            const unreadCount = messages.filter(m => 
                m.fromId === u.id && m.toId === currentUser?.id && !m.read
            ).length;

            return {
                ...u,
                lastMessage: userMsgs[0]?.content || 'Start a conversation...',
                time: userMsgs[0]?.time || Date.now(),
                unread: unreadCount
            };
        });

        // Set first conversation as active
        if (!currentChatUserId && conversations.length > 0) {
            currentChatUserId = conversations[0].id;
        }

        container.innerHTML = `
            <h1 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i class="fas fa-message gradient-text"></i>
                Messages
            </h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6" style="height: 70vh;">
                <!-- Conversations List -->
                <div class="glass rounded-2xl overflow-hidden flex flex-col">
                    <div class="p-4 border-b border-white/10">
                        <div class="relative">
                            <i class="fas fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 text-sm"></i>
                            <input type="text" id="message-search" placeholder="Search messages..." 
                                class="w-full pl-10 pr-4 py-2 rounded-xl bg-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500 text-sm"
                                oninput="filterConversations(this.value)">
                        </div>
                    </div>
                    <div class="flex-1 overflow-y-auto" id="conversations-list">
                        ${conversations.map((c, i) => `
                            <div class="conversation-item p-4 hover:bg-white/5 cursor-pointer transition-all ${c.id === currentChatUserId ? 'border-l-4 border-purple-500 bg-white/5' : ''}" 
                                data-user-id="${c.id}" data-name="${c.name.toLowerCase()}" onclick="selectConversation('${c.id}')">
                                <div class="flex items-center gap-3">
                                    <div class="relative flex-shrink-0">
                                        <img src="${c.avatar}" class="w-12 h-12 rounded-full object-cover">
                                        ${c.online ? '<span class="online-dot"></span>' : ''}
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-center justify-between">
                                            <span class="font-semibold truncate">${c.name}</span>
                                            <span class="text-xs text-gray-400 flex-shrink-0">${formatTime(c.time)}</span>
                                        </div>
                                        <p class="text-sm text-gray-400 truncate">${c.lastMessage}</p>
                                    </div>
                                    ${c.unread ? `<span class="w-5 h-5 rounded-full bg-purple-500 text-xs flex items-center justify-center font-bold flex-shrink-0">${c.unread}</span>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="p-3 border-t border-white/10">
                        <button onclick="startNewConversation()" class="w-full py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium text-sm hover:opacity-90 transition-all">
                            <i class="fas fa-plus mr-2"></i>New Message
                        </button>
                    </div>
                </div>
                
                <!-- Chat Area -->
                <div class="lg:col-span-2 glass rounded-2xl overflow-hidden flex flex-col">
                    <div class="p-4 border-b border-white/10 flex items-center justify-between">
                        <div class="flex items-center gap-3">
                            <img src="${conversations[0]?.avatar || DEFAULT_AVATAR}" class="w-10 h-10 rounded-full object-cover">
                            <div>
                                <p class="font-semibold">${conversations[0]?.name || 'Select a chat'}</p>
                                <p class="text-xs ${conversations[0]?.online ? 'text-green-400' : 'text-gray-400'}">${conversations[0]?.online ? 'Online' : 'Offline'}</p>
                            </div>
                        </div>
                        <div class="flex items-center gap-2">
                            <button onclick="startVideoCall('${conversations[0]?.id}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                                <i class="fas fa-video text-gray-400"></i>
                            </button>
                            <button onclick="startVoiceCall('${conversations[0]?.id}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                                <i class="fas fa-phone text-gray-400"></i>
                            </button>
                            <button onclick="openChatSettings('${conversations[0]?.id}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                                <i class="fas fa-ellipsis-v text-gray-400"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="flex-1 overflow-y-auto p-4 space-y-4" id="chat-messages">
                        <!-- Messages will be loaded here -->
                    </div>
                    
                    <div class="p-4 border-t border-white/10">
                        <div class="flex items-center gap-3">
                            <button onclick="attachImage()" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center text-gray-400 hover:text-purple-400 transition-all">
                                <i class="fas fa-image"></i>
                            </button>
                            <button onclick="toggleMessageEmoji()" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center text-gray-400 hover:text-yellow-400 transition-all">
                                <i class="fas fa-smile"></i>
                            </button>
                            <input type="text" id="message-input" placeholder="Type a message..." 
                                class="flex-1 px-4 py-3 rounded-xl bg-white/5 focus:outline-none focus:ring-2 focus:ring-purple-500"
                                onkeypress="if(event.key==='Enter') sendMessage()" maxlength="1000">
                            <button onclick="sendMessage()" class="w-10 h-10 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 flex items-center justify-center hover:opacity-90 transition-all">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;

        // Load first conversation messages
        if (currentChatUserId) {
            loadChatMessages(currentChatUserId);
        }
    }

    function filterConversations(query) {
        const items = document.querySelectorAll('.conversation-item');
        const q = query.toLowerCase();
        items.forEach(item => {
            const name = item.dataset.name;
            item.style.display = name.includes(q) ? '' : 'none';
        });
    }

    function startNewConversation() {
        showToast('Select a user from Explore to start chatting!', 'info');
        showPage('explore');
    }

    function attachImage() {
        showToast('Image sharing coming soon! üì∏', 'info');
    }

    function toggleMessageEmoji() {
        showToast('Emoji picker coming soon! üòä', 'info');
    }

    // ==================== NOTIFICATIONS PAGE ====================
    function renderNotificationsPage(container) {
        // Group notifications by date
        const today = new Date().toDateString();
        const yesterday = new Date(Date.now() - 86400000).toDateString();
        
        const grouped = {
            today: notifications.filter(n => new Date(n.time).toDateString() === today),
            yesterday: notifications.filter(n => new Date(n.time).toDateString() === yesterday),
            older: notifications.filter(n => {
                const date = new Date(n.time).toDateString();
                return date !== today && date !== yesterday;
            })
        };

        // Mark as read after render
        setTimeout(() => {
            notifications.forEach(n => n.read = true);
            saveData();
            updateNotificationBadges();
        }, 1000);

        const renderNotifGroup = (notifs, title) => {
            if (notifs.length === 0) return '';
            return `
                <div class="mb-6">
                    <h3 class="text-sm font-semibold text-gray-400 mb-3 uppercase tracking-wide">${title}</h3>
                    <div class="space-y-2">
                        ${notifs.map(n => {
                            const user = users.find(u => u.id === n.userId) || { avatar: DEFAULT_AVATAR, name: 'Someone' };
                            const iconMap = { 
                                like: 'fa-heart text-pink-500', 
                                comment: 'fa-comment text-blue-500', 
                                follow: 'fa-user-plus text-purple-500', 
                                live: 'fa-broadcast-tower text-red-500',
                                mention: 'fa-at text-cyan-500',
                                share: 'fa-retweet text-green-500'
                            };
                            const bgMap = { 
                                like: 'bg-pink-500/20', 
                                comment: 'bg-blue-500/20', 
                                follow: 'bg-purple-500/20', 
                                live: 'bg-red-500/20',
                                mention: 'bg-cyan-500/20',
                                share: 'bg-green-500/20'
                            };
                            
                            return `
                                <div class="glass rounded-xl p-4 flex items-center gap-4 hover:bg-white/5 transition-all cursor-pointer ${!n.read ? 'border-l-4 border-purple-500' : ''}" 
                                    onclick="handleNotificationClick('${n.id}', '${n.type}', '${n.userId}')">
                                    <div class="relative">
                                        <img src="${user.avatar}" class="w-12 h-12 rounded-full object-cover">
                                        <div class="absolute -bottom-1 -right-1 w-6 h-6 rounded-full ${bgMap[n.type] || 'bg-gray-500/20'} flex items-center justify-center">
                                            <i class="fas ${iconMap[n.type] || 'fa-bell text-gray-400'} text-xs"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="line-clamp-2"><span class="font-semibold">${user.name}</span> ${n.message}</p>
                                        <p class="text-sm text-gray-400">${formatTime(n.time)}</p>
                                    </div>
                                    ${!n.read ? '<div class="w-2 h-2 rounded-full bg-purple-500"></div>' : ''}
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        };

        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-bell gradient-text"></i>
                    Notifications
                </h1>
                <div class="flex gap-2">
                    <button onclick="markAllNotificationsRead()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all text-sm">
                        <i class="fas fa-check-double mr-2"></i>Mark all read
                    </button>
                    <button onclick="clearAllNotifications()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all text-sm text-red-400">
                        <i class="fas fa-trash mr-2"></i>Clear all
                    </button>
                </div>
            </div>

            ${notifications.length === 0 ? `
                <div class="text-center py-16">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center">
                        <i class="fas fa-bell-slash text-4xl text-gray-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">No notifications</h3>
                    <p class="text-gray-400">When someone interacts with you, you'll see it here</p>
                </div>
            ` : `
                ${renderNotifGroup(grouped.today, 'Today')}
                ${renderNotifGroup(grouped.yesterday, 'Yesterday')}
                ${renderNotifGroup(grouped.older, 'Earlier')}
            `}
        `;
    }

    function handleNotificationClick(notifId, type, userId) {
        const notif = notifications.find(n => n.id === notifId);
        if (notif) notif.read = true;
        saveData();

        switch(type) {
            case 'follow':
            case 'like':
            case 'comment':
                viewUserProfile(userId);
                break;
            case 'live':
                showPage('live');
                break;
            case 'message':
                currentChatUserId = userId;
                showPage('messages');
                break;
            default:
                viewUserProfile(userId);
        }
    }

    function markAllNotificationsRead() {
        notifications.forEach(n => n.read = true);
        saveData();
        updateNotificationBadges();
        showPage('notifications');
        showToast('All notifications marked as read', 'success');
    }

    function clearAllNotifications() {
        if (confirm('Clear all notifications? This cannot be undone.')) {
            notifications = [];
            saveData();
            updateNotificationBadges();
            showPage('notifications');
            showToast('Notifications cleared', 'info');
        }
    }

    // ==================== SAVED PAGE ====================
    function renderSavedPage(container) {
        const savedPosts = posts.filter(p => p.saved);
        
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-bookmark gradient-text"></i>
                    Saved Posts
                    <span class="text-lg text-gray-400 font-normal">(${savedPosts.length})</span>
                </h1>
                ${savedPosts.length > 0 ? `
                    <button onclick="clearSavedPosts()" class="px-4 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all text-sm text-red-400">
                        <i class="fas fa-trash mr-2"></i>Clear all
                    </button>
                ` : ''}
            </div>
            ${savedPosts.length === 0 ? `
                <div class="text-center py-16">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-white/5 flex items-center justify-center">
                        <i class="fas fa-bookmark text-4xl text-gray-600"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">No saved posts yet</h3>
                    <p class="text-gray-400 mb-4">Tap the bookmark icon on posts you want to save</p>
                    <button onclick="showPage('feed')" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium">
                        <i class="fas fa-home mr-2"></i>Browse Feed
                    </button>
                </div>
            ` : `
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                    ${savedPosts.map(post => `
                        <div class="aspect-square rounded-2xl overflow-hidden cursor-pointer hover-lift group relative" onclick="viewPost('${post.id}')">
                            ${post.image ? `
                                <img src="${post.image}" class="w-full h-full object-cover">
                            ` : `
                                <div class="w-full h-full bg-gradient-to-br from-indigo-500/20 to-pink-500/20 flex items-center justify-center p-4">
                                    <p class="text-sm text-center line-clamp-4">${post.content}</p>
                                </div>
                            `}
                            <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex flex-col items-center justify-center gap-2">
                                <div class="flex items-center gap-4">
                                    <span class="flex items-center gap-1"><i class="fas fa-heart"></i> ${formatNumber(post.likes)}</span>
                                    <span class="flex items-center gap-1"><i class="fas fa-comment"></i> ${post.comments.length}</span>
                                </div>
                                <button onclick="event.stopPropagation(); unsavePost('${post.id}')" class="mt-2 px-3 py-1 rounded-full bg-white/20 text-sm hover:bg-red-500/50 transition-all">
                                    <i class="fas fa-bookmark mr-1"></i>Unsave
                                </button>
                            </div>
                            <div class="absolute top-2 right-2">
                                <i class="fas fa-bookmark text-yellow-400"></i>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `}
        `;
    }

    function unsavePost(postId) {
        const post = posts.find(p => p.id === postId);
        if (post) {
            post.saved = false;
            saveData();
            showPage('saved');
            showToast('Post removed from saved', 'info');
        }
    }

    function clearSavedPosts() {
        if (confirm('Remove all saved posts?')) {
            posts.forEach(p => p.saved = false);
            saveData();
            showPage('saved');
            showToast('All saved posts cleared', 'info');
        }
    }

    // ==================== ADMIN PANEL PAGE ====================
    /**
     * Render the administrative control panel. Only users with role 'admin' or 'moderator' can view this page.
     * Provides lists of users, posts and marketplace items with actions to modify or delete entries.
     * If access is denied, a message is displayed instead.
     *
     * @param {HTMLElement} container
     */
    function renderAdminPage(container) {
        if (!currentUser || (currentUser.role !== 'admin' && currentUser.role !== 'moderator')) {
            container.innerHTML = `
                <div class="p-6">
                    <h1 class="text-3xl font-bold mb-4 flex items-center gap-3">
                        <i class="fas fa-tools gradient-text"></i>
                        Admin Panel
                    </h1>
                    <p class="text-gray-400">You do not have permission to access this page.</p>
                </div>
            `;
            return;
        }
        container.innerHTML = `
            <div class="space-y-8">
                <div>
                    <h1 class="text-3xl font-bold mb-4 flex items-center gap-3">
                        <i class="fas fa-tools gradient-text"></i>
                        Admin Panel
                    </h1>
                    <p class="text-gray-400 mb-6">Manage users, posts, and marketplace items.</p>
                </div>
                <div class="grid md:grid-cols-2 gap-6">
                    <div class="glass rounded-2xl p-6 overflow-y-auto max-h-[50vh]">
                        <h2 class="text-2xl font-bold mb-4">Users</h2>
                        <div class="space-y-3">
                            ${users.map(u => `
                                <div class="bg-white/5 rounded-xl p-3 flex items-center justify-between">
                                    <div class="flex items-center gap-3">
                                        <img src="${u.avatar || DEFAULT_AVATAR}" class="w-8 h-8 rounded-full object-cover">
                                        <div>
                                            <p class="font-semibold">${u.name}</p>
                                <p class="text-xs text-gray-400">@${u.username} ‚Ä¢ ${u.role || 'user'} ‚Ä¢ ${u.points || 0} pts</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <button onclick="changeUserRole('${u.id}')" class="text-xs px-2 py-1 rounded bg-indigo-500 hover:bg-indigo-600">Role</button>
                                        <button onclick="deleteUser('${u.id}')" class="text-xs px-2 py-1 rounded bg-red-500 hover:bg-red-600">Delete</button>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div class="glass rounded-2xl p-6 overflow-y-auto max-h-[50vh]">
                        <h2 class="text-2xl font-bold mb-4">Posts</h2>
                        <div class="space-y-3">
                            ${posts.map(p => `
                                <div class="bg-white/5 rounded-xl p-3 flex items-start justify-between">
                                    <div class="flex-1 pr-2">
                                        <p class="font-semibold">@${users.find(u => u.id === p.userId)?.username || 'user'}</p>
                                        <p class="text-xs text-gray-400">${p.content.slice(0, 80)}${p.content.length > 80 ? '‚Ä¶' : ''}</p>
                                    </div>
                                    <button onclick="deletePost('${p.id}')" class="text-xs px-2 py-1 rounded bg-red-500 hover:bg-red-600 h-fit">Delete</button>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
                <div class="glass rounded-2xl p-6 overflow-y-auto max-h-[40vh]">
                    <h2 class="text-2xl font-bold mb-4">Marketplace Items</h2>
                    <div class="space-y-3">
                        ${marketplaceItems.map(item => `
                            <div class="bg-white/5 rounded-xl p-3 flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <img src="${item.image}" class="w-8 h-8 rounded-md object-cover">
                                    <div>
                                        <p class="font-semibold">${item.title}</p>
                                        <p class="text-xs text-gray-400">${item.price}</p>
                                    </div>
                                </div>
                                <button onclick="removeMarketplaceItem('${item.id}')" class="text-xs px-2 py-1 rounded bg-red-500 hover:bg-red-600">Remove</button>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <!-- Community Posts Admin Panel -->
                <div class="glass rounded-2xl p-6 overflow-y-auto max-h-[40vh]">
                    <h2 class="text-2xl font-bold mb-4">Community Posts</h2>
                    <div class="space-y-3">
                        ${Object.keys(communityPosts).map(commId => {
                            return communityPosts[commId].map(post => {
                                const author = users.find(u => u.id === post.userId) || {};
                                const community = allCommunities.find(c => c.id === commId) || { name: '' };
                                return `<div class="bg-white/5 rounded-xl p-3 flex items-start justify-between">
                                    <div class="flex-1 pr-2">
                                        <p class="font-semibold">@${author.username || 'user'} in p/${community.name}</p>
                                        <p class="text-xs text-gray-400">${post.content.slice(0, 80)}${post.content.length > 80 ? '‚Ä¶' : ''}</p>
                                    </div>
                                    <button onclick="deleteCommunityPost('${commId}','${post.id}')" class="text-xs px-2 py-1 rounded bg-red-500 hover:bg-red-600 h-fit">Delete</button>
                                </div>`;
                            }).join('');
                        }).join('')}
                    </div>
                </div>

                <!-- Announcements section -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-2xl font-bold mb-4">Announcements</h2>
                    <p class="text-gray-400 mb-3">Send a platform‚Äëwide announcement to all users. The message will appear in everyone‚Äôs notifications.</p>
                    <button onclick="sendAnnouncement()" class="px-3 py-2 rounded bg-indigo-500 hover:bg-indigo-600 text-sm">New Announcement</button>
                </div>
            </div>
        `;
    }

    /**
     * Delete a user from the platform. Removes their posts and updates the dataset.
     * Admins cannot delete themselves. After deletion the admin page is re-rendered.
     * @param {string} userId
     */
    function deleteUser(userId) {
        if (currentUser && currentUser.id === userId) {
            showToast('You cannot delete your own account.', 'error');
            return;
        }
        users = users.filter(u => u.id !== userId);
        posts = posts.filter(p => p.userId !== userId);
        messages = messages.filter(m => m.fromId !== userId && m.toId !== userId);
        notifications = notifications.filter(n => n.userId !== userId && n.toId !== userId);
        saveData();
        showToast('User deleted.', 'info');
        const container = document.getElementById('page-container');
        renderAdminPage(container);
    }

    /**
     * Delete a post by ID and update storage. After deletion re-render admin page.
     * @param {string} postId
     */
    function deletePost(postId) {
        posts = posts.filter(p => p.id !== postId);
        notifications = notifications.filter(n => n.entityId !== postId);
        saveData();
        showToast('Post deleted.', 'info');
        const container = document.getElementById('page-container');
        renderAdminPage(container);
    }

    /**
     * Change a user's role. Prompts for a new role and applies if valid.
     * @param {string} userId
     */
    function changeUserRole(userId) {
        const user = users.find(u => u.id === userId);
        if (!user) return;
        const newRole = prompt('Enter new role for ' + user.username + ' (user, moderator, admin):', user.role || 'user');
        if (!newRole) return;
        const allowed = ['user', 'moderator', 'admin'];
        if (!allowed.includes(newRole)) {
            showToast('Invalid role. Allowed: user, moderator, admin.', 'error');
            return;
        }
        user.role = newRole;
        saveData();
        showToast('Role updated.', 'success');
        const container = document.getElementById('page-container');
        renderAdminPage(container);
    }

    /**
     * Remove a marketplace item by ID. After deletion re-render admin page.
     * @param {string} itemId
     */
    function removeMarketplaceItem(itemId) {
        marketplaceItems = marketplaceItems.filter(item => item.id !== itemId);
        saveData();
        showToast('Marketplace item removed.', 'info');
        const container = document.getElementById('page-container');
        renderAdminPage(container);
    }

    /**
     * Delete a community post given a community ID and post ID. Removes the post
     * from the communityPosts dataset, saves data and re-renders the admin page.
     * @param {string} communityId
     * @param {string} postId
     */
    function deleteCommunityPost(communityId, postId) {
        if (!communityPosts[communityId]) return;
        communityPosts[communityId] = communityPosts[communityId].filter(p => p.id !== postId);
        saveData();
        showToast('Community post deleted.', 'info');
        const container = document.getElementById('page-container');
        renderAdminPage(container);
    }

    /**
     * Send a platform‚Äëwide announcement. Prompts the admin for a message and
     * creates a new notification with type 'announcement' that is delivered to
     * all users (toId remains null). Users will see this in their
     * notifications feed. Points are not awarded for announcements.
     */
    function sendAnnouncement() {
        if (!currentUser || (currentUser.role !== 'admin' && currentUser.role !== 'moderator')) {
            showToast('Only admins or moderators can send announcements.', 'error');
            return;
        }
        const message = prompt('Enter announcement message:');
        if (!message) return;
        const announcement = {
            id: 'ann' + Date.now(),
            type: 'announcement',
            fromId: currentUser.id,
            toId: null,
            message: message,
            time: Date.now(),
            read: false
        };
        notifications.unshift(announcement);
        saveData();
        updateNotificationBadges();
        showToast('Announcement sent!', 'success');
        // Optionally re‚Äërender notifications page if open
        const container = document.getElementById('page-container');
        if (container && container.dataset.page === 'notifications') {
            renderNotificationsPage(container);
        }
    }

    // ==================== LEADERBOARD PAGE ====================
    /**
     * Render the Leaderboard page, showcasing top users based on a composite
     * score derived from likes, comments, shares and followers. A simulated
     * "gifts" metric (derived from engagement) is used to rank users and
     * illustrate potential monetisation opportunities. All metrics are
     * displayed transparently in a grid for each user.
     *
     * @param {HTMLElement} container The container element where the page
     *                                content should be injected.
     */
    function renderLeaderboardPage(container) {
        // Calculate metrics for each user
        const leaderboard = users.map(u => {
            const userPosts = posts.filter(p => p.userId === u.id);
            const postsCount = userPosts.length;
            const likes = userPosts.reduce((sum, p) => sum + (p.likes || 0), 0);
            const comments = userPosts.reduce((sum, p) => sum + (p.comments ? p.comments.length : 0), 0);
            const shares = userPosts.reduce((sum, p) => sum + (p.shares || 0), 0);
            // Simulate gift income as a function of engagement
            const gifts = Math.floor((likes + shares) / 50 + comments / 10);
            return {
                user: u,
                postsCount,
                likes,
                comments,
                shares,
                gifts,
                followers: u.followers || 0
            };
        });
        // Sort by gifts descending, then followers
        leaderboard.sort((a, b) => {
            if (b.gifts !== a.gifts) return b.gifts - a.gifts;
            return (b.followers || 0) - (a.followers || 0);
        });
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-trophy gradient-text"></i>
                    Leaderboard
                </h1>
                <p class="text-gray-400">Top ${leaderboard.length} creators</p>
            </div>
            <div class="space-y-4">
                ${leaderboard.map((entry, i) => {
                    const u = entry.user;
                    return `<div class="glass rounded-2xl p-4 flex items-center gap-4 hover-lift">
                        <span class="text-3xl font-bold text-gray-600 w-8 text-right">${i + 1}</span>
                        <img src="${u.avatar}" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold truncate">${u.name}</span>
                                ${u.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                            </div>
                            <p class="text-sm text-gray-400 truncate">@${u.username}</p>
                            <div class="grid grid-cols-2 md:grid-cols-6 gap-x-4 gap-y-1 text-xs mt-2">
                                <span><i class="fas fa-gift mr-1 text-yellow-400"></i>${formatNumber(entry.gifts)}</span>
                                <span><i class="fas fa-heart mr-1 text-pink-500"></i>${formatNumber(entry.likes)}</span>
                                <span><i class="fas fa-comment mr-1 text-blue-500"></i>${formatNumber(entry.comments)}</span>
                                <span><i class="fas fa-retweet mr-1 text-green-500"></i>${formatNumber(entry.shares)}</span>
                                <span><i class="fas fa-users mr-1 text-purple-500"></i>${formatNumber(entry.followers)}</span>
                                <span><i class="fas fa-file-alt mr-1 text-orange-500"></i>${formatNumber(entry.postsCount)}</span>
                            </div>
                        </div>
                        <button onclick="viewUserProfile('${u.id}')" class="ml-auto px-4 py-2 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 text-sm font-medium hover:opacity-90 transition-all">
                            View
                        </button>
                    </div>`;
                }).join('')}
            </div>
        `;
    }

    // ==================== REWARDS PAGE ====================
    /**
     * Render the Rewards page. This page acts as a gamification hub,
     * ranking users by the number of points they have earned. Users
     * accumulate points whenever they share a post or community post.
     *
     * @param {HTMLElement} container The container element where the page
     *                                content should be injected.
     */
    function renderRewardsPage(container) {
        // Build a scoreboard sorted by points descending
        const scoreboard = users.map(u => ({ user: u, points: u.points || 0 }));
        scoreboard.sort((a, b) => b.points - a.points);
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-coins gradient-text"></i>
                    Rewards & Gamification
                </h1>
                <p class="text-gray-400">Earn points by sharing posts</p>
            </div>
            <div class="space-y-4">
                ${scoreboard.map((entry, i) => {
                    const u = entry.user;
                    return `<div class="glass rounded-2xl p-4 flex items-center gap-4 hover-lift">
                        <span class="text-3xl font-bold text-gray-600 w-8 text-right">${i + 1}</span>
                        <img src="${u.avatar}" class="w-12 h-12 rounded-full object-cover">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center gap-2">
                                <span class="font-semibold truncate">${u.name}</span>
                                ${u.verified ? '<span class="verified w-4 h-4 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                                ${u.premium ? '<span class="px-2 py-0.5 text-xs rounded-full premium-badge font-semibold ml-1">PRO</span>' : ''}
                            </div>
                            <p class="text-sm text-gray-400 truncate">@${u.username}</p>
                        </div>
                        <div class="ml-auto flex items-center gap-1 text-lg font-bold">
                            <i class="fas fa-coins text-yellow-400"></i>${formatNumber(entry.points)}
                        </div>
                    </div>`;
                }).join('')}
            </div>
        `;
    }

    // ==================== MARKETPLACE PAGE ====================
    /**
     * Render the Marketplace page. Displays a grid of premium items
     * that users can purchase. Items are loaded from the marketplaceItems
     * array, which is initialised in loadData() from local storage or
     * the default dataset. Buying an item currently triggers a toast.
     *
     * @param {HTMLElement} container The container where the page is rendered
     */
    function renderMarketplacePage(container) {
        const items = marketplaceItems || [];
        // Group items by category to create sections for each type of product
        const itemsByCategory = {};
        items.forEach(item => {
            if (!itemsByCategory[item.category]) itemsByCategory[item.category] = [];
            itemsByCategory[item.category].push(item);
        });
        const categories = Object.keys(itemsByCategory);
        container.innerHTML = `
            <div class="flex items-center justify-between mb-6">
                <h1 class="text-2xl font-bold flex items-center gap-3">
                    <i class="fas fa-shopping-bag gradient-text"></i>
                    Marketplace
                    <span class="text-lg text-gray-400 font-normal">(${items.length})</span>
                </h1>
            </div>
            ${categories.map(category => {
                const catItems = itemsByCategory[category];
                return `
                    <h2 class="text-xl font-semibold mb-3 mt-6 flex items-center gap-2">
                        <span class="inline-block w-3 h-3 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500"></span>
                        ${category}
                    </h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${catItems.map(item => `
                            <div class="glass rounded-2xl overflow-hidden flex flex-col hover-lift transition-all">
                                <div class="relative pb-56 overflow-hidden">
                                    <img src="${item.image}" alt="${item.title}" class="absolute inset-0 w-full h-full object-cover">
                                </div>
                                <div class="p-4 flex-1 flex flex-col justify-between">
                                    <div>
                                        <h3 class="font-bold text-lg mb-1">${item.title}</h3>
                                        <p class="text-sm text-gray-400 mb-3 line-clamp-3">${item.description}</p>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="font-semibold text-purple-400">${item.price}</span>
                                        <button onclick="buyMarketplaceItem('${item.id}')" class="px-4 py-2 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium text-sm hover:opacity-90 transition-all">
                                            Buy Now
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('')}
            <div class="mt-10 glass rounded-2xl p-6 text-center">
                <h3 class="text-2xl font-bold mb-2 flex items-center justify-center gap-2">
                    <i class="fas fa-upload text-purple-400"></i>
                    Become a Seller
                </h3>
                <p class="text-gray-400 mb-4">Got a digital product? List it on our marketplace and reach millions of users.</p>
                <!-- On click, prompt the user for product details and add to the marketplace -->
                <button class="px-6 py-3 rounded-xl bg-gradient-to-r from-purple-500 to-pink-500 font-semibold text-sm hover:opacity-90 transition-all" onclick="addMarketplaceItem()">
                    List your product
                </button>
            </div>
        `;
    }

    /**
     * Handle purchase of a marketplace item. Currently shows a toast to
     * indicate that the purchase is a placeholder. In a real integration,
     * this would initiate a payment workflow via a backend service.
     *
     * @param {string} itemId The ID of the item being purchased
     */
    function buyMarketplaceItem(itemId) {
        const item = marketplaceItems.find(i => i.id === itemId);
        if (item) {
            showToast(`Purchase successful! You bought ${item.title}.`, 'success');
            // Placeholder: here you could mark the item as owned or remove it
        } else {
            showToast('Item not found', 'error');
        }
    }

    /**
     * Prompt the user to list a new product in the marketplace. This helper
     * requests details via simple prompt dialogs and adds the item to the
     * global marketplaceItems array. In a full application you would
     * implement a form modal and validation, but here we simulate the
     * workflow. After adding, data is saved and the marketplace page is
     * re-rendered. If the user cancels at any step, no item is added.
     */
    function addMarketplaceItem() {
        const title = prompt('Enter product title:');
        if (!title) return;
        const description = prompt('Enter product description:');
        if (!description) return;
        const price = prompt('Enter product price (e.g., $9.99):');
        if (!price) return;
        const category = prompt('Enter product category (e.g., Badges, Themes, Stickers, Subscriptions, VIP Access, Advertising):');
        if (!category) return;
        const imageUrl = prompt('Enter image URL:');
        if (!imageUrl) return;
        // Generate a unique ID using the current timestamp
        const id = 'marketplace-' + Date.now();
        const newItem = { id, title, description, price, category, image: imageUrl };
        if (!Array.isArray(marketplaceItems)) {
            marketplaceItems = [];
        }
        marketplaceItems.push(newItem);
        saveData();
        // Re-render the marketplace page if we're currently on it
        const container = document.getElementById('page-marketplace');
        if (container) {
            renderMarketplacePage(container);
        }
        showToast('Product added successfully!', 'success');
    }

    // ==================== ABOUT PAGE ====================
    /**
     * Render the About/Team & Investors page. Provides information
     * about PASESO‚Äôs mission, the team behind the platform, and a
     * section inviting potential investors or collaborators. You can
     * modify the content here to reflect your actual story and goals.
     *
     * @param {HTMLElement} container The container where the page is rendered
     */
    function renderAboutPage(container) {
        container.innerHTML = `
            <div class="mb-8">
                <h1 class="text-3xl font-bold mb-4 flex items-center gap-3">
                    <i class="fas fa-info-circle gradient-text"></i>
                    About PASESO
                </h1>
                <p class="text-gray-400 leading-relaxed mb-4">
                    PASESO is a Romanian‚Äëpowered social platform built for the world. Our mission is to empower creators and communities by providing a unified space for sharing stories, live moments, reels, and more. We believe in transparency, creativity and connecting people across the globe.
                </p>
                <p class="text-gray-400 leading-relaxed mb-4">
                    The platform is developed by a passionate team of designers, developers and dreamers. We are constantly iterating to build the ultimate social experience ‚Äî combining the best of modern apps like TikTok, Instagram and Discord while adding our unique touch.
                </p>
                <h2 class="text-2xl font-bold mb-3 mt-6">Our Team</h2>
                <ul class="space-y-2">
                    <li><strong>Paun</strong> ‚Äì Founder & Visionary</li>
                    <li><strong>Design Team</strong> ‚Äì Crafting seamless UX and stunning visuals</li>
                    <li><strong>Engineering Team</strong> ‚Äì Building scalable front‚Äëend and back‚Äëend</li>
                    <li><strong>Community & Marketing</strong> ‚Äì Growing our global user base</li>
                </ul>
                <h2 class="text-2xl font-bold mb-3 mt-6">Investors & Partners</h2>
                <p class="text-gray-400 leading-relaxed mb-4">
                    Interested in supporting PASESO or partnering with us? We‚Äôre looking for investors who share our vision of a creator‚Äëfirst social universe. Get in touch at <a href="mailto:invest@paseso.com" class="text-purple-400">invest@paseso.com</a> to start the conversation.
                </p>
                <h2 class="text-2xl font-bold mb-3 mt-6">Roadmap & Vision</h2>
                <p class="text-gray-400 leading-relaxed mb-4">
                    Our roadmap includes launching a live streaming ecosystem with gifts, a thriving marketplace, advanced gamification, and deep integration with Web3. We aim to become the go‚Äëto platform for creators and communities worldwide.
                </p>
            </div>
        `;
    }

    // ==================== INVESTORS PAGE ====================
    /**
     * Render the Investors page. This section is dedicated to potential
     * investors and partners, outlining the platform‚Äôs vision, market
     * opportunity and benefits of investing in PASESO. Feel free to
     * customize the text and structure to reflect your actual pitch.
     *
     * @param {HTMLElement} container The container where the page is rendered
     */
    function renderInvestorsPage(container) {
        container.innerHTML = `
            <div class="mb-8">
                <h1 class="text-3xl font-bold mb-4 flex items-center gap-3">
                    <i class="fas fa-handshake gradient-text"></i>
                    Invest in PASESO
                </h1>
                <p class="text-gray-400 leading-relaxed mb-4">
                    We are on a mission to build the world‚Äôs most comprehensive social ecosystem ‚Äî a creator‚Äëfirst
                    platform that combines stories, reels, live streaming, communities and commerce in one unified
                    experience. Powered from Romania and built for a global audience, PASESO is positioned at the
                    crossroads of entertainment, technology and culture.
                </p>
                <h2 class="text-2xl font-bold mb-3 mt-6">Why Invest?</h2>
                <ul class="list-disc list-inside space-y-2 text-gray-400">
                    <li>üöÄ <strong>Rapid user growth:</strong> Early traction among creators and communities with
                        gamification and marketplace driving engagement.</li>
                    <li>üìà <strong>Massive market opportunity:</strong> Social media advertising and digital goods
                        markets exceed hundreds of billions of dollars annually.</li>
                    <li>üéÅ <strong>Diversified revenue streams:</strong> Premium memberships, marketplace fees,
                        live streaming gifts, brand partnerships and advertising.</li>
                    <li>ü§ù <strong>Transparent and community driven:</strong> We prioritise users and creators,
                        building long‚Äëterm loyalty through ethical monetisation and inclusive policies.</li>
                </ul>
                <h2 class="text-2xl font-bold mb-3 mt-6">Investment Highlights</h2>
                <p class="text-gray-400 leading-relaxed mb-4">
                    Early investors will benefit from favourable terms, including equity in the company,
                    access to a dedicated investor portal, quarterly update calls with the leadership team,
                    and options to participate in strategic decision‚Äëmaking. We aim to foster partnerships
                    that go beyond capital ‚Äî we welcome advisors and partners who share our vision.
                </p>
                <h2 class="text-2xl font-bold mb-3 mt-6">Next Steps</h2>
                <p class="text-gray-400 leading-relaxed mb-4">
                    If you‚Äôre interested in joining us on this journey, please email us at
                    <a href="mailto:invest@paseso.com" class="text-purple-400">invest@paseso.com</a>.
                    We will provide a detailed pitch deck, financial projections and arrange a call with
                    our founder and core team. Together we can build the next generation of social media.
                </p>
            </div>
        `;
    }

    // ==================== PROFILE PAGE ====================
    let profileTab = 'posts';

    function renderProfilePage(container) {
        const userPosts = posts.filter(p => p.userId === currentUser?.id);
        const likedPosts = posts.filter(p => p.likedBy?.includes(currentUser?.id));
        const savedPostsCount = posts.filter(p => p.saved).length;
        
        container.innerHTML = `
            <!-- Cover Photo -->
            <div class="relative h-48 md:h-64 rounded-2xl overflow-hidden mb-16 group">
                <img id="cover-photo" src="${currentUser?.coverPhoto || 'https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=1200'}" class="w-full h-full object-cover">
                <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent"></div>
                <button onclick="changeCoverPhoto()" class="absolute top-4 right-4 px-4 py-2 rounded-xl bg-black/50 backdrop-blur-sm opacity-0 group-hover:opacity-100 transition-all hover:bg-black/70">
                    <i class="fas fa-camera mr-2"></i>Change Cover
                </button>
            </div>
            
            <div class="relative -mt-24 px-4">
                <!-- Profile Header -->
                <div class="flex flex-col md:flex-row items-start md:items-end gap-4 mb-6">
                    <div class="relative group">
                        <img src="${currentUser?.avatar || DEFAULT_AVATAR}" class="w-32 h-32 rounded-full object-cover border-4 border-dark-1">
                        <button onclick="openEditProfileModal()" class="absolute inset-0 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center">
                            <i class="fas fa-camera text-2xl"></i>
                        </button>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-1 flex-wrap">
                            <h1 class="text-2xl font-bold">${currentUser?.name || 'User'}</h1>
                            ${currentUser?.verified ? '<span class="verified w-6 h-6 rounded-full flex items-center justify-center"><i class="fas fa-check"></i></span>' : ''}
                            ${currentUser?.premium ? '<span class="premium-badge px-2 py-1 text-xs rounded-full font-semibold"><i class="fas fa-crown mr-1"></i>Premium</span>' : ''}
                            ${currentUser?.isCreator ? '<span class="px-2 py-1 text-xs rounded-full bg-gradient-to-r from-purple-500 to-pink-500 font-semibold">Creator</span>' : ''}
                        </div>
                        <p class="text-gray-400">@${currentUser?.username || 'user'}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="shareProfile()" class="px-4 py-3 rounded-xl bg-white/5 hover:bg-white/10 transition-all">
                            <i class="fas fa-share-alt"></i>
                        </button>
                        <button onclick="openEditProfileModal()" class="px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-semibold hover:opacity-90 transition-all">
                            <i class="fas fa-pen mr-2"></i>Edit Profile
                        </button>
                    </div>
                </div>
                
                <!-- Bio -->
                <p class="mb-4 max-w-2xl whitespace-pre-wrap">${currentUser?.bio || 'No bio yet. Click Edit Profile to add one!'}</p>
                
                <!-- Info -->
                <div class="flex items-center gap-4 mb-6 text-sm flex-wrap">
                    ${currentUser?.location ? `<span class="text-gray-400 flex items-center gap-1"><i class="fas fa-map-marker-alt text-red-400"></i>${currentUser.location}</span>` : ''}
                    ${currentUser?.website ? `<a href="${currentUser.website.startsWith('http') ? currentUser.website : 'https://' + currentUser.website}" target="_blank" class="text-purple-400 hover:text-purple-300 flex items-center gap-1"><i class="fas fa-link"></i>${currentUser.website.replace(/^https?:\/\//, '')}</a>` : ''}
                    <span class="text-gray-400 flex items-center gap-1"><i class="fas fa-calendar text-blue-400"></i>Joined ${new Date(currentUser?.createdAt || Date.now()).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>
                </div>
                
                <!-- Stats -->
                <div class="flex gap-6 mb-6">
                    <div class="text-center cursor-pointer hover:bg-white/5 px-4 py-2 rounded-xl transition-all">
                        <p class="text-2xl font-bold gradient-text">${userPosts.length}</p>
                        <p class="text-sm text-gray-400">Posts</p>
                    </div>
                    <div class="text-center cursor-pointer hover:bg-white/5 px-4 py-2 rounded-xl transition-all" onclick="showFollowersModal()">
                        <p class="text-2xl font-bold gradient-text">${formatNumber(currentUser?.followers || 0)}</p>
                        <p class="text-sm text-gray-400">Followers</p>
                    </div>
                    <div class="text-center cursor-pointer hover:bg-white/5 px-4 py-2 rounded-xl transition-all" onclick="showFollowingModal()">
                        <p class="text-2xl font-bold gradient-text">${formatNumber(currentUser?.following || 0)}</p>
                        <p class="text-sm text-gray-400">Following</p>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="flex gap-2 mb-6 border-b border-white/10 pb-4">
                    <button onclick="switchProfileTab('posts')" class="profile-tab px-6 py-2 rounded-xl ${profileTab === 'posts' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium">
                        <i class="fas fa-grid mr-2"></i>Posts
                    </button>
                    <button onclick="switchProfileTab('liked')" class="profile-tab px-6 py-2 rounded-xl ${profileTab === 'liked' ? 'bg-gradient-to-r from-indigo-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium">
                        <i class="fas fa-heart mr-2"></i>Liked
                    </button>
                    <button onclick="showPage('saved')" class="px-6 py-2 rounded-xl bg-white/5 hover:bg-white/10 transition-all font-medium">
                        <i class="fas fa-bookmark mr-2"></i>Saved (${savedPostsCount})
                    </button>
                </div>
                
                <!-- Content Grid -->
                <div id="profile-content" class="grid grid-cols-3 gap-2">
                    ${renderProfileContent(profileTab === 'posts' ? userPosts : likedPosts)}
                </div>
            </div>
        `;
    }

    function renderProfileContent(postsToShow) {
        if (postsToShow.length === 0) {
            return `
                <div class="col-span-3 text-center py-12">
                    <i class="fas fa-camera text-4xl text-gray-600 mb-4"></i>
                    <p class="text-gray-400">${profileTab === 'posts' ? 'No posts yet. Share your first post!' : 'No liked posts yet.'}</p>
                    ${profileTab === 'posts' ? `
                        <button onclick="openCreateModal()" class="mt-4 px-6 py-3 rounded-xl bg-gradient-to-r from-indigo-500 to-pink-500 font-medium">
                            <i class="fas fa-plus mr-2"></i>Create Post
                        </button>
                    ` : ''}
                </div>
            `;
        }

        return postsToShow.map(post => `
            <div class="aspect-square rounded-xl overflow-hidden cursor-pointer hover-lift group relative" onclick="viewPost('${post.id}')">
                ${post.image ? `
                    <img src="${post.image}" class="w-full h-full object-cover">
                ` : `
                    <div class="w-full h-full bg-gradient-to-br from-indigo-500/20 to-pink-500/20 flex items-center justify-center p-3">
                        <p class="text-xs text-center line-clamp-4">${post.content}</p>
                    </div>
                `}
                <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-all flex items-center justify-center gap-4">
                    <span class="flex items-center gap-1 text-sm"><i class="fas fa-heart"></i> ${formatNumber(post.likes)}</span>
                    <span class="flex items-center gap-1 text-sm"><i class="fas fa-comment"></i> ${post.comments.length}</span>
                </div>
            </div>
        `).join('');
    }

    function switchProfileTab(tab) {
        profileTab = tab;
        const userPosts = posts.filter(p => p.userId === currentUser?.id);
        const likedPosts = posts.filter(p => p.likedBy?.includes(currentUser?.id));
        
        document.getElementById('profile-content').innerHTML = renderProfileContent(tab === 'posts' ? userPosts : likedPosts);
        
        document.querySelectorAll('.profile-tab').forEach(btn => {
            btn.classList.remove('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
            btn.classList.add('bg-white/5');
        });
        event.target.classList.remove('bg-white/5');
        event.target.classList.add('bg-gradient-to-r', 'from-indigo-500', 'to-pink-500');
    }

    function changeCoverPhoto() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    currentUser.coverPhoto = ev.target.result;
                    saveData();
                    document.getElementById('cover-photo').src = ev.target.result;
                    showToast('Cover photo updated! üé®', 'success');
                };
                reader.readAsDataURL(file);
            }
        };
        input.click();
    }

    function shareProfile() {
        const url = `${window.location.origin}?user=${currentUser?.username}`;
        if (navigator.share) {
            navigator.share({ title: `${currentUser?.name} on PASESO`, url });
        } else {
            navigator.clipboard.writeText(url);
            showToast('Profile link copied! üìã', 'success');
        }
    }

    function showFollowersModal() {
        showToast('Followers list coming soon!', 'info');
    }

    function showFollowingModal() {
        showToast('Following list coming soon!', 'info');
    }

    // ==================== POST FUNCTIONS ====================
    let lastTap = 0;
    let openCommentsPostId = null;

    function createPost() {
        const content = document.getElementById('post-content').value.trim();
        const visibility = document.getElementById('post-visibility').value;

        if (!content && !pendingImage) {
            showToast('Please add some content', 'error');
            return;
        }

        const newPost = {
            id: 'p' + Date.now(),
            userId: currentUser.id,
            username: currentUser.username,
            userAvatar: currentUser.avatar || DEFAULT_AVATAR,
            userName: currentUser.name,
            verified: currentUser.verified || false,
            content,
            image: pendingImage,
            likes: 0,
            likedBy: [],
            comments: [],
            shares: 0,
            saved: false,
            time: Date.now(),
            visibility
        };

        posts.unshift(newPost);
        // Award points for creating a new post to encourage contribution
        if (currentUser) {
            currentUser.points = (currentUser.points || 0) + 5;
        }
        saveData();
        closeCreateModal();
        showPage('feed');
        showToast('Post created successfully! You earned 5 points! üéâ', 'success');
    }

    function handleDoubleTap(postId, event) {
        const now = Date.now();
        if (now - lastTap < 300) {
            // Double tap detected
            const post = posts.find(p => p.id === postId);
            if (post && !post.likedBy?.includes(currentUser?.id)) {
                toggleLike(postId);
                showHeartAnimation(event);
            }
        }
        lastTap = now;
    }

    function showHeartAnimation(event) {
        const heart = document.createElement('div');
        heart.innerHTML = '<i class="fas fa-heart text-6xl text-pink-500"></i>';
        heart.style.cssText = `
            position: fixed;
            left: ${event.clientX - 30}px;
            top: ${event.clientY - 30}px;
            pointer-events: none;
            z-index: 9999;
            animation: heartPop 0.8s ease-out forwards;
        `;
        document.body.appendChild(heart);
        setTimeout(() => heart.remove(), 800);
    }

    function toggleLike(postId) {
        const post = posts.find(p => p.id === postId);
        if (!post) return;

        const userId = currentUser?.id;
        if (!post.likedBy) post.likedBy = [];

        const likeBtn = document.querySelector(`#post-${postId} .like-btn`);
        const likeIcon = likeBtn?.querySelector('i');
        const likeCount = likeBtn?.querySelector('span');

        if (post.likedBy.includes(userId)) {
            post.likedBy = post.likedBy.filter(id => id !== userId);
            post.likes--;
            if (likeIcon) {
                likeIcon.className = 'far fa-heart text-xl';
                likeBtn.classList.remove('text-pink-500');
                likeBtn.classList.add('text-gray-400');
            }
        } else {
            post.likedBy.push(userId);
            post.likes++;
            if (likeIcon) {
                likeIcon.className = 'fas fa-heart text-xl animate-heart';
                likeBtn.classList.add('text-pink-500');
                likeBtn.classList.remove('text-gray-400');
            }
            
            // Add notification
            if (post.userId !== userId) {
                notifications.unshift({
                    id: 'n' + Date.now(),
                    type: 'like',
                    userId: userId,
                    message: 'liked your post',
                    time: Date.now(),
                    read: false
                });
                updateNotificationBadges();
            }
            // Award a point to the current user for liking a post
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 1;
                showToast('You liked a post! You earned 1 point!', 'success');
            }
        }

        if (likeCount) likeCount.textContent = formatNumber(post.likes);
        saveData();
    }

    function toggleSave(postId) {
        const post = posts.find(p => p.id === postId);
        if (!post) return;

        post.saved = !post.saved;
        
        const saveBtn = document.querySelector(`#post-${postId} .save-btn`);
        const saveIcon = saveBtn?.querySelector('i');
        
        if (saveIcon) {
            saveIcon.className = post.saved ? 'fas fa-bookmark text-xl' : 'far fa-bookmark text-xl';
            saveBtn.classList.toggle('text-yellow-400', post.saved);
        }
        
        saveData();
        showToast(post.saved ? 'Post saved! üîñ' : 'Post unsaved', 'success');
    }

    function toggleComments(postId) {
        const el = document.getElementById('comments-' + postId);
        if (el) {
            const isHidden = el.classList.contains('hidden');
            el.classList.toggle('hidden');
            if (isHidden) {
                openCommentsPostId = postId;
                // Focus on input
                setTimeout(() => {
                    document.getElementById('comment-input-' + postId)?.focus();
                }, 100);
            } else {
                openCommentsPostId = null;
            }
        }
    }

    function addComment(postId) {
        const input = document.getElementById('comment-input-' + postId);
        const content = input?.value.trim();
        
        if (!content) return;

        const post = posts.find(p => p.id === postId);
        if (post) {
            const newComment = {
                id: 'c' + Date.now(),
                userId: currentUser.id,
                username: currentUser.username,
                avatar: currentUser.avatar || DEFAULT_AVATAR,
                content,
                time: 'Just now',
                likes: 0
            };
            
            post.comments.push(newComment);

            // Award points to the commenting user
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 2;
            }
            
            // Add notification
            if (post.userId !== currentUser.id) {
                notifications.unshift({
                    id: 'n' + Date.now(),
                    type: 'comment',
                    userId: currentUser.id,
                    message: `commented: "${content.slice(0, 30)}${content.length > 30 ? '...' : ''}"`,
                    time: Date.now(),
                    read: false
                });
                updateNotificationBadges();
            }
            
            // Update UI without full re-render
            const commentsContainer = document.querySelector(`#comments-${postId} .space-y-3`);
            if (commentsContainer) {
                commentsContainer.innerHTML += `
                    <div class="flex gap-3 animate-slide-in">
                        <img src="${newComment.avatar}" class="w-8 h-8 rounded-full object-cover">
                        <div class="flex-1 bg-white/5 rounded-xl px-4 py-2">
                            <span class="font-medium text-sm">${newComment.username}</span>
                            <p class="text-sm text-gray-300">${newComment.content}</p>
                            <span class="text-xs text-gray-500">${newComment.time}</span>
                        </div>
                    </div>
                `;
                commentsContainer.scrollTop = commentsContainer.scrollHeight;
            }
            
            // Update comment count
            const commentBtn = document.querySelector(`#post-${postId} .comment-btn span`);
            if (commentBtn) commentBtn.textContent = post.comments.length;
            
            input.value = '';
            saveData();
            showToast('Comment added! You earned 2 points! üí¨', 'success');
        }
    }

    function deleteComment(postId, commentId) {
        const post = posts.find(p => p.id === postId);
        if (post) {
            const comment = post.comments.find(c => c.id === commentId);
            if (comment && comment.userId === currentUser.id) {
                post.comments = post.comments.filter(c => c.id !== commentId);
                saveData();
                showPage('feed');
                showToast('Comment deleted', 'info');
            }
        }
    }

    function sharePost(postId) {
        const post = posts.find(p => p.id === postId);
        if (post) {
        post.shares++;

        // Award points to the user who shared. Sharing earns 3 points.
        if (currentUser) {
            currentUser.points = (currentUser.points || 0) + 3;
        }

        // Create a new post representing the share on the sharer's profile. This
        // allows shared content to appear in the sharer's feed and profile. The
        // shared post references the original content and author.
        if (currentUser && post) {
            const originalAuthor = users.find(u => u.id === post.userId) || { username: 'user' };
            const user = currentUser;
            const newPost = {
                id: 'shared-' + Date.now(),
                userId: user.id,
                username: user.username,
                userAvatar: user.avatar,
                userName: user.name || `${user.firstName || ''} ${user.lastName || ''}`.trim(),
                verified: user.verified || false,
                content: `Shared from @${originalAuthor.username}: ${post.content}`,
                image: post.image,
                likes: 0,
                likedBy: [],
                comments: [],
                shares: 0,
                saved: false,
                time: Date.now(),
                visibility: 'public',
                originalPostId: post.id
            };
            posts.unshift(newPost);
        }

        // Send a notification to the original post owner (if not sharing own post)
        if (currentUser && post.userId !== currentUser.id) {
            pushNotification('share', currentUser.id, post.userId, `${currentUser.firstName || currentUser.username} shared your post.`);
        }

        // Update share count in UI
        const shareBtn = document.querySelector(`#post-${postId} .share-btn span`);
        if (shareBtn) shareBtn.textContent = post.shares;

        // Persist updated post and user data
        saveData();
        showToast('Post shared! You earned 3 points! üîÑ', 'success');

        // Note: we do not immediately re-render the feed here to avoid breaking
        // the current page context. The new shared post will appear next
        // time the feed is refreshed.
        }
    }

    function togglePostMenu(postId) {
        const existingMenu = document.getElementById('post-menu-' + postId);
        
        // Close all other menus
        document.querySelectorAll('[id^="post-menu-"]').forEach(m => m.remove());
        
        if (existingMenu) return;
        
        const post = posts.find(p => p.id === postId);
        const isOwner = post?.userId === currentUser?.id;
        
        const menuBtn = document.querySelector(`#post-${postId} [onclick*="togglePostMenu"]`);
        if (!menuBtn) return;
        
        const menu = document.createElement('div');
        menu.id = 'post-menu-' + postId;
        menu.className = 'absolute right-0 top-12 glass-strong rounded-xl py-2 min-w-48 z-50 animate-slide-in';
        menu.innerHTML = `
            ${isOwner ? `
                <button onclick="editPost('${postId}')" class="w-full px-4 py-2 text-left hover:bg-white/5 flex items-center gap-3">
                    <i class="fas fa-edit text-blue-400"></i>
                    Edit Post
                </button>
                <button onclick="deletePost('${postId}')" class="w-full px-4 py-2 text-left hover:bg-white/5 flex items-center gap-3 text-red-400">
                    <i class="fas fa-trash"></i>
                    Delete Post
                </button>
                <div class="border-t border-white/10 my-1"></div>
            ` : ''}
            <button onclick="copyPostLink('${postId}')" class="w-full px-4 py-2 text-left hover:bg-white/5 flex items-center gap-3">
                <i class="fas fa-link text-gray-400"></i>
                Copy Link
            </button>
            ${!isOwner ? `
                <button onclick="reportPost('${postId}')" class="w-full px-4 py-2 text-left hover:bg-white/5 flex items-center gap-3 text-orange-400">
                    <i class="fas fa-flag"></i>
                    Report Post
                </button>
            ` : ''}
        `;
        
        menuBtn.parentElement.style.position = 'relative';
        menuBtn.parentElement.appendChild(menu);
        
        // Close on outside click
        setTimeout(() => {
            document.addEventListener('click', function closeMenu(e) {
                if (!menu.contains(e.target) && e.target !== menuBtn) {
                    menu.remove();
                    document.removeEventListener('click', closeMenu);
                }
            });
        }, 10);
    }

    function deletePost(postId) {
        if (confirm('Are you sure you want to delete this post?')) {
            posts = posts.filter(p => p.id !== postId);
            saveData();
            showPage('feed');
            showToast('Post deleted', 'info');
        }
    }

    function editPost(postId) {
        const post = posts.find(p => p.id === postId);
        if (!post) return;
        
        openCreateModal();
        document.getElementById('post-content').value = post.content;
        document.getElementById('char-count').textContent = post.content.length;
        document.getElementById('post-visibility').value = post.visibility;
        
        if (post.image) {
            pendingImage = post.image;
            document.getElementById('preview-image').src = post.image;
            document.getElementById('image-preview-container').classList.remove('hidden');
        }
        
        // Change create to update
        const postBtn = document.querySelector('#create-modal button[onclick="createPost()"]');
        if (postBtn) {
            postBtn.textContent = 'Update';
            postBtn.onclick = () => updatePost(postId);
        }
    }

    function updatePost(postId) {
        const post = posts.find(p => p.id === postId);
        if (!post) return;
        
        post.content = document.getElementById('post-content').value.trim();
        post.visibility = document.getElementById('post-visibility').value;
        post.image = pendingImage || post.image;
        post.editedAt = Date.now();
        
        saveData();
        closeCreateModal();
        showPage('feed');
        showToast('Post updated! ‚ú®', 'success');
    }

    function copyPostLink(postId) {
        const url = `${window.location.origin}?post=${postId}`;
        navigator.clipboard.writeText(url);
        showToast('Link copied! üìã', 'success');
        document.getElementById('post-menu-' + postId)?.remove();
    }

    function reportPost(postId) {
        showToast('Post reported. We\'ll review it shortly.', 'info');
        document.getElementById('post-menu-' + postId)?.remove();
    }

    // ==================== STORY FUNCTIONS ====================
    function openStoryViewer(index) {
        currentStoryIndex = index;
        updateStoryViewer();
        document.getElementById('story-modal').classList.add('active');
        document.body.style.overflow = 'hidden';
        startStoryTimer();
    }

    function closeStoryViewer() {
        document.getElementById('story-modal').classList.remove('active');
        document.body.style.overflow = '';
        stopStoryTimer();
    }

    function updateStoryViewer() {
        const story = stories[currentStoryIndex];
        if (!story) return;

        const storyImage = document.getElementById('story-image');
        storyImage.style.opacity = '0.5';
        storyImage.src = story.image;
        storyImage.onload = () => {
            storyImage.style.opacity = '1';
            storyImage.style.transition = 'opacity 0.3s';
        };

        document.getElementById('story-user-img').src = story.avatar;
        document.getElementById('story-username').textContent = story.username;
        document.getElementById('story-time').textContent = formatTime(story.time);

        // Update progress bars - only show for current user's stories group
        const progressContainer = document.getElementById('story-progress');
        progressContainer.innerHTML = stories.map((s, i) => `
            <div class="flex-1 h-1 bg-white/30 rounded-full overflow-hidden">
                <div class="h-full bg-white rounded-full transition-all" 
                    style="width: ${i < currentStoryIndex ? '100%' : i === currentStoryIndex ? '0%' : '0%'}; 
                    ${i === currentStoryIndex ? 'animation: storyProgress 5s linear forwards;' : ''}"></div>
            </div>
        `).join('');

        // Mark as seen
        story.seen = true;
        saveData();
    }

    function nextStory() {
        stopStoryTimer();
        if (currentStoryIndex < stories.length - 1) {
            currentStoryIndex++;
            updateStoryViewer();
            startStoryTimer();
        } else {
            closeStoryViewer();
        }
    }

    function prevStory() {
        stopStoryTimer();
        if (currentStoryIndex > 0) {
            currentStoryIndex--;
            updateStoryViewer();
            startStoryTimer();
        }
    }

    function startStoryTimer() {
        stopStoryTimer();
        storyTimer = setTimeout(nextStory, 5000);
    }

    function stopStoryTimer() {
        if (storyTimer) {
            clearTimeout(storyTimer);
            storyTimer = null;
        }
    }

    function restartStoryTimer() {
        stopStoryTimer();
        startStoryTimer();
    }

    function pauseStory() {
        stopStoryTimer();
    }

    function resumeStory() {
        startStoryTimer();
    }

    function sendStoryReply() {
        const input = document.getElementById('story-reply');
        const message = input?.value.trim();
        
        if (!message) return;
        
        const story = stories[currentStoryIndex];
        if (!story) return;
        
        // Add to messages
        messages.push({
            id: 'm' + Date.now(),
            fromId: currentUser.id,
            toId: story.userId,
            content: `Replied to your story: "${message}"`,
            time: Date.now(),
            read: false,
            storyReply: true,
            storyImage: story.image
        });
        
        saveData();
        input.value = '';
        showToast('Reply sent! üí¨', 'success');
    }

    function deleteStory(storyId) {
        if (confirm('Delete this story?')) {
            stories = stories.filter(s => s.id !== storyId);
            saveData();
            closeStoryViewer();
            showPage('feed');
            showToast('Story deleted', 'info');
        }
    }

    function openCreateStoryModal() {
        document.getElementById('create-story-modal').classList.add('active');
    }

    function closeCreateStoryModal() {
        document.getElementById('create-story-modal').classList.remove('active');
        document.getElementById('story-preview-image').classList.add('hidden');
        document.getElementById('story-upload-placeholder').classList.remove('hidden');
        pendingStoryImage = null;
    }

    function handleStoryImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                pendingStoryImage = e.target.result;
                document.getElementById('story-preview-image').src = pendingStoryImage;
                document.getElementById('story-preview-image').classList.remove('hidden');
                document.getElementById('story-upload-placeholder').classList.add('hidden');
            };
            reader.readAsDataURL(file);
        }
    }

    function publishStory() {
        if (!pendingStoryImage) {
            showToast('Please add a photo', 'error');
            return;
        }

        const caption = document.getElementById('story-caption').value;

        stories.unshift({
            id: 's' + Date.now(),
            userId: currentUser.id,
            username: currentUser.username,
            avatar: currentUser.avatar || DEFAULT_AVATAR,
            image: pendingStoryImage,
            time: Date.now(),
            seen: false,
            caption
        });

        saveData();
        closeCreateStoryModal();
        showPage('feed');
        showToast('Story published! üì∏', 'success');
    }

    // ==================== MODAL FUNCTIONS ====================
    function openCreateModal() {
        document.getElementById('create-modal').classList.add('active');
        document.getElementById('post-content').value = '';
        document.getElementById('char-count').textContent = '0';
        removeImage();
    }

    function closeCreateModal() {
        document.getElementById('create-modal').classList.remove('active');
        document.getElementById('emoji-picker').classList.add('hidden');
    }

    function openEditProfileModal() {
        document.getElementById('edit-profile-modal').classList.add('active');
        document.getElementById('edit-avatar-preview').src = currentUser?.avatar || DEFAULT_AVATAR;
        document.getElementById('edit-firstname').value = currentUser?.firstName || '';
        document.getElementById('edit-lastname').value = currentUser?.lastName || '';
        document.getElementById('edit-bio').value = currentUser?.bio || '';
        document.getElementById('edit-location').value = currentUser?.location || '';
        document.getElementById('edit-website').value = currentUser?.website || '';
    }

    function closeEditProfileModal() {
        document.getElementById('edit-profile-modal').classList.remove('active');
    }

    function saveProfile() {
        currentUser.firstName = document.getElementById('edit-firstname').value;
        currentUser.lastName = document.getElementById('edit-lastname').value;
        currentUser.name = `${currentUser.firstName} ${currentUser.lastName}`;
        currentUser.bio = document.getElementById('edit-bio').value;
        currentUser.location = document.getElementById('edit-location').value;
        currentUser.website = document.getElementById('edit-website').value;

        saveData();
        updateUserUI();
        closeEditProfileModal();
        showPage('profile');
        showToast('Profile updated! ‚ú®', 'success');
    }

    function closeUserProfileModal() {
        document.getElementById('user-profile-modal').classList.remove('active');
    }

    function viewUserProfile(userId) {
        const user = users.find(u => u.id === userId);
        if (!user) return;

        const userPosts = posts.filter(p => p.userId === userId);
        const content = document.getElementById('user-profile-content');
        
        content.innerHTML = `
            <div class="relative h-32 rounded-t-3xl overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-indigo-500 via-purple-500 to-pink-500"></div>
            </div>
            <div class="px-6 pb-6 -mt-12">
                <div class="flex items-end gap-4 mb-4">
                    <img src="${user.avatar}" class="w-24 h-24 rounded-full object-cover border-4 border-dark-2">
                    <div class="flex-1">
                        <div class="flex items-center gap-2">
                            <h2 class="text-xl font-bold">${user.name}</h2>
                            ${user.verified ? '<span class="verified w-5 h-5 rounded-full flex items-center justify-center"><i class="fas fa-check text-xs"></i></span>' : ''}
                        </div>
                        <p class="text-gray-400">@${user.username}</p>
                    </div>
                    <button onclick="followUser('${user.id}')" class="px-6 py-2 rounded-full bg-gradient-to-r from-indigo-500 to-pink-500 font-medium">
                        Follow
                    </button>
                </div>
                <p class="mb-4">${user.bio}</p>
                <div class="flex gap-6 mb-4">
                    <span><strong>${formatNumber(user.followers)}</strong> <span class="text-gray-400">followers</span></span>
                    <span><strong>${formatNumber(user.following)}</strong> <span class="text-gray-400">following</span></span>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    ${userPosts.slice(0, 6).map(post => `
                        <div class="aspect-square rounded-lg overflow-hidden">
                            <img src="${post.image || 'https://via.placeholder.com/200'}" class="w-full h-full object-cover">
                        </div>
                    `).join('')}
                </div>
            </div>
        `;

        document.getElementById('user-profile-modal').classList.add('active');
    }

    // ==================== IMAGE HANDLING ====================
    function handleImageUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                pendingImage = e.target.result;
                document.getElementById('preview-image').src = pendingImage;
                document.getElementById('image-preview-container').classList.remove('hidden');
            };
            reader.readAsDataURL(file);
        }
    }

    function removeImage() {
        pendingImage = null;
        document.getElementById('image-preview-container').classList.add('hidden');
        document.getElementById('image-upload').value = '';
    }

    function handleAvatarUpload(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                currentUser.avatar = e.target.result;
                document.getElementById('edit-avatar-preview').src = e.target.result;
            };
            reader.readAsDataURL(file);
        }
    }

    // ==================== EMOJI PICKER ====================
    function initEmojiPicker() {
        const picker = document.getElementById('emoji-picker');
        if (picker) {
            picker.innerHTML = EMOJIS.map(e => `<span onclick="insertEmoji('${e}')">${e}</span>`).join('');
        }
    }

    function toggleEmojiPicker() {
        document.getElementById('emoji-picker').classList.toggle('hidden');
    }

    function insertEmoji(emoji) {
        const textarea = document.getElementById('post-content');
        textarea.value += emoji;
        textarea.focus();
        document.getElementById('char-count').textContent = textarea.value.length;
    }

    // ==================== MESSAGE FUNCTIONS ====================
    let currentChatUserId = null;
    let typingTimeout = null;

    function selectConversation(userId) {
        currentChatUserId = userId;
        const user = users.find(u => u.id === userId);
        if (!user) return;

        // Mark messages as read
        messages.forEach(m => {
            if (m.fromId === userId && m.toId === currentUser?.id) {
                m.read = true;
            }
        });
        saveData();
        updateNotificationBadges();

        // Update chat header
        const chatHeader = document.querySelector('.lg\\:col-span-2 .border-b');
        if (chatHeader) {
            chatHeader.innerHTML = `
                <div class="flex items-center gap-3">
                    <img src="${user.avatar}" class="w-10 h-10 rounded-full object-cover">
                    <div>
                        <p class="font-semibold">${user.name}</p>
                        <p class="text-xs ${user.online ? 'text-green-400' : 'text-gray-400'}">${user.online ? 'Online' : 'Offline'}</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="startVideoCall('${userId}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                        <i class="fas fa-video text-gray-400"></i>
                    </button>
                    <button onclick="startVoiceCall('${userId}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                        <i class="fas fa-phone text-gray-400"></i>
                    </button>
                    <button onclick="openChatSettings('${userId}')" class="w-10 h-10 rounded-full hover:bg-white/5 flex items-center justify-center">
                        <i class="fas fa-ellipsis-v text-gray-400"></i>
                    </button>
                </div>
            `;
        }

        // Update active conversation in list
        document.querySelectorAll('.glass.rounded-2xl .p-4.hover\\:bg-white\\/5').forEach(el => {
            el.classList.remove('border-l-4', 'border-purple-500', 'bg-white/5');
        });
        event?.target?.closest('.p-4')?.classList.add('border-l-4', 'border-purple-500', 'bg-white/5');

        // Load messages
        loadChatMessages(userId);
    }

    function loadChatMessages(userId) {
        const chatContainer = document.getElementById('chat-messages');
        if (!chatContainer) return;

        const userMessages = messages.filter(m => 
            (m.fromId === currentUser?.id && m.toId === userId) ||
            (m.fromId === userId && m.toId === currentUser?.id)
        ).sort((a, b) => a.time - b.time);

        if (userMessages.length === 0) {
            chatContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center h-full text-center">
                    <div class="w-16 h-16 rounded-full bg-gradient-to-br from-indigo-500 to-pink-500 flex items-center justify-center mb-4">
                        <i class="fas fa-comments text-2xl"></i>
                    </div>
                    <p class="text-gray-400">No messages yet</p>
                    <p class="text-sm text-gray-500">Say hello! üëã</p>
                </div>
            `;
            return;
        }

        chatContainer.innerHTML = userMessages.map(m => {
            const isSent = m.fromId === currentUser?.id;
            const time = new Date(m.time).toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            
            return `
                <div class="flex ${isSent ? 'justify-end' : 'justify-start'}">
                    <div class="${isSent ? 'msg-sent' : 'msg-received'} max-w-xs lg:max-w-md px-4 py-3">
                        ${m.storyReply ? `<div class="text-xs text-white/50 mb-1">Replied to story</div>` : ''}
                        ${m.image ? `<img src="${m.image}" class="rounded-lg mb-2 max-h-40 object-cover">` : ''}
                        <p>${m.content}</p>
                        <div class="flex items-center gap-1 mt-1">
                            <span class="text-xs ${isSent ? 'text-white/70' : 'text-gray-400'}">${time}</span>
                            ${isSent ? `<i class="fas fa-check-double text-xs ${m.read ? 'text-blue-400' : 'text-white/50'}"></i>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }).join('');

        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function sendMessage() {
        const input = document.getElementById('message-input');
        const content = input?.value.trim();
        
        if (!content || !currentChatUserId) return;

        const newMessage = {
            id: 'm' + Date.now(),
            fromId: currentUser.id,
            toId: currentChatUserId,
            content,
            time: Date.now(),
            read: false
        };

        messages.push(newMessage);
        saveData();

        // Add to UI
        const chatContainer = document.getElementById('chat-messages');
        const time = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

        // Clear empty state if exists
        if (chatContainer.querySelector('.flex-col.items-center')) {
            chatContainer.innerHTML = '';
        }

        chatContainer.innerHTML += `
            <div class="flex justify-end animate-slide-in">
                <div class="msg-sent max-w-xs lg:max-w-md px-4 py-3">
                    <p>${content}</p>
                    <div class="flex items-center gap-1 mt-1">
                        <span class="text-xs text-white/70">${time}</span>
                        <i class="fas fa-check text-xs text-white/50"></i>
                    </div>
                </div>
            </div>
        `;

        input.value = '';
        chatContainer.scrollTop = chatContainer.scrollHeight;

        // Show typing indicator
        showTypingIndicator();

        // Simulate reply from bot/other user
        setTimeout(() => {
            hideTypingIndicator();
            
            const replies = [
                'That sounds great! üòä',
                'I totally agree with you!',
                'Awesome! Tell me more üéâ',
                'Haha, you\'re so funny! üòÇ',
                'I\'ll check that out, thanks!',
                'Can\'t wait to see you! ‚ù§Ô∏è',
                'Perfect! Let\'s do it üöÄ'
            ];
            
            const replyMessage = {
                id: 'm' + Date.now(),
                fromId: currentChatUserId,
                toId: currentUser.id,
                content: replies[Math.floor(Math.random() * replies.length)],
                time: Date.now(),
                read: true
            };

            messages.push(replyMessage);
            saveData();

            const replyTime = new Date().toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });
            chatContainer.innerHTML += `
                <div class="flex justify-start animate-slide-in">
                    <div class="msg-received max-w-xs lg:max-w-md px-4 py-3">
                        <p>${replyMessage.content}</p>
                        <span class="text-xs text-gray-400 mt-1 block">${replyTime}</span>
                    </div>
                </div>
            `;
            chatContainer.scrollTop = chatContainer.scrollHeight;

            // Play notification sound (if available)
            playNotificationSound();
        }, 1500 + Math.random() * 1000);
    }

    function showTypingIndicator() {
        const chatContainer = document.getElementById('chat-messages');
        if (!chatContainer || document.getElementById('typing-indicator')) return;

        const indicator = document.createElement('div');
        indicator.id = 'typing-indicator';
        indicator.className = 'flex justify-start animate-slide-in';
        indicator.innerHTML = `
            <div class="msg-received px-4 py-3">
                <div class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
            </div>
        `;
        chatContainer.appendChild(indicator);
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function hideTypingIndicator() {
        document.getElementById('typing-indicator')?.remove();
    }

    function startVideoCall(userId) {
        const user = users.find(u => u.id === userId);
        showToast(`Starting video call with ${user?.name || 'user'}... üìπ`, 'info');
    }

    function startVoiceCall(userId) {
        const user = users.find(u => u.id === userId);
        showToast(`Calling ${user?.name || 'user'}... üìû`, 'info');
    }

    function openChatSettings(userId) {
        showToast('Chat settings coming soon!', 'info');
    }

    function playNotificationSound() {
        // Create a simple beep sound
        try {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            gainNode.gain.value = 0.1;
            
            oscillator.start();
            oscillator.stop(audioContext.currentTime + 0.1);
        } catch (e) {
            // Audio not supported
        }
    }

    // ==================== UTILITY FUNCTIONS ====================
    function formatTime(timestamp) {
        const diff = Date.now() - timestamp;
        const minutes = Math.floor(diff / 60000);
        const hours = Math.floor(diff / 3600000);
        const days = Math.floor(diff / 86400000);

        if (minutes < 1) return 'Just now';
        if (minutes < 60) return `${minutes}m ago`;
        if (hours < 24) return `${hours}h ago`;
        return `${days}d ago`;
    }

    function formatNumber(num) {
        if (num >= 1000000) return (num / 1000000).toFixed(1) + 'M';
        if (num >= 1000) return (num / 1000).toFixed(1) + 'k';
        return num?.toString() || '0';
    }

    function formatContent(content) {
        return content
            .replace(/#(\w+)/g, '<span class="text-purple-400 cursor-pointer hover:underline" onclick="searchHashtag(\'#$1\')">#$1</span>')
            .replace(/@(\w+)/g, '<span class="text-blue-400 cursor-pointer hover:underline" onclick="searchUser(\'$1\')">@$1</span>');
    }

    function showToast(message, type = 'info') {
        const container = document.getElementById('toast-container');
        const toast = document.createElement('div');
        const colors = {
            success: 'from-green-500 to-emerald-500',
            error: 'from-red-500 to-pink-500',
            info: 'from-blue-500 to-cyan-500'
        };
        const icons = {
            success: 'fa-check-circle',
            error: 'fa-exclamation-circle',
            info: 'fa-info-circle'
        };

        toast.className = `toast glass-strong rounded-xl px-4 py-3 flex items-center gap-3 min-w-64`;
        toast.innerHTML = `
            <div class="w-8 h-8 rounded-full bg-gradient-to-r ${colors[type]} flex items-center justify-center">
                <i class="fas ${icons[type]}"></i>
            </div>
            <p class="flex-1">${message}</p>
        `;

        container.appendChild(toast);

        setTimeout(() => {
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100px)';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    function handleSearch(event) {
        if (event.key === 'Enter') {
            const query = event.target.value.trim();
            if (query) {
                showToast(`Searching for "${query}"...`, 'info');
            }
        }
    }

    function handleExploreSearch(event) {
        handleSearch(event);
    }

    function searchHashtag(tag) {
        // Navigate to the Explore page and perform a search for the given hashtag.
        // This will populate the search results with posts containing the tag.
        showPage('explore');
        const searchInput = document.getElementById('explore-search');
        if (searchInput) {
            searchInput.value = tag;
        }
        // Trigger search. Passing the full tag (e.g. "#art") allows the search
        // function to match posts containing that hashtag in their content.
        performSearch(tag);
        showToast(`Viewing posts with ${tag}`, 'info');
    }

    function searchUser(username) {
        const user = users.find(u => u.username === username);
        if (user) viewUserProfile(user.id);
    }

    function followUser(userId) {
        const user = users.find(u => u.id === userId);
        if (user) {
            user.followers++;
            currentUser.following++;

            // Award a point to the current user for following someone
            if (currentUser) {
                currentUser.points = (currentUser.points || 0) + 1;
            }

            // Add follow notification for the user being followed
            if (user.id !== currentUser.id) {
                notifications.unshift({
                    id: 'n' + Date.now(),
                    type: 'follow',
                    userId: currentUser.id,
                    message: 'started following you',
                    time: Date.now(),
                    read: false
                });
                updateNotificationBadges();
            }

            saveData();
            showToast(`You're now following ${user.name}! You earned 1 point! üéâ`, 'success');
        }
    }

    function viewPost(postId) {
        showPage('feed');
        setTimeout(() => {
            const postEl = document.getElementById('post-' + postId);
            if (postEl) {
                postEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
                postEl.classList.add('ring-2', 'ring-purple-500');
                setTimeout(() => postEl.classList.remove('ring-2', 'ring-purple-500'), 2000);
            }
        }, 100);
    }

    function viewImage(url) {
        window.open(url, '_blank');
    }

    function shareExternal(postId) {
        if (navigator.share) {
            navigator.share({
                title: 'Check out this post on PASESO',
                url: window.location.href
            });
        } else {
            navigator.clipboard.writeText(window.location.href);
            showToast('Link copied to clipboard! üìã', 'success');
        }
    }

    // ==================== BECOME CREATOR PAGE ====================
    function renderBecomeCreatorPage(container) {
        container.innerHTML = `
            <div class="max-w-2xl mx-auto">
                <div class="text-center mb-8">
                    <div class="w-20 h-20 mx-auto mb-4 rounded-full bg-gradient-to-br from-amber-400 via-orange-500 to-red-500 flex items-center justify-center animate-float">
                        <i class="fas fa-crown text-3xl text-white"></i>
                    </div>
                    <h1 class="text-3xl font-bold gradient-text mb-2">Become a Creator</h1>
                    <p class="text-gray-400">Join our creator program and start earning from your content</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="glass rounded-2xl p-4 text-center">
                        <div class="text-3xl font-bold gradient-text">85%</div>
                        <p class="text-sm text-gray-400">Revenue Share</p>
                    </div>
                    <div class="glass rounded-2xl p-4 text-center">
                        <div class="text-3xl font-bold gradient-text">$0</div>
                        <p class="text-sm text-gray-400">Platform Fee</p>
                    </div>
                    <div class="glass rounded-2xl p-4 text-center">
                        <div class="text-3xl font-bold gradient-text">24h</div>
                        <p class="text-sm text-gray-400">Fast Payouts</p>
                    </div>
                </div>

                <div class="glass rounded-2xl p-6 mb-6">
                    <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-gift text-purple-400"></i>
                        Creator Benefits
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        ${[
                            { icon: 'fa-dollar-sign', title: 'Subscriptions', desc: 'Monthly recurring income from fans' },
                            { icon: 'fa-lock', title: 'Exclusive Content', desc: 'Paywall your premium content' },
                            { icon: 'fa-heart', title: 'Tips & Donations', desc: 'Receive tips from supporters' },
                            { icon: 'fa-video', title: 'PPV Messages', desc: 'Sell exclusive video messages' },
                            { icon: 'fa-chart-line', title: 'Analytics', desc: 'Detailed insights & metrics' },
                            { icon: 'fa-headset', title: 'Priority Support', desc: '24/7 creator assistance' }
                        ].map(b => `
                            <div class="flex items-start gap-3 p-3 rounded-xl bg-white/5">
                                <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-purple-500 to-pink-500 flex items-center justify-center flex-shrink-0">
                                    <i class="fas ${b.icon}"></i>
                                </div>
                                <div>
                                    <h3 class="font-semibold">${b.title}</h3>
                                    <p class="text-sm text-gray-400">${b.desc}</p>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <form id="creator-application-form" class="glass rounded-2xl p-6" onsubmit="submitCreatorApplication(event)">
                    <h2 class="text-xl font-bold mb-6 flex items-center gap-2">
                        <i class="fas fa-file-alt text-blue-400"></i>
                        Application Form
                    </h2>

                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Full Legal Name *</label>
                            <input type="text" id="creator-legal-name" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none" placeholder="Your full legal name">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Date of Birth *</label>
                                <input type="date" id="creator-dob" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                            </div>
                            <div>
                                <label class="block text-sm text-gray-400 mb-2">Country *</label>
                                <select id="creator-country" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                                    <option value="">Select country</option>
                                    <option value="RO">Romania</option>
                                    <option value="US">United States</option>
                                    <option value="UK">United Kingdom</option>
                                    <option value="DE">Germany</option>
                                    <option value="FR">France</option>
                                    <option value="ES">Spain</option>
                                    <option value="IT">Italy</option>
                                    <option value="OTHER">Other</option>
                                </select>
                            </div>
                        </div>

                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Content Category *</label>
                            <select id="creator-category" required class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                                <option value="">Select category</option>
                                <option value="art">Art & Design</option>
                                <option value="music">Music & Audio</option>
                                <option value="photography">Photography</option>
                                <option value="fitness">Fitness & Health</option>
                                <option value="education">Education & Tutorials</option>
                                <option value="gaming">Gaming</option>
                                <option value="lifestyle">Lifestyle</option>
                                <option value="tech">Technology</option>
                                <option value="fashion">Fashion & Beauty</option>
                                <option value="other">Other</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Tell us about your content *</label>
                            <textarea id="creator-about" required rows="4" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none resize-none" placeholder="Describe the type of content you plan to create..."></textarea>
                        </div>

                        <div>
                            <label class="block text-sm text-gray-400 mb-2">Social Media Links (optional)</label>
                            <input type="text" id="creator-socials" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none" placeholder="Instagram, TikTok, YouTube links...">
                        </div>

                        <div class="flex items-start gap-3 p-4 rounded-xl bg-amber-500/10 border border-amber-500/30">
                            <input type="checkbox" id="creator-age-confirm" required class="w-5 h-5 mt-0.5 rounded bg-white/5 border-white/10">
                            <label for="creator-age-confirm" class="text-sm">
                                I confirm I am at least <strong>18 years old</strong> and agree to the <a href="#" onclick="showPage('terms'); return false;" class="text-purple-400 hover:underline">Terms of Service</a> and <a href="#" onclick="showPage('privacy'); return false;" class="text-purple-400 hover:underline">Creator Agreement</a>.
                            </label>
                        </div>

                        <div class="flex items-start gap-3">
                            <input type="checkbox" id="creator-guidelines" required class="w-5 h-5 mt-0.5 rounded bg-white/5 border-white/10">
                            <label for="creator-guidelines" class="text-sm text-gray-400">
                                I have read and will follow the <strong class="text-white">Community Guidelines</strong> and understand that violations may result in account termination.
                            </label>
                        </div>

                        <button type="submit" class="w-full py-4 rounded-xl bg-gradient-to-r from-amber-400 via-orange-500 to-red-500 font-bold text-lg hover:opacity-90 transition-all flex items-center justify-center gap-2">
                            <i class="fas fa-paper-plane"></i>
                            Submit Application
                        </button>
                    </div>
                </form>
            </div>
        `;
    }

    function submitCreatorApplication(event) {
        event.preventDefault();
        
        const application = {
            id: 'app_' + Date.now(),
            userId: currentUser.id,
            legalName: document.getElementById('creator-legal-name').value,
            dob: document.getElementById('creator-dob').value,
            country: document.getElementById('creator-country').value,
            category: document.getElementById('creator-category').value,
            about: document.getElementById('creator-about').value,
            socials: document.getElementById('creator-socials').value,
            status: 'pending',
            submittedAt: Date.now()
        };

        // Save application
        const applications = JSON.parse(localStorage.getItem('paseso_creator_applications')) || [];
        applications.push(application);
        localStorage.setItem('paseso_creator_applications', JSON.stringify(applications));

        // Update user
        currentUser.creatorApplicationStatus = 'pending';
        saveData();

        showToast('Application submitted! We\'ll review it within 24-48 hours üéâ', 'success');
        showPage('creator');
    }

    // ==================== SETTINGS PAGE ====================
    let settingsData = JSON.parse(localStorage.getItem('paseso_settings')) || {
        privateAccount: false,
        activityStatus: true,
        notifications: {
            likes: true,
            comments: true,
            followers: true,
            messages: true,
            liveStreams: true,
            emailDigest: false
        },
        appearance: 'light',
        language: 'en'
    };

    function renderSettingsPage(container) {
        container.innerHTML = `
            <h1 class="text-2xl font-bold mb-6 flex items-center gap-3">
                <i class="fas fa-cog gradient-text"></i>
                Settings
            </h1>

            <div class="space-y-4 max-w-2xl">
                <!-- Account Settings -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-user text-purple-400"></i>
                        Account
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between py-3 border-b border-white/10">
                            <div>
                                <p class="font-medium">Email</p>
                                <p class="text-sm text-gray-400">${currentUser?.email || 'Not set'}</p>
                            </div>
                            <button onclick="changeEmail()" class="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-all text-sm">Change</button>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b border-white/10">
                            <div>
                                <p class="font-medium">Username</p>
                                <p class="text-sm text-gray-400">@${currentUser?.username || 'user'}</p>
                            </div>
                            <button onclick="changeUsername()" class="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-all text-sm">Change</button>
                        </div>
                        <div class="flex items-center justify-between py-3 border-b border-white/10">
                            <div>
                                <p class="font-medium">Password</p>
                                <p class="text-sm text-gray-400">Last changed: ${currentUser?.passwordChanged ? new Date(currentUser.passwordChanged).toLocaleDateString() : 'Never'}</p>
                            </div>
                            <button onclick="changePassword()" class="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 transition-all text-sm">Change</button>
                        </div>
                        <div class="flex items-center justify-between py-3">
                            <div>
                                <p class="font-medium">Two-Factor Authentication</p>
                                <p class="text-sm text-gray-400">Add extra security to your account</p>
                            </div>
                            <button onclick="toggle2FA()" class="px-4 py-2 rounded-lg ${currentUser?.twoFactorEnabled ? 'bg-green-500/20 text-green-400' : 'bg-gradient-to-r from-green-500 to-emerald-500'} transition-all text-sm font-medium">
                                ${currentUser?.twoFactorEnabled ? 'Enabled ‚úì' : 'Enable'}
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Privacy Settings -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-shield-alt text-blue-400"></i>
                        Privacy
                    </h2>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Private Account</p>
                                <p class="text-sm text-gray-400">Only followers can see your posts</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="private-account" ${settingsData.privateAccount ? 'checked' : ''} onchange="updateSetting('privateAccount', this.checked)">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Show Activity Status</p>
                                <p class="text-sm text-gray-400">Let others see when you're online</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" id="activity-status" ${settingsData.activityStatus ? 'checked' : ''} onchange="updateSetting('activityStatus', this.checked)">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"></div>
                            </label>
                        </div>
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-medium">Read Receipts</p>
                                <p class="text-sm text-gray-400">Show when you've read messages</p>
                            </div>
                            <label class="relative inline-flex items-center cursor-pointer">
                                <input type="checkbox" class="sr-only peer" checked onchange="updateSetting('readReceipts', this.checked)">
                                <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"></div>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Notifications Settings -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-bell text-yellow-400"></i>
                        Notifications
                    </h2>
                    <div class="space-y-4">
                        ${[
                            { key: 'likes', label: 'Likes', icon: 'fa-heart', color: 'text-pink-400' },
                            { key: 'comments', label: 'Comments', icon: 'fa-comment', color: 'text-blue-400' },
                            { key: 'followers', label: 'New Followers', icon: 'fa-user-plus', color: 'text-purple-400' },
                            { key: 'messages', label: 'Messages', icon: 'fa-envelope', color: 'text-green-400' },
                            { key: 'liveStreams', label: 'Live Streams', icon: 'fa-broadcast-tower', color: 'text-red-400' },
                            { key: 'emailDigest', label: 'Email Digest (Weekly)', icon: 'fa-newspaper', color: 'text-gray-400' }
                        ].map(item => `
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i class="fas ${item.icon} ${item.color} w-5"></i>
                                    <p class="font-medium">${item.label}</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" class="sr-only peer" ${settingsData.notifications[item.key] ? 'checked' : ''} onchange="updateNotifSetting('${item.key}', this.checked)">
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-500"></div>
                                </label>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <!-- Appearance -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-palette text-pink-400"></i>
                        Appearance
                    </h2>
                    <div class="space-y-4">
                        <div>
                            <p class="font-medium mb-3">Theme</p>
                            <div class="grid grid-cols-3 gap-3">
                                ${['Dark', 'Light', 'System'].map(theme => `
                                    <button onclick="setTheme('${theme.toLowerCase()}')" class="py-3 rounded-xl ${settingsData.appearance === theme.toLowerCase() ? 'bg-gradient-to-r from-purple-500 to-pink-500' : 'bg-white/5 hover:bg-white/10'} transition-all font-medium text-sm">
                                        <i class="fas ${theme === 'Dark' ? 'fa-moon' : theme === 'Light' ? 'fa-sun' : 'fa-desktop'} mr-2"></i>
                                        ${theme}
                                    </button>
                                `).join('')}
                            </div>
                        </div>
                        <div>
                            <p class="font-medium mb-3">Language</p>
                            <select onchange="setLanguage(this.value)" class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none">
                                <option value="en" ${settingsData.language === 'en' ? 'selected' : ''}>English</option>
                                <option value="ro" ${settingsData.language === 'ro' ? 'selected' : ''}>Rom√¢nƒÉ</option>
                                <option value="es" ${settingsData.language === 'es' ? 'selected' : ''}>Espa√±ol</option>
                                <option value="fr" ${settingsData.language === 'fr' ? 'selected' : ''}>Fran√ßais</option>
                                <option value="de" ${settingsData.language === 'de' ? 'selected' : ''}>Deutsch</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Data & Storage -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-database text-cyan-400"></i>
                        Data & Storage
                    </h2>
                    <div class="space-y-3">
                        <button onclick="downloadData()" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-download text-green-400"></i>
                                <span>Download Your Data</span>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button onclick="clearCache()" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-broom text-yellow-400"></i>
                                <span>Clear Cache</span>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                    </div>
                </div>

                <!-- Legal Links -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-file-contract text-gray-400"></i>
                        Legal
                    </h2>
                    <div class="space-y-2">
                        <button onclick="showPage('terms')" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <span>Terms of Service</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button onclick="showPage('privacy')" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <span>Privacy Policy</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button onclick="showToast('Community Guidelines coming soon', 'info')" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <span>Community Guidelines</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                        <button onclick="showToast('Open source licenses', 'info')" class="w-full text-left py-3 px-4 rounded-xl hover:bg-white/5 transition-all flex items-center justify-between">
                            <span>Open Source Licenses</span>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </button>
                    </div>
                </div>

                <!-- About -->
                <div class="glass rounded-2xl p-6">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-blue-400"></i>
                        About
                    </h2>
                    <div class="space-y-3 text-sm text-gray-400">
                        <div class="flex justify-between">
                            <span>Version</span>
                            <span class="text-white">1.0.0</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Build</span>
                            <span class="text-white">2024.01.15</span>
                        </div>
                        <div class="flex justify-between">
                            <span>Account Created</span>
                            <span class="text-white">${new Date(currentUser?.createdAt || Date.now()).toLocaleDateString()}</span>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/10 flex gap-4 justify-center">
                        <a href="#" class="text-gray-400 hover:text-white transition-all"><i class="fab fa-twitter text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-all"><i class="fab fa-instagram text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-all"><i class="fab fa-discord text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-all"><i class="fab fa-github text-xl"></i></a>
                    </div>
                </div>

                <!-- Danger Zone -->
                <div class="glass rounded-2xl p-6 border border-red-500/30">
                    <h2 class="text-lg font-bold mb-4 flex items-center gap-2 text-red-400">
                        <i class="fas fa-exclamation-triangle"></i>
                        Danger Zone
                    </h2>
                    <div class="space-y-3">
                        <button onclick="handleLogout()" class="w-full py-3 rounded-xl bg-red-500/20 text-red-400 hover:bg-red-500/30 transition-all font-medium">
                            <i class="fas fa-sign-out-alt mr-2"></i>
                            Log Out
                        </button>
                        <button onclick="deactivateAccount()" class="w-full py-3 rounded-xl border border-orange-500/50 text-orange-400 hover:bg-orange-500/20 transition-all font-medium">
                            <i class="fas fa-pause-circle mr-2"></i>
                            Deactivate Account
                        </button>
                        <button onclick="confirmDeleteAccount()" class="w-full py-3 rounded-xl border border-red-500/50 text-red-400 hover:bg-red-500/20 transition-all font-medium">
                            <i class="fas fa-trash mr-2"></i>
                            Delete Account Permanently
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    function updateSetting(key, value) {
        settingsData[key] = value;
        localStorage.setItem('paseso_settings', JSON.stringify(settingsData));
        showToast('Setting updated', 'success');
    }

    function updateNotifSetting(key, value) {
        settingsData.notifications[key] = value;
        localStorage.setItem('paseso_settings', JSON.stringify(settingsData));
        showToast('Notification setting updated', 'success');
    }

    function setTheme(theme) {
        settingsData.appearance = theme;
        localStorage.setItem('paseso_settings', JSON.stringify(settingsData));
        applyTheme();
        showToast(`Theme set to ${theme}`, 'success');
        // refresh settings page to reflect active button state
        showPage('settings');
    }

    function setLanguage(lang) {
        settingsData.language = lang;
        localStorage.setItem('paseso_settings', JSON.stringify(settingsData));
        showToast('Language updated', 'success');
    }

    function changeEmail() {
        const newEmail = prompt('Enter new email:', currentUser?.email || '');
        if (newEmail && newEmail.includes('@')) {
            currentUser.email = newEmail;
            saveData();
            showPage('settings');
            showToast('Email updated!', 'success');
        }
    }

    function changeUsername() {
        const newUsername = prompt('Enter new username:', currentUser?.username || '');
        if (newUsername && newUsername.length >= 3) {
            currentUser.username = newUsername.toLowerCase().replace(/[^a-z0-9_]/g, '');
            saveData();
            updateUserUI();
            showPage('settings');
            showToast('Username updated!', 'success');
        }
    }

    function changePassword() {
        const newPassword = prompt('Enter new password (min 8 characters):');
        if (newPassword && newPassword.length >= 8) {
            currentUser.password = newPassword;
            currentUser.passwordChanged = Date.now();
            saveData();
            showToast('Password updated!', 'success');
        } else if (newPassword) {
            showToast('Password must be at least 8 characters', 'error');
        }
    }

    function toggle2FA() {
        currentUser.twoFactorEnabled = !currentUser.twoFactorEnabled;
        saveData();
        showPage('settings');
        showToast(currentUser.twoFactorEnabled ? '2FA Enabled!' : '2FA Disabled', currentUser.twoFactorEnabled ? 'success' : 'info');
    }

    function downloadData() {
        const data = {
            user: currentUser,
            posts: posts.filter(p => p.userId === currentUser?.id),
            messages: messages.filter(m => m.fromId === currentUser?.id || m.toId === currentUser?.id),
            settings: settingsData
        };
        
        const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `paseso_data_${currentUser?.username}_${Date.now()}.json`;
        a.click();
        URL.revokeObjectURL(url);
        showToast('Data downloaded!', 'success');
    }

    function clearCache() {
        if (confirm('Clear cached data? This will not delete your posts or messages.')) {
            // Clear only non-essential data
            showToast('Cache cleared!', 'success');
        }
    }

    function deactivateAccount() {
        if (confirm('Deactivate your account? You can reactivate it by logging in again.')) {
            currentUser.deactivated = true;
            saveData();
            handleLogout();
        }
    }

    function confirmDeleteAccount() {
        if (confirm('Are you sure you want to delete your account? This action cannot be undone!')) {
            const confirmation = prompt('Type "DELETE" to confirm:');
            if (confirmation === 'DELETE') {
                // Remove user data
                posts = posts.filter(p => p.userId !== currentUser?.id);
                messages = messages.filter(m => m.fromId !== currentUser?.id && m.toId !== currentUser?.id);
                
                const allUsers = JSON.parse(localStorage.getItem('paseso_all_users')) || [];
                const updatedUsers = allUsers.filter(u => u.id !== currentUser?.id);
                localStorage.setItem('paseso_all_users', JSON.stringify(updatedUsers));
                
                saveData();
                localStorage.removeItem('paseso_user');
                
                showToast('Account deleted. Goodbye!', 'info');
                setTimeout(() => window.location.reload(), 1500);
            }
        }
    }

    // ==================== TERMS PAGE ====================
    function renderTermsPage(container) {
        container.innerHTML = `
            <div class="max-w-3xl mx-auto">
                <button onclick="history.back() || showPage('settings')" class="mb-6 flex items-center gap-2 text-gray-400 hover:text-white transition-all">
                    <i class="fas fa-arrow-left"></i>
                    Back
                </button>

                <h1 class="text-3xl font-bold mb-2">Terms of Service</h1>
                <p class="text-gray-400 mb-8">Last updated: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>

                <div class="glass rounded-2xl p-6 space-y-6">
                    <section>
                        <h2 class="text-xl font-bold mb-3">1. Acceptance of Terms</h2>
                        <p class="text-gray-300 leading-relaxed">By accessing or using PASESO, you agree to be bound by these Terms of Service and all applicable laws and regulations. If you do not agree with any of these terms, you are prohibited from using this platform.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">2. User Accounts</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">When you create an account, you must provide accurate and complete information. You are responsible for:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Maintaining the security of your account</li>
                            <li>All activities that occur under your account</li>
                            <li>Notifying us immediately of any unauthorized use</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">3. User Content</h2>
                        <p class="text-gray-300 leading-relaxed">You retain ownership of content you post. By posting content, you grant PASESO a non-exclusive, worldwide, royalty-free license to use, display, and distribute your content on the platform.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">4. Prohibited Content</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">You may not post content that:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Is illegal, harmful, or threatening</li>
                            <li>Harasses, bullies, or intimidates others</li>
                            <li>Infringes on intellectual property rights</li>
                            <li>Contains malware or harmful code</li>
                            <li>Violates the privacy of others</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">5. Creator Program</h2>
                        <p class="text-gray-300 leading-relaxed">Creators must be at least 18 years old. PASESO takes a 15% platform fee on creator earnings. Payouts are processed within 24-48 hours of request, subject to minimum thresholds.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">6. Termination</h2>
                        <p class="text-gray-300 leading-relaxed">We reserve the right to terminate or suspend your account at any time for violations of these terms, without prior notice.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">7. Contact</h2>
                        <p class="text-gray-300 leading-relaxed">For questions about these Terms, contact us at <a href="mailto:legal@paseso.com" class="text-purple-400 hover:underline">legal@paseso.com</a></p>
                    </section>
                </div>
            </div>
        `;
    }

    // ==================== PRIVACY PAGE ====================
    function renderPrivacyPage(container) {
        container.innerHTML = `
            <div class="max-w-3xl mx-auto">
                <button onclick="history.back() || showPage('settings')" class="mb-6 flex items-center gap-2 text-gray-400 hover:text-white transition-all">
                    <i class="fas fa-arrow-left"></i>
                    Back
                </button>

                <h1 class="text-3xl font-bold mb-2">Privacy Policy</h1>
                <p class="text-gray-400 mb-8">Last updated: ${new Date().toLocaleDateString('en-US', { month: 'long', day: 'numeric', year: 'numeric' })}</p>

                <div class="glass rounded-2xl p-6 space-y-6">
                    <section>
                        <h2 class="text-xl font-bold mb-3">1. Information We Collect</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">We collect information you provide directly:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Account information (name, email, password)</li>
                            <li>Profile information (bio, avatar, location)</li>
                            <li>Content you post (photos, videos, messages)</li>
                            <li>Payment information (processed securely via Stripe)</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">2. How We Use Your Information</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">We use your information to:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Provide and improve our services</li>
                            <li>Personalize your experience</li>
                            <li>Process transactions</li>
                            <li>Send important notifications</li>
                            <li>Ensure platform safety and security</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">3. Data Storage</h2>
                        <p class="text-gray-300 leading-relaxed">Your data is stored securely using Firebase services. We implement industry-standard security measures including encryption, secure connections, and regular security audits.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">4. Data Sharing</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">We do not sell your personal data. We may share data with:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Service providers (Firebase, Stripe)</li>
                            <li>Law enforcement when legally required</li>
                            <li>Other users (only public profile information)</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">5. Your Rights</h2>
                        <p class="text-gray-300 leading-relaxed mb-2">You have the right to:</p>
                        <ul class="list-disc list-inside text-gray-300 space-y-1 ml-4">
                            <li>Access your personal data</li>
                            <li>Correct inaccurate data</li>
                            <li>Delete your account and data</li>
                            <li>Export your data</li>
                            <li>Opt-out of marketing communications</li>
                        </ul>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">6. Cookies</h2>
                        <p class="text-gray-300 leading-relaxed">We use localStorage for session management. We do not use tracking cookies for advertising purposes.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">7. Children's Privacy</h2>
                        <p class="text-gray-300 leading-relaxed">PASESO is not intended for users under 13 years of age. We do not knowingly collect data from children.</p>
                    </section>

                    <section>
                        <h2 class="text-xl font-bold mb-3">8. Contact</h2>
                        <p class="text-gray-300 leading-relaxed">For privacy concerns, contact us at <a href="mailto:privacy@paseso.com" class="text-purple-400 hover:underline">privacy@paseso.com</a></p>
                    </section>
                </div>
            </div>
        `;
    }

    // Initialize app
    init();

    // ==================== PWA INSTALL ====================
    let deferredPrompt;

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        showInstallButton();
    });

    function showInstallButton() {
        // Add install button to sidebar
        const sidebar = document.querySelector('.desktop-sidebar nav');
        if (sidebar && !document.getElementById('install-btn')) {
            const installBtn = document.createElement('button');
            installBtn.id = 'install-btn';
            installBtn.className = 'w-full flex items-center gap-4 px-4 py-3 rounded-xl hover:bg-white/5 transition-all group mt-2 border border-dashed border-white/20';
            installBtn.innerHTML = `
                <i class="fas fa-download text-xl text-green-400 w-6 text-center"></i>
                <span class="hidden xl:block font-medium text-green-400">Install App</span>
            `;
            installBtn.onclick = installApp;
            sidebar.appendChild(installBtn);
        }
    }

    async function installApp() {
        if (!deferredPrompt) {
            showToast('App already installed or not supported', 'info');
            return;
        }
        deferredPrompt.prompt();
        const { outcome } = await deferredPrompt.userChoice;
        if (outcome === 'accepted') {
            showToast('PASESO installed! üéâ', 'success');
            document.getElementById('install-btn')?.remove();
        }
        deferredPrompt = null;
    }

    window.addEventListener('appinstalled', () => {
        showToast('PASESO installed successfully! üì±', 'success');
        document.getElementById('install-btn')?.remove();
    });

    // ==================== SERVICE WORKER ====================
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => console.log('Service Worker registered:', reg.scope))
                .catch(err => console.log('SW registration failed:', err));
        });
    }

    // ==================== URL HANDLING ====================
    function handleUrlParams() {
        const params = new URLSearchParams(window.location.search);
        if (params.get('action') === 'create') {
            setTimeout(() => openCreateModal(), 500);
        }
        if (params.get('page')) {
            setTimeout(() => showPage(params.get('page')), 500);
        }
    }

    if (currentUser) {
        handleUrlParams();
    }
    </script>
    
    <!-- Modular Scripts -->
    <script src="/js/legacy.js"></script>
    <script src="/js/init-data.js"></script>
    <script src="/js/firebase-config.js"></script>
    <script src="/js/i18n.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/database.js"></script>
    <script src="/js/storage.js"></script>
    <script src="/js/ui.js"></script>
    <script src="/js/app.js"></script>
</body>
</html>
